(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _chat = require('@livelyvideo/chat');

var _chat2 = _interopRequireDefault(_chat);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
Set up the chat instance

Params:
	- html element
	- options
			user: users username, should be unique to the user
			room: room name
			apiHost: lively chat api
			websocketHost: lively ws api
			url: the company's auth url, which should access livelyvideo to create an access token for the user
**/
var chat = void 0;
var ROOM = 'blt';
function createChat(user, el) {
	if (chat) {
		chat.destroy();
	}
	chat = new _chat2.default(el, {
		user: user,
		room: ROOM,
		host: 'sandbox.livelyvideo.tv',
		authUrl: '/access-token?username=' + user
	});
}

document.querySelector('#pickuser').onsubmit = function (e) {
	e.preventDefault();
	createChat(e.target.querySelector('[name=username]').value, document.querySelector('.chat'));
	e.target.setAttribute('disabled', true);
	e.target.querySelector('[name=username]').value = '';
};

},{"@livelyvideo/chat":2}],2:[function(require,module,exports){
(function (global){
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.LivelyChat=t()}}(function(){var t;return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("events");t("whatwg-fetch");var c={timeout:5e3,headers:{},bootstrap:{}},l={Accept:"application/json"},h=function(t){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(!t)throw new Error("scope is required");if(!n)throw new Error("authorization server url is required");if(a._options=s({},c,i),a._url=-1===n.indexOf("?")?n+"?scope="+t:n+"&scope="+t,a._stopped=!1,a._fatalError=null,a._token=a._options.bootstrap.token||null,a._retries=[0,200,1e3,3e3],a._retry=0,a._autorefresh=null,a._headers=Object.assign({},l,i.headers),null===a._token)a._retryRequest();else if(a._options.bootstrap&&a._options.bootstrap.expire){var u=a._options.bootstrap.expire-Date.now()-6e4;a._autorefresh=setTimeout(function(){a._autorefresh=null,a._stopped||a._retryRequest()},u)}return a}return i(e,t),a(e,[{key:"destroy",value:function(){this._stopped=!0}},{key:"request",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._fatalError)return void e(this._fatalError);if(null!==this._token)return void e(null,this._token);var n=!1,r=function(){n||(n=!0,e(null,t._token))},o=function(){n||(n=!0,e(new Error("authorization: timeout")))},i=setTimeout(function(){t.removeListener("ready",r),o()},this._options.timeout);this.once("ready",function(){clearTimeout(i),r()})}},{key:"refreshToken",value:function(){var t=this;null!==this._token&&(null!==this._autorefresh&&(clearTimeout(this._autorefresh),this._autorefresh=null),this._token=null,function(){t._retryRequest()}())}},{key:"_retryRequest",value:function(){var t=this,e=this._retries[this._retry];return e?void setTimeout(function(){t._makeRequest()},e):void this._makeRequest()}},{key:"_makeRequest",value:function(){var t=this;fetch(this._url,{credentials:"same-origin",headers:this._headers}).then(function(t){if(t.status>=200&&t.status<300)return t.json();if(401===t.status){var e=new Error("authorization: unauthorized");throw e.fatal=!0,e}if(403===t.status){var n=new Error("authorization: forbidden");throw n.fatal=!0,n}throw new Error("authorization: non-200 response code from auth server")}).then(function(e){t._token=e.token,t._retry=0,t.emit("ready",{token:e.token});var n=new Date(e.expire).getTime()-Date.now()-6e4;t._autorefresh=setTimeout(function(){t._autorefresh=null,t._stopped||t._retryRequest()},n)})["catch"](function(e){return t._token=null,e.fatal?void(t._fatalError=e):(t._retryRequest(),void(t._retry<t._retries.length-1&&t._retry++))})}}]),e}(u.EventEmitter);n["default"]=h},{events:52,"whatwg-fetch":2}],2:[function(){!function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function n(t){return"string"!=typeof t&&(t=String(t)),t}function r(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return y.iterable&&(e[Symbol.iterator]=function(){return e}),e}function o(t){this.map={},t instanceof o?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function i(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function s(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function a(t){var e=new FileReader,n=s(e);return e.readAsArrayBuffer(t),n}function u(t){var e=new FileReader,n=s(e);return e.readAsText(t),n}function c(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}function l(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function h(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(y.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(y.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(y.arrayBuffer&&y.blob&&b(t))this._bodyArrayBuffer=l(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!g(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=l(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob&&(this.blob=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?i(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(t){var e=t.toUpperCase();return w.indexOf(e)>-1?e:t}function d(t,e){e=e||{};var n=e.body;if(t instanceof d){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new o(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",(e.headers||!this.headers)&&(this.headers=new o(e.headers)),this.method=f(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(o))}}),e}function m(t){var e=new o;return t.split(/\r?\n/).forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var o=n.join(":").trim();e.append(r,o)}}),e}function _(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new o(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var y={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(y.arrayBuffer)var v=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],b=function(t){return t&&DataView.prototype.isPrototypeOf(t)},g=ArrayBuffer.isView||function(t){return t&&v.indexOf(Object.prototype.toString.call(t))>-1};o.prototype.append=function(t,r){t=e(t),r=n(r);var o=this.map[t];this.map[t]=o?o+","+r:r},o.prototype["delete"]=function(t){delete this.map[e(t)]},o.prototype.get=function(t){return t=e(t),this.has(t)?this.map[t]:null},o.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},o.prototype.set=function(t,r){this.map[e(t)]=n(r)},o.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},o.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),r(t)},o.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),r(t)},o.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),r(t)},y.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this,{body:this._bodyInit})},h.call(d.prototype),h.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},_.error=function(){var t=new _(null,{status:0,statusText:""});return t.type="error",t};var k=[301,302,303,307,308];_.redirect=function(t,e){if(-1===k.indexOf(e))throw new RangeError("Invalid status code");return new _(null,{status:e,headers:{location:t}})},t.Headers=o,t.Request=d,t.Response=_,t.fetch=function(t,e){return new Promise(function(n,r){var o=new d(t,e),i=new XMLHttpRequest;i.onload=function(){var t={status:i.status,statusText:i.statusText,headers:m(i.getAllResponseHeaders()||"")};t.url="responseURL"in i?i.responseURL:t.headers.get("X-Request-URL");var e="response"in i?i.response:i.responseText;n(new _(e,t))},i.onerror=function(){r(new TypeError("Network request failed"))},i.ontimeout=function(){r(new TypeError("Network request failed"))},i.open(o.method,o.url,!0),"include"===o.credentials&&(i.withCredentials=!0),"responseType"in i&&y.blob&&(i.responseType="blob"),o.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send("undefined"==typeof o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},{}],3:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var i=function(){function t(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r(this,t),!e)throw new Error("auth is required for a changerole request");if(this._auth=e,!n)throw new Error("url is required for a changerole request");this._url=n,this._nextParams="",this._options=o,this._retries=[0,300,1e3]}return o(t,[{key:"get",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},e=this._url+"?";this._options.limit&&(e=e+"limit="+this._options.limit+"&"),this._request(e,t)}},{key:"next",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._nextParams){var e=this._url+"?"+this._nextParams;return void this._request(e,t)}t(null,[])}},{key:"_request",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=-1,o=function i(){e._auth.request(function(o,s){return o?void n(o):void fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s}}).then(function(t){if(200===t.status)return t.json();if(401===t.status){var e=new Error("chat: unauthorized");throw e.retry=!0,e}if(503===t.status){var n=new Error("chat: server unavailable");throw n.retry=!0,n}if(403===t.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(t){e._nextParams=t&&t._links&&t._links.next&&t._links.next.href?t._links.next.href.split("?")[1]:"",n(null,t.changeroles)})["catch"](function(t){if(t.retry&&r<e._retries.length-1){r++;var o=e._retries[r];return o?void setTimeout(i,o):void i()}n(t)})})};o()}}]),t}();n["default"]=i},{"whatwg-fetch":54}],4:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var i=function(){function t(e,n){if(r(this,t),!e)throw new Error("auth is required for a command");if(this._auth=e,!n)throw new Error("url is required for a command");this._url=n,this._retries=[0,300,1e3]}return o(t,[{key:"run",value:function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!t)return void r(new Error("command is required for a command"));var o=-1,e=function i(){n._auth.request(function(e,s){return e?void r(e):void fetch(n._url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s},body:JSON.stringify({command:t})}).then(function(t){if(t.status>=200&&t.status<300)return 204===t.status?null:t.json();if(401===t.status){n._auth.refreshToken();var e=new Error("chat: unauthorized");throw e.retry=!0,e}if(503===t.status){var r=new Error("chat: server unavailable");throw r.retry=!0,r}if(403===t.status)throw new Error("chat: forbidden");if(t.status>=400&&t.status<500)return t.json();throw new Error("chat: non-200 response code from chat server")}).then(function(t){return t&&t.messages?void r(null,t.messages):void r()})["catch"](function(t){if(t.retry&&o<n._retries.length-1){o++;var e=n._retries[o];return e?void setTimeout(i,e):void i()}r(t)})})};e()}}]),t}();n["default"]=i},{"whatwg-fetch":54}],5:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var u=t("events"),c=t("./uuid.js"),l=r(c),h=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(r._auth=n,!t)throw new Error("url is required for a command");return r._url=t,r._stopped=!0,r._connectionID=l["default"](),r._isConnected=!1,r._retry=0,r._retries=[0,300,1e3],r._run(),r}return s(e,t),a(e,[{key:"destroy",value:function(){this._stopped=!0}},{key:"_retryRun",value:function(t){var e=this;return t?(this._retry=0,void this._run()):(this._retry<this._retries.length-1&&this._retry++,void setTimeout(function(){e._run()},this._retries[this._retry]))}},{key:"_run",value:function(){var t=this;return this._auth?void this._auth.request(function(e,n){return e?void t._disconnected(e):void t._request(n)}):void this._request()}},{key:"_request",value:function(t){var e=this,n={Accept:"application/json","Content-Type":"application/json"};t&&(n.Authorization="Bearer "+t),fetch(this._url+"?cid="+this._connectionID,{method:"GET",headers:n}).then(function(t){if(200===t.status)return t.json();if(401===t.status){e._auth.refreshToken();var n=new Error("chat: unauthorized");throw n.retry=!0,n}if(503===t.status){var r=new Error("chat: server unavailable");throw r.retry=!0,r}if(404===t.status)throw new Error("Room does not exist");if(403===t.status)throw e.emit("unauthorized"),new Error("chat: forbidden");if(409===t.status){e._connectionID=l["default"]();var o=new Error("chat: connection id conflict");throw o.ignore=!0,o.retry=!0,o}throw new Error("non 200 response")}).then(function(t){e._connected();for(var n=0;n<t.length;n++)e.emit("message",t[n]);e._stopped||e._retryRun(!0)})["catch"](function(t){e._disconnected(t),t.retry&&(e._stopped||e._retryRun())})}},{key:"_disconnected",value:function(t){t&&(t.ignore||this.emit("error",t)),this._isConnected&&(this.emit("disconnect"),this._isConnected=!1)}},{key:"_connected",value:function(){this._isConnected||(this.emit("ready"),this._isConnected=!0)}}]),e}(u.EventEmitter);n["default"]=h},{"./uuid.js":10,events:52,"whatwg-fetch":54}],6:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var i=function(){function t(e){if(r(this,t),!e)throw new Error("auth is required for an http request");this._auth=e,this._retries=[0,300,1e3]}return o(t,[{key:"execGet",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!t)throw new Error("url is required for an http request");this._execute("GET",t,null,e)}},{key:"execPut",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!t)throw new Error("url is required for an http request");this._execute("PUT",t,e,n)}},{key:"execPost",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!t)throw new Error("url is required for an http request");this._execute("POST",t,e,n)}},{key:"execPatch",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!t)throw new Error("url is required for an http request");this._execute("PATCH",t,e,n)}},{key:"execDelete",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!t)throw new Error("url is required for an http request");this._execute("DELETE",t,e)}},{key:"_execute",value:function(t,e,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i={method:t,headers:{Accept:"application/json","Content-Type":"application/json"}};n&&(i.body=JSON.stringify(n));var s=-1,a=function u(){r._auth.request(function(t,n){return t?void o(t):(i.headers.Authorization="Bearer "+n,void fetch(e,i).then(function(t){if(t.status>=200&&t.status<300)return t.json();if(401===t.status){var e=new Error("chat: unauthorized");throw e.retry=!0,e}if(503===t.status){var n=new Error("chat: server unavailable");throw n.retry=!0,n}if(403===t.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(t){o(null,t)})["catch"](function(t){if(t.retry&&s<r._retries.length-1){s++;var e=r._retries[s];return e?void setTimeout(u,e):void u()}o(t)}))})};a()}}]),t}();n["default"]=i},{"whatwg-fetch":54}],7:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("events"),c=t("@livelyvideo/auth-core/lib/index.js"),l=r(c),h=t("./websocket.js"),f=r(h),d=t("./fallback.js"),p=r(d),m=t("./command.js"),_=r(m),y=t("./parser.js"),v=r(y),b=t("./roster.js"),g=r(b),w=t("./changerole.js"),k=r(w),E=t("./http.js"),x=r(E),T=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(!t)throw new Error("chat configuration is required");if(!t.room)throw new Error("chat room is required");if(!t.host)throw new Error("chat server host required");var s="https://"+t.host+"/chat/v1/rooms/"+t.room+"/command",a="https://"+t.host+"/chat/v1/manifests/say/rooms/"+t.room+"/version",u="wss://ws-"+t.host+"/chat/ws/v1/rooms/"+t.room,c="/chat/http/v1/rooms/"+t.room;if(r._rosterUrl="https://"+t.host+"/chat/v1/rooms/"+t.room+"/roster",r._changeroleUrl="https://"+t.host+"/chat/v1/rooms/"+t.room+"/changeroles",r._routeStart="https://"+t.host+"/chat/v1",n){if(!n.url)throw new Error("authorization configuration url is required");r._auth=new l["default"]("chat",n.url,n.options)}var h=new v["default"](a);if(r._parser=h,r._auth&&(r._http=new x["default"](r._auth),r._command=new _["default"](r._auth,s)),window.WebSocket)r._socketInterface=new f["default"](u,r._auth);else{var d=d="https://"+t.host+c;r._socketInterface=new p["default"](d,r._auth)}return r._socketInterface.on("error",function(t){r.emit("error",t)}),r._socketInterface.on("ready",function(){r.emit("ready")}),r._historyEmitted=!1,r._socketInterface.on("unauthorized",function(){if(r._historyEmitted)return void r.emit("me",null);var t=function(){r.emit("me",null)},e=window.setTimeout(function(){t(),t=null},3e3);r.once("history",function(){t&&t(),window.clearTimeout(e)})}),r._socketInterface.on("disconnect",function(){r._historyEmitted=!1,r.emit("disconnect")}),r._socketInterface.on("message",function(t){h.parseMessage(t,r._emitCommand.bind(r))}),r._sayDedupe=[],r._me=null,r._room=null,r}return s(e,t),a(e,[{key:"getDefaultAvatars",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/avatars",t)}},{key:"setDefaultUserAvatar",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/users/"+t+"/avatar",{"default":e},n)}},{key:"getUserEmoticons",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/users/"+t+"/emoticons",e)}},{key:"getAllEmoticons",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/rooms/"+t+"/users/"+e+"/emoticons/all",n)}},{key:"postUserEmoticon",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPost(this._routeStart+"/users/"+t+"/emoticons",e,n)}},{key:"deleteUserEmoticon",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execDelete(this._routeStart+"/users/"+t+"/emoticons/"+e,n)}},{key:"getUserAvatar",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/users/"+t+"/avatar",e)}},{key:"putUserAvatar",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPut(this._routeStart+"/users/"+t+"/avatar",e,n)}},{key:"getUser",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/users/"+t,e)}},{key:"patchUser",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/users/"+t,e,n)}},{key:"getRoomUser",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/rooms/"+t+"/users/"+e,n)}},{key:"patchRoomUser",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/rooms/"+t+"/users/"+e,n,r)}},{key:"getRoom",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/rooms/"+t,e)}},{key:"patchRoom",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/rooms/"+t,e,n)}},{key:"getChangeroles",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._auth)throw new Error("Changeroles calls require authentication");var e=Object.assign({},{limit:100,role:""},t);return new k["default"](this._auth,this._changeroleUrl,e)}},{key:"getRoster",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},{limit:100,role:""},t);return new g["default"](this._rosterUrl,e)}},{key:"command",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!this._auth)throw new Error("Command calls require authentication");this._command.run(t,function(t,r){if(t)return void n(t);for(var o=r.length-1;o>=0;o--)r[o].data&&r[o].data&&r[o].data.command&&(e._parser.parseMessage(r[o].data.command,e._emitCommand.bind(e)),r.splice(0,1));n(null,r)})}},{key:"destroy",value:function(){this._auth.destroy(),this._socketInterface.destroy()}},{key:"_emitCommand",value:function(t,e,n){if(t)return void this.emit("error",t);switch(e){case"SAY":this._emitSay(n);break;case"ME":this._me=n,this.emit("me",n);break;case"ROOM":this._room=n,this.emit("room",n);break;case"MESSAGE":this.emit("message",n);break;case"HISTORY":this.emit("history",n),this._historyEmitted=!0;break;case"DELETE":this.emit("delete",n)}}},{key:"_emitSay",value:function(t){for(var e=this._sayDedupe.length-1;e>=0;e--)if(this._sayDedupe[e]===t.id)return;this._me&&this._me.ignore&&-1!==this._me.ignore.indexOf(t.actor.id)&&(t.ignore=!0),this._sayDedupe.length>50&&this._sayDedupe.splice(0,1),this._sayDedupe.push(t.id),this.emit("chat",t)}},{key:"_httpCheckAuth",value:function(){if(!this._auth)throw new Error("Http calls require authentication")}}]),e}(u.EventEmitter);n["default"]=T},{"./changerole.js":3,"./command.js":4,"./fallback.js":5,"./http.js":6,"./parser.js":8,"./roster.js":9,"./websocket.js":11,"@livelyvideo/auth-core/lib/index.js":1,events:52}],8:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var i={INDEX:"index",TYPE:"type",NESTED_ITEMS:"nestedItems"},s={KEY:"key",VARS:"vars"},a={NESTED_DATA_ARRAY:"nestedDataArray",NESTED_ARRAY:"nestedArray",NESTED_OBJECT:"nestedObject",TEMPLATE:"template",INT_ARRAY:"intArray",STRING_ARRAY:"stringArray",STRING:"string",INT:"int",BOOL:"bool"},u={emoticons:"emoticon",links:"link",mentions:"mention",tags:"tag"},c=function(){function t(e){if(r(this,t),!e)throw new Error("url is required for parser");this._baseUrl=e,this._manifests={},this._buffer={},this._fetchingManifests={}}return o(t,[{key:"parseMessage",value:function(t,e){var n=this;t&&t instanceof Array&&!(t.length<2)||e(new Error("Invalid data format"));var r=t[0],o=t[1];this._parseMessage(r,o,function(t,o){return t?void e(t):("HISTORY"===r&&o.messages.length&&o.messages.forEach(function(t,e){n._parseMessage("SAY",t,function(t,n){t||(o.messages[e]=n)})}),void e(null,r,o))})}},{key:"_addManifest",value:function(t){this._manifests[t.version]=t}},{key:"_parseMessage",value:function(t,e,n){var r=this,o=e[0],i=void 0;return this._manifests[o]?this._manifests[o].manifests[t]?(i=this._parse(o,this._manifests[o].manifests[t],e),void n(null,i)):void n(new Error("manifest does not have "+t+" command")):(this._buffer[o]?this._buffer[o].push([e,t,n]):this._buffer[o]=[[e,t,n]],void(this._fetchingManifests[o]!==!0&&(this._fetchingManifests[o]=!0,fetch(this._baseUrl+"/"+o).then(function(t){if(200!==t.status)throw new Error("chat: non-200 response code from chat server");return t.json()}).then(function(t){for(r._addManifest(t);r._buffer[t.version].length>0;){var e=r._buffer[t.version].shift();i=r._parse(t.version,t.manifests[e[1]],e[0]),e[2](null,i)}})["catch"](function(t){r._buffer[o]=[],n(t)}))))}},{key:"_parse",value:function(t,e,n){for(var r=this,o={},c=Object.keys(e),l=function(l){var h=c[l],f=e[h],d=n[f[i.INDEX]];if(null===d)return o[h]=null,"continue";var p=void 0;switch(f[i.TYPE]){case a.NESTED_ARRAY:p=[];for(var m=0;m<d.length;m++)p.push(r._parse(t,f[i.NESTED_ITEMS],d[m]));break;case a.NESTED_OBJECT:p=r._parse(t,f[i.NESTED_ITEMS],d);break;case a.TEMPLATE:p=r._parseTemplate(t,d[f[i.NESTED_ITEMS][s.KEY].index],d[f[i.NESTED_ITEMS][s.VARS].index]);break;default:p=d}p&&p instanceof Array&&p.forEach(function(t){var e=t;e.positions&&e.positions instanceof Array&&e.positions.forEach(function(t){u[h]&&(e.type=u[h],o.positions||(o.positions={}),o.positions[t]=e)})}),o[h]=p},h=0;h<c.length;h++){{l(h)}}return o}},{key:"_parseTemplate",value:function(t,e,n){var r=new l(this._manifests[t].templates[e],n);return r.getParsed()}}]),t}(),l=function(){function t(e,n){return r(this,t),this._parsed="",n&&0!==n.length?void(e&&0!==e.length&&(this._parsed="",
this._varPos=0,this._curr="",this._template=e,this._templateLength=e.length,this._vars=n,this._next=this._startState.bind(this),this._pos=0,this._skipNext=!1)):void(this._parsed=e)}return o(t,[{key:"getParsed",value:function(){if(this._parsed)return this._parsed;for(var t=0;t<this._templateLength;t++)this._skipNext?this._skipNext=!1:(this._pos=t,this._curr=this._template[t],this._next=this._next().bind(this));return this._parsed}},{key:"_startDelim",value:function(){return this._pos>=this._templateLength-1?!1:"{"===this._curr&&"{"===this._template[this._pos+1]?(this._skipNext=!0,!0):!1}},{key:"_endDelim",value:function(){return this._pos>=this._templateLength-1?!1:"}"===this._curr&&"}"===this._template[this._pos+1]?(this._skipNext=!0,!0):!1}},{key:"_startState",value:function(){return this._startDelim()?this._midState:(this._parsed+=this._curr,this._startState)}},{key:"_midState",value:function(){return"n"===this._curr?this._endState:(this._parsed=this._parsed+"{{"+this._curr,this._startState)}},{key:"_endState",value:function(){return this._endDelim()?(this._parsed+=this._vars[this._varPos],this._varPos++):this._parsed+=this._curr,this._startState}}]),t}();n["default"]=c},{"whatwg-fetch":54}],9:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var i=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,t),!e)throw new Error("url is required for a roster request");this._url=e,this._nextParams="",this._options=n,this._retries=[0,300,1e3]}return o(t,[{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},e=this._url+"?";this._options.limit&&(e=e+"limit="+this._options.limit+"&"),this._options.role&&(e=e+"role="+this._options.role+"&"),this._request(e,t)}},{key:"next",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._nextParams){var e=this._url+"?"+this._nextParams;return void this._request(e,t)}t(null,[])}},{key:"_request",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=-1,o=function i(){fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(t){if(200===t.status)return t.json();if(503===t.status){var e=new Error("chat: server unavailable");throw e.retry=!0,e}if(403===t.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(t){e._nextParams=t&&t._links&&t._links.next&&t._links.next.href?t._links.next.href.split("?")[1]:"",n(null,t.users)})["catch"](function(t){if(t.retry&&r<e._retries.length-1){r++;var o=e._retries[r];return o?void setTimeout(i,o):void i()}n(t)})};o()}}]),t}();n["default"]=i},{"whatwg-fetch":54}],10:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});for(var r=new Array(16),o=function(){for(var t,e=0;16>e;e++)0===(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r},i=function(t,e){var n=e||0,r=s;return r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]},s=[],a={},u=0;256>u;u++)s[u]=(u+256).toString(16).substr(1),a[s[u]]=u;var c=function(){var t=o();return t[6]=15&t[6]|64,t[8]=63&t[8]|128,i(t)};n["default"]=c},{}],11:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("reconnectable-websocket"),c=r(u),l=t("events"),h={MSG:"msg",FIN:"fin"},f={MSG:"msg",ERR:"err",FIN:"fin",ACK:"ack"},d={DEFAULT:"/",AUTH:"/auth"},p=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(!t)throw new Error("url is required for chat");return r._auth=n,r._socket=new c["default"](t,"livelyWebsocket",{automaticOpen:!1,reconnectOnError:!0,reconnectOnCleanClose:!0,randomRatio:!1}),r._retries=[0,200,1e3,2e3],r._retry=0,r.ready=!1,r.authed=!1,r._socket.onopen=function(){r._auth&&r._authenticate()},r._socket.onclose=function(t){r.emit("disconnect"),r.ready=!1,r.authed=!1,1003===t.code&&(r._socket._options.reconnectOnCleanClose=!1,r._socket._options.reconnectOnError=!1,r._socket.close(),r.emit("error",new Error("Requested room does not exist")))},r._socket.onmessage=function(t){r._onmessage(t)},r._socket.open(),r}return s(e,t),a(e,[{key:"destroy",value:function(){this._socket._options.reconnectOnCleanClose=!1,this._socket._options.reconnectOnError=!1,this._socket.close()}},{key:"_authenticate",value:function(){var t=this;this._auth.request(function(e,n){return e?void t.emit("error",e):(t._send(t._socket,h.MSG,d.AUTH,n),void t.once("_authed",function(e){return e?void t.emit("unauthorized"):void 0}))})}},{key:"_send",value:function(t,e,n,r){if(t&&t.readyState===t.OPEN){var o=e+" "+n+" "+r;this._socket.send(o)}}},{key:"_onmessage",value:function(t){var e=t.data;if(e){var n=e.indexOf(" "),r=e.indexOf(" ",n+1),o=e.slice(0,n),i=e.slice(n+1,r),s=e.slice(r+1);if(o===f.MSG){var a=void 0;try{a=JSON.parse(s)}catch(u){return void this.emit("error",u)}return void this.emit("message",a)}return this.ready||o!==f.ACK||i!==d.DEFAULT||(this.emit("ready"),this.ready=!0,this._auth||this.emit("unauthorized")),this.authed||o!==f.FIN?o===f.ERR?void this.emit("error",new Error(s)):void 0:void(i===d.AUTH&&(this.emit("_authed"),this.authed=!0))}}}]),e}(l.EventEmitter);n["default"]=p},{events:52,"reconnectable-websocket":53}],12:[function(e,n,r){!function(e,o){"object"==typeof r&&"object"==typeof n?n.exports=o():"function"==typeof t&&t.amd?t([],o):"object"==typeof r?r.LivelyLocales=o():e.LivelyLocales=o()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(e){if("object"!==("undefined"==typeof e?"undefined":i(e)))throw new Error("Lively Localization instantiated with something other than a messages object",{messages:e});return new c(t,e)}return t&&u[t]?u[t]:h}Object.defineProperty(e,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e});var a={},u={},c=function(){function t(e,n){return r(this,t),e&&a[e]||n?(this.name=e,this.data=a[e]||{},void(n&&Object.assign(this.data,n))):void(this.localize=function(t){return t})}return s(t,[{key:"localize",value:function(t){var e=void 0;return(e=this.data[t])?e:(console.warn(this.name?"'"+t+"' has no translation in the provided '"+this.name+"' locale files or localization messages":"'"+t+"' has no translation in the provided localization messages."),t)}}]),t}(),l=n(1);l.keys().forEach(function(t){var e=t.split("/");3===e.length&&(a[e[1]]||(a[e[1]]={}),a[e[1]]=Object.assign(a[e[1]],l(t)))});var h=new c;Object.keys(a).forEach(function(t){u[t]=new c(t)}),e["default"]=o,t.exports=e["default"]},function(t){function e(t){throw new Error("Cannot find module '"+t+"'.")}e.keys=function(){return[]},e.resolve=e,t.exports=e,e.id=1}])})},{}],13:[function(t,e){e.exports={"default":t("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":16}],14:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},{}],15:[function(){"document"in window.self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))?!function(){"use strict";var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var n,r=arguments.length;for(n=0;r>n;n++)t=arguments[n],e.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}t=null}():!function(t){"use strict";if("Element"in t){var e="classList",n="prototype",r=t.Element[n],o=Object,i=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},a=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},u=function(t,e){if(""===e)throw new a("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(e))throw new a("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(t,e)},c=function(t){for(var e=i.call(t.getAttribute("class")||""),n=e?e.split(/\s+/):[],r=0,o=n.length;o>r;r++)this.push(n[r]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},l=c[n]=[],h=function(){return new c(this)};if(a[n]=Error[n],l.item=function(t){return this[t]||null},l.contains=function(t){return t+="",-1!==u(this,t)},l.add=function(){var t,e=arguments,n=0,r=e.length,o=!1;do t=e[n]+"",-1===u(this,t)&&(this.push(t),o=!0);while(++n<r);o&&this._updateClassName()},l.remove=function(){var t,e,n=arguments,r=0,o=n.length,i=!1;do for(t=n[r]+"",e=u(this,t);-1!==e;)this.splice(e,1),i=!0,e=u(this,t);while(++r<o);i&&this._updateClassName()},l.toggle=function(t,e){t+="";var n=this.contains(t),r=n?e!==!0&&"remove":e!==!1&&"add";return r&&this[r](t),e===!0||e===!1?e:!n},l.toString=function(){return this.join(" ")},o.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{o.defineProperty(r,e,f)}catch(d){-2146823252===d.number&&(f.enumerable=!1,o.defineProperty(r,e,f))}}else o[n].__defineGetter__&&r.__defineGetter__(e,h)}}(window.self))},{}],16:[function(t,e){t("../../modules/es6.object.assign"),e.exports=t("../../modules/_core").Object.assign},{"../../modules/_core":21,"../../modules/es6.object.assign":51}],17:[function(t,e){e.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},{}],18:[function(t,e){var n=t("./_is-object");e.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},{"./_is-object":34}],19:[function(t,e){var n=t("./_to-iobject"),r=t("./_to-length"),o=t("./_to-index");e.exports=function(t){return function(e,i,s){var a,u=n(e),c=r(u.length),l=o(s,c);if(t&&i!=i){for(;c>l;)if(a=u[l++],a!=a)return!0}else for(;c>l;l++)if((t||l in u)&&u[l]===i)return t||l||0;return!t&&-1}}},{"./_to-index":44,"./_to-iobject":46,"./_to-length":47}],20:[function(t,e){var n={}.toString;e.exports=function(t){return n.call(t).slice(8,-1)}},{}],21:[function(t,e){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},{}],22:[function(t,e){var n=t("./_a-function");e.exports=function(t,e,r){if(n(t),void 0===e)return t;switch(r){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}}},{"./_a-function":17}],23:[function(t,e){e.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},{}],24:[function(t,e){e.exports=!t("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":28}],25:[function(t,e){var n=t("./_is-object"),r=t("./_global").document,o=n(r)&&n(r.createElement);e.exports=function(t){return o?r.createElement(t):{}}},{"./_global":29,"./_is-object":34}],26:[function(t,e){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],27:[function(t,e){var n=t("./_global"),r=t("./_core"),o=t("./_ctx"),i=t("./_hide"),s="prototype",a=function(t,e,u){var c,l,h,f=t&a.F,d=t&a.G,p=t&a.S,m=t&a.P,_=t&a.B,y=t&a.W,v=d?r:r[e]||(r[e]={}),b=v[s],g=d?n:p?n[e]:(n[e]||{})[s];d&&(u=e);for(c in u)l=!f&&g&&void 0!==g[c],l&&c in v||(h=l?g[c]:u[c],v[c]=d&&"function"!=typeof g[c]?u[c]:_&&l?o(h,n):y&&g[c]==h?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e[s]=t[s],e}(h):m&&"function"==typeof h?o(Function.call,h):h,m&&((v.virtual||(v.virtual={}))[c]=h,t&a.R&&b&&!b[c]&&i(b,c,h)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,e.exports=a},{"./_core":21,"./_ctx":22,"./_global":29,"./_hide":31}],28:[function(t,e){e.exports=function(t){try{return!!t()}catch(e){return!0}}},{}],29:[function(t,e){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],30:[function(t,e){var n={}.hasOwnProperty;e.exports=function(t,e){return n.call(t,e)}},{}],31:[function(t,e){var n=t("./_object-dp"),r=t("./_property-desc");e.exports=t("./_descriptors")?function(t,e,o){return n.f(t,e,r(1,o))}:function(t,e,n){return t[e]=n,t}},{"./_descriptors":24,"./_object-dp":36,"./_property-desc":41}],32:[function(t,e){e.exports=!t("./_descriptors")&&!t("./_fails")(function(){return 7!=Object.defineProperty(t("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":24,"./_dom-create":25,"./_fails":28}],33:[function(t,e){var n=t("./_cof");e.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},{"./_cof":20}],34:[function(t,e){e.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},{}],35:[function(t,e){"use strict";var n=t("./_object-keys"),r=t("./_object-gops"),o=t("./_object-pie"),i=t("./_to-object"),s=t("./_iobject"),a=Object.assign;e.exports=!a||t("./_fails")(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=a({},t)[n]||Object.keys(a({},e)).join("")!=r})?function(t){for(var e=i(t),a=arguments.length,u=1,c=r.f,l=o.f;a>u;)for(var h,f=s(arguments[u++]),d=c?n(f).concat(c(f)):n(f),p=d.length,m=0;p>m;)l.call(f,h=d[m++])&&(e[h]=f[h]);return e}:a},{"./_fails":28,"./_iobject":33,"./_object-gops":37,"./_object-keys":39,"./_object-pie":40,"./_to-object":48}],36:[function(t,e,n){var r=t("./_an-object"),o=t("./_ie8-dom-define"),i=t("./_to-primitive"),s=Object.defineProperty;n.f=t("./_descriptors")?Object.defineProperty:function(t,e,n){if(r(t),e=i(e,!0),r(n),o)try{return s(t,e,n)}catch(a){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},{"./_an-object":18,"./_descriptors":24,"./_ie8-dom-define":32,"./_to-primitive":49}],37:[function(t,e,n){n.f=Object.getOwnPropertySymbols},{}],38:[function(t,e){var n=t("./_has"),r=t("./_to-iobject"),o=t("./_array-includes")(!1),i=t("./_shared-key")("IE_PROTO");e.exports=function(t,e){var s,a=r(t),u=0,c=[];for(s in a)s!=i&&n(a,s)&&c.push(s);for(;e.length>u;)n(a,s=e[u++])&&(~o(c,s)||c.push(s));return c}},{"./_array-includes":19,"./_has":30,"./_shared-key":42,"./_to-iobject":46}],39:[function(t,e){var n=t("./_object-keys-internal"),r=t("./_enum-bug-keys");e.exports=Object.keys||function(t){return n(t,r)}},{"./_enum-bug-keys":26,"./_object-keys-internal":38}],40:[function(t,e,n){n.f={}.propertyIsEnumerable},{}],41:[function(t,e){e.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},{}],42:[function(t,e){var n=t("./_shared")("keys"),r=t("./_uid");e.exports=function(t){return n[t]||(n[t]=r(t))}},{"./_shared":43,"./_uid":50}],43:[function(t,e){var n=t("./_global"),r="__core-js_shared__",o=n[r]||(n[r]={});e.exports=function(t){return o[t]||(o[t]={})}},{"./_global":29}],44:[function(t,e){var n=t("./_to-integer"),r=Math.max,o=Math.min;e.exports=function(t,e){return t=n(t),0>t?r(t+e,0):o(t,e)}},{"./_to-integer":45}],45:[function(t,e){var n=Math.ceil,r=Math.floor;e.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},{}],46:[function(t,e){var n=t("./_iobject"),r=t("./_defined");e.exports=function(t){return n(r(t))}},{"./_defined":23,"./_iobject":33}],47:[function(t,e){var n=t("./_to-integer"),r=Math.min;e.exports=function(t){return t>0?r(n(t),9007199254740991):0}},{"./_to-integer":45}],48:[function(t,e){var n=t("./_defined");e.exports=function(t){return Object(n(t))}},{"./_defined":23}],49:[function(t,e){var n=t("./_is-object");e.exports=function(t,e){if(!n(t))return t;var r,o;if(e&&"function"==typeof(r=t.toString)&&!n(o=r.call(t)))return o;if("function"==typeof(r=t.valueOf)&&!n(o=r.call(t)))return o;if(!e&&"function"==typeof(r=t.toString)&&!n(o=r.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":34}],50:[function(t,e){var n=0,r=Math.random();e.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+r).toString(36))}},{}],51:[function(t){var e=t("./_export");e(e.S+e.F,"Object",{assign:t("./_object-assign")})},{"./_export":27,"./_object-assign":35}],52:[function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function o(t){return"number"==typeof t}function i(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!o(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,o,a,u,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(n=this._events[t],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),c=n.slice(),o=c.length,u=0;o>u;u++)c[u].apply(this,a);return!0},n.prototype.addListener=function(t,e){var o;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?i(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,i(this._events[t])&&!this._events[t].warned&&(o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[t].length>o&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),o||(o=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var o=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,o,s,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],s=n.length,o=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(i(n)){for(a=s;a-->0;)if(n[a]===e||n[a].listener&&n[a].listener===e){o=a;break}if(0>o)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},{}],53:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){return Math.random()*(e-t)+t}Object.defineProperty(n,"__esModule",{value:!0});var i=t("babel-runtime/core-js/object/assign"),s=r(i),a=t("babel-runtime/helpers/classCallCheck"),u=r(a),c={debug:!1,automaticOpen:!0,reconnectOnError:!1,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,randomRatio:3,binaryType:"blob",reconnectOnCleanClose:!1},l=function h(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];u["default"](this,h),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.open=function(){var t=e._socket=new WebSocket(e._url,e._protocols);t.binaryType=e._options.binaryType,e._options.maxReconnectAttempts&&e._options.maxReconnectAttempts<e._reconnectAttempts||(e._syncState(),t.onmessage=e._onmessage.bind(e),t.onopen=e._onopen.bind(e),t.onclose=e._onclose.bind(e),t.onerror=e._onerror.bind(e))},this.send=function(t){e._socket&&e._socket.readyState===WebSocket.OPEN&&0===e._messageQueue.length?e._socket.send(t):e._messageQueue.push(t)},this.close=function(t,n){"undefined"==typeof t&&(t=1e3),e._socket&&e._socket.close(t,n)},this._onmessage=function(t){e.onmessage&&e.onmessage(t)},this._onopen=function(t){e._syncState(),e._flushQueue(),e._reconnectAttempts=0,e.onopen&&e.onopen(t)},this._onclose=function(t){e._syncState(),e._debug("WebSocket: connection is broken",t),e.onclose&&e.onclose(t),e._tryReconnect(t)},this._onerror=function(t){e._socket.close(),e._debug("WebSocket: error",t),e.onerror&&e.onerror(t),e._options.reconnectOnError&&e._tryReconnect(t)},this._tryReconnect=function(t){(!t.wasClean||e._options.reconnectOnCleanClose)&&setTimeout(function(){(e.readyState===e.CLOSING||e.readyState===e.CLOSED)&&(e._reconnectAttempts++,e.open())},e._getTimeout())},this._flushQueue=function(){for(;0!==e._messageQueue.length;){var t=e._messageQueue.shift();e._socket.send(t)}},this._getTimeout=function(){var t=e._options.reconnectInterval*Math.pow(e._options.reconnectDecay,e._reconnectAttempts);return t=t>e._options.maxReconnectInterval?e._options.maxReconnectInterval:t,e._options.randomRatio?o(t/e._options.randomRatio,t):t},this._syncState=function(){e.readyState=e._socket.readyState},this._url=t,this._protocols=n,this._options=s["default"]({},c,r),this._messageQueue=[],this._reconnectAttempts=0,this.readyState=this.CONNECTING,this._debug="function"==typeof this._options.debug?this._options.debug:this._options.debug?console.log.bind(console):function(){},r.automaticOpen&&this.open()};n["default"]=l,e.exports=n["default"]},{"babel-runtime/core-js/object/assign":13,"babel-runtime/helpers/classCallCheck":14}],54:[function(){!function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function n(t){return"string"!=typeof t&&(t=String(t)),t}function r(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return y.iterable&&(e[Symbol.iterator]=function(){return e}),e}function o(t){this.map={},t instanceof o?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function i(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function s(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function a(t){var e=new FileReader,n=s(e);return e.readAsArrayBuffer(t),n}function u(t){var e=new FileReader,n=s(e);return e.readAsText(t),n}function c(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}function l(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function h(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(y.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(y.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(y.arrayBuffer&&y.blob&&b(t))this._bodyArrayBuffer=l(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!g(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=l(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob&&(this.blob=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?i(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(t){var e=t.toUpperCase();return w.indexOf(e)>-1?e:t}function d(t,e){e=e||{};var n=e.body;if("string"==typeof t)this.url=t;else{if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new o(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}if(this.credentials=e.credentials||this.credentials||"omit",(e.headers||!this.headers)&&(this.headers=new o(e.headers)),this.method=f(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(o))}}),e}function m(t){var e=new o;return t.split("\r\n").forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var o=n.join(":").trim();e.append(r,o)}}),e}function _(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new o(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var y={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(y.arrayBuffer)var v=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],b=function(t){return t&&DataView.prototype.isPrototypeOf(t)},g=ArrayBuffer.isView||function(t){return t&&v.indexOf(Object.prototype.toString.call(t))>-1};o.prototype.append=function(t,r){t=e(t),r=n(r);var o=this.map[t];o||(o=[],this.map[t]=o),o.push(r)},o.prototype["delete"]=function(t){delete this.map[e(t)]},o.prototype.get=function(t){var n=this.map[e(t)];return n?n[0]:null},o.prototype.getAll=function(t){return this.map[e(t)]||[]},o.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},o.prototype.set=function(t,r){this.map[e(t)]=[n(r)]},o.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){t.call(e,r,n,this)},this)},this)},o.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),r(t)},o.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),r(t)},o.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),r(t)},y.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this,{body:this._bodyInit})},h.call(d.prototype),h.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},_.error=function(){var t=new _(null,{status:0,statusText:""});return t.type="error",t};var k=[301,302,303,307,308];_.redirect=function(t,e){if(-1===k.indexOf(e))throw new RangeError("Invalid status code");return new _(null,{status:e,headers:{location:t}})},t.Headers=o,t.Request=d,t.Response=_,t.fetch=function(t,e){return new Promise(function(n,r){var o=new d(t,e),i=new XMLHttpRequest;i.onload=function(){var t={status:i.status,statusText:i.statusText,
headers:m(i.getAllResponseHeaders()||"")};t.url="responseURL"in i?i.responseURL:t.headers.get("X-Request-URL");var e="response"in i?i.response:i.responseText;n(new _(e,t))},i.onerror=function(){r(new TypeError("Network request failed"))},i.ontimeout=function(){r(new TypeError("Network request failed"))},i.open(o.method,o.url,!0),"include"===o.credentials&&(i.withCredentials=!0),"responseType"in i&&y.blob&&(i.responseType="blob"),o.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send("undefined"==typeof o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},{}],55:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("../utils/isBlurred"),a=r(s),u=t("../utils/createElement"),c=r(u),l=t("../utils/addEvent"),h=r(l),f=function(){function t(e,n,r,i){o(this,t),this.parent=e,this.chatBody=n,this.localize=r,this.options=i,this.closeFlyoutOnBlur=this.closeFlyoutOnBlur.bind(this),this.actionMuteHandler=this.actionMuteHandler.bind(this),this.actionIgnoreHandler=this.actionIgnoreHandler.bind(this),this.actionBanHandler=this.actionBanHandler.bind(this),this.actionModHandler=this.actionModHandler.bind(this),this.render(),this._blurEvent=h["default"](document,"click",this.closeFlyoutOnBlur),this._blurEventTouch=h["default"](document,"touchend",this.closeFlyoutOnBlur)}return i(t,[{key:"render",value:function(){this.flyout=c["default"]({tagName:"div",className:"chat__actions-flyout "+this.options.modifierClass}),this.parent.parentElement.appendChild(this.flyout);var t=c["default"]({tagName:"div",className:"chat__actions-flyout-username",text:this.options.username});if(this.flyout.appendChild(t),this.options.url){var e=c["default"]({tagName:"a",className:"chat__actions-flyout-button",text:this.localize("View"),attributes:{href:this.options.url}});this.flyout.appendChild(e)}(this.chatBody.isMod()||this.chatBody.isAdmin())&&(this.muteButton=c["default"]({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Mute"),events:{click:this.actionMuteHandler}}),this.flyout.appendChild(this.muteButton),this.banButton=c["default"]({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Ban IP"),events:{click:this.actionBanHandler}}),this.flyout.appendChild(this.banButton),this.ignoreButton=c["default"]({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Ignore"),events:{click:this.actionIgnoreHandler}}),this.flyout.appendChild(this.ignoreButton)),this.chatBody.isAdmin()&&(this.modButton=c["default"]({tagName:"button",className:"chat__actions-flyout-button",text:this.localize(this.options.role?"Unmod":"Mod"),events:{click:this.actionModHandler}}),this.flyout.appendChild(this.modButton))}},{key:"actionModHandler",value:function(){var t=this;return this.modButton.textContent===this.localize("Unmod")?void this.chatBody.unmodActionHandler(this.options.username,function(){t.modButton.textContent=t.localize("Mod")}):void this.chatBody.modActionHandler(this.options.username,function(){t.modButton.textContent=t.localize("Unmod")})}},{key:"actionMuteHandler",value:function(){return this.muteButton.textContent===this.localize("Unmute")?void this.chatBody.unmuteActionHandler(this.options.username):(this.chatBody.muteActionHandler(this.options.username),void(this.muteButton.textContent=this.localize("Unmute")))}},{key:"actionIgnoreHandler",value:function(){return this.ignoreButton.textContent===this.localize("Unignore")?void this.chatBody.unignoreActionHandler(this.options.username):(this.chatBody.ignoreActionHandler(this.options.username),void(this.ignoreButton.textContent=this.localize("Unignore")))}},{key:"actionBanHandler",value:function(){return this.banButton.textContent===this.localize("Unban IP")?void this.chatBody.unbanActionHandler(this.options.username):(this.chatBody.banActionHandler(this.options.username),void(this.banButton.textContent=this.localize("Unban IP")))}},{key:"closeFlyoutOnBlur",value:function(t){a["default"](t,this.flyout,this.parent)&&this.close()}},{key:"close",value:function(){this._blurEvent(),this._blurEventTouch(),this._closed=!0,this.flyout.parentElement.removeChild(this.flyout)}}]),t}();n["default"]=f,e.exports=n["default"]},{"../utils/addEvent":66,"../utils/createElement":67,"../utils/isBlurred":68}],56:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("../utils/createElement"),c=r(u),l=t("./chat-flyout"),h=r(l),f=[{name:"rateLimitDuration",value:1,text:"1s"},{name:"rateLimitDuration",value:5,text:"5s"},{name:"rateLimitDuration",value:30,text:"30s"},{name:"rateLimitDuration",value:60,text:"1m"},{name:"rateLimitDuration",value:300,text:"5m"},{name:"rateLimitDuration",value:900,text:"15m"}],d=[{name:"rateLimitMax",value:1,text:"1 chat"},{name:"rateLimitMax",value:5,text:"5 chats"},{name:"rateLimitMax",value:10,text:"10 chats"}],p=[{name:"mode",value:"user",text:"Everyone"},{name:"mode",value:"moderator",text:"Moderators"},{name:"mode",value:"owner",text:"Owner"}],m=function(t){function e(t,n,r,s){o(this,e);var a=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"admin",r("admin")));return a.parent=t,a.chat=n,a.localize=r,a.errorHandler=s,a.handleRadioChange=a.handleRadioChange.bind(a),a}return s(e,t),a(e,[{key:"initUser",value:function(){this.chat._roomname&&this.chat._me&&("moderator"===this.chat._me.room.role||"owner"===this.chat._me.room.role||"admin"===this.chat._me.room.role)&&(this.render(),this.enableFlyout())}},{key:"render",value:function(){var t=c["default"]({tagName:"div",className:"chat__info chat__info--mode",text:this.localize("Chat Mode")});this.flyout.appendChild(t),this.radioRenderer(p);var e=c["default"]({tagName:"div",className:"chat__description chat__description--mode",text:this.localize("The current mode of the room specifying which users can chat")});this.flyout.appendChild(e);var n=c["default"]({tagName:"div",className:"chat__info",text:this.localize("Chat Rate Limit")});this.flyout.appendChild(n),this.radioRenderer(d),this.radioRenderer(f);var r=c["default"]({tagName:"div",className:"chat__description",text:this.localize("Maximum amount of chats during time period")});this.flyout.appendChild(r)}},{key:"radioRenderer",value:function(t){for(var e=[],n=0;n<t.length;n++){var r=c["default"]({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:t[n].name,value:t[n].value,id:t[n].name+n},events:{change:this.handleRadioChange}});this.chat._room[t[n].name]===t[n].value&&(r.checked="checked"),e.push(r);var o=c["default"]({tagName:"label",className:"chat__radio-label chat__radio-label--"+t.length,text:this.localize(t[n].text),attributes:{"for":t[n].name+n}});e.push(o)}var i=c["default"]({tagName:"div",className:"chat__radio-slider chat__radio-slider--"+t.length});e.push(i);var s=c["default"]({tagName:"div",className:"chat__radio-wrapper",childs:e}),a=c["default"]({tagName:"div",className:"chat__radio-container chat__radio-container--restricted chat__radio-container--"+t[0].name,childs:[s]});this.flyout.appendChild(a)}},{key:"handleRadioChange",value:function(t){var e=this,n={};n[t.target.name]=isNaN(t.target.value)?t.target.value:parseInt(t.target.value,10),this.chat.patchRoom(this.chat._roomname,n,function(t,n){t&&n&&n[0]&&e.errorHandler(t,n[0])})}}]),e}(h["default"]);n["default"]=m,e.exports=n["default"]},{"../utils/createElement":67,"./chat-flyout":60}],57:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("../utils/createElement"),a=r(s),u=t("../utils/addEvent"),c=r(u),l=t("./chat-actions-flyout"),h=r(l),f=function(){function t(e,n,r,i,s){var a=this;o(this,t),this.parent=e,this.chat=n,this.localize=r,this.errorHandler=i,this.options=s,this._chatLineQueue=[],this._currentChunk=this.buildChunkElement(),this._currentChunkSize=0,this._chunkView=[],this._chunkHistory=[],this._chunkStorage=[],this._scrollLocked=!0,this._scrollPaused=!1,this._scrollThrottleCount=0,this._scrollThrottleRate=100,this._scrollThrottleNewRate=!1,this.scrollToggle=this.scrollToggle.bind(this),this.scrollWheelHandler=this.scrollWheelHandler.bind(this),this.actionDelete=this.actionDelete.bind(this),this.actionMore=this.actionMore.bind(this),this.render(),this._queueProcess=setInterval(function(){a.queueProcessor()},100),setTimeout(function(){a._scrollThrottleCount=0,a._scrollThrottleInterval=setInterval(function(){a.scrollThrottleHandler()},2e3)},500),this._wheelListener1=c["default"](this.chatBody,"DOMMouseScroll",this.scrollWheelHandler),this._wheelListener2=c["default"](this.chatBody,"mousewheel",this.scrollWheelHandler),this._wheelListener3=c["default"](this.chatBody,"wheel",this.scrollWheelHandler)}return i(t,[{key:"queueProcessor",value:function(){if(!this._scrollPaused){this._chatLineQueue.length&&this._scrollThrottleCount++;for(var t=document.createDocumentFragment();this._chatLineQueue.length&&this._currentChunkSize!==this.options.chunkSize;){var e=this._chatLineQueue.shift();t.appendChild(e),this._currentChunkSize++}if(this._currentChunk.appendChild(t),this._currentChunk.parentElement||this._chunkStorage.push(this._currentChunk),this._currentChunkSize===this.options.chunkSize&&(this._currentChunk=this.buildChunkElement(),this._currentChunksProcessed++,this._currentChunkSize=0),this._chatLineQueue.length)return void this.queueProcessor();for(var n=document.createDocumentFragment(),r=this._chunkStorage.splice(-Math.abs(this.options.chunkView));r.length;){var o=r.shift();n.appendChild(o),this._chunkView.push(o)}for(this.chatBody.appendChild(n);this._chunkView.length>this.options.chunkView;){var i=this._chunkView.shift();this.chatBody.removeChild(i),this._chunkHistory.unshift(i)}for(;this._chunkStorage.length;)this._chunkHistory.unshift(this._chunkStorage.shift());for(;this._chunkHistory>this.options.chunkHistory;)this._chunkHistory.shift();this.scrollBottom()}}},{key:"scrollThrottleHandler",value:function(){var t=this;switch(this._scrollThrottleNewRate&&(this._scrollThrottleNewRate=!1,this._scrollThrottleCount++),this._scrollThrottleRate){case 100:this._scrollThrottleCount>=10&&(this._scrollThrottleRate=200,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){t.queueProcessor()},this._scrollThrottleRate));break;case 200:this._scrollThrottleCount>=10?(this._scrollThrottleRate=250,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){t.queueProcessor()},this._scrollThrottleRate)):this._scrollThrottleCount<5&&(this._scrollThrottleRate=100,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){t.queueProcessor()},this._scrollThrottleRate));break;default:this._scrollThrottleCount<8&&(this._scrollThrottleRate=200,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){t.queueProcessor()},this._scrollThrottleRate))}this._scrollThrottleCount=0}},{key:"processChat",value:function(t){if(!t.ignore){var e=this.buildLineElement(),n=this.writeChatToLine(e,t);this._chatLineQueue.push(n)}}},{key:"processMessage",value:function(t){var e=this.buildLineElement(),n=this.writeMessageToLine(e,t);this._chatLineQueue.push(n)}},{key:"render",value:function(){this.chatBody=a["default"]({tagName:"div",className:"chat__body"}),this.chatBodyContainer=a["default"]({tagName:"div",className:"chat__body-container",childs:[this.chatBody]}),this.chatBodyScrollButton=a["default"]({tagName:"div",className:"chat__body-scroll",events:{click:this.scrollToggle}}),this.parent.appendChild(this.chatBodyContainer),this.parent.appendChild(this.chatBodyScrollButton)}},{key:"buildChunkElement",value:function(){return this._chunkElement?this._chunkElement.cloneNode():(this._chunkElement=a["default"]({tagName:"div",className:"chat__chunk"}),this._chunkElement.cloneNode(!0))}},{key:"buildLineElement",value:function(){if(this._lineElement)return this._lineElement.cloneNode(!0);var t=[],e=a["default"]({tagName:"div",className:"chat__avatar"});t.push(e);var n=a["default"]({tagName:"span",className:"chat__line-role"});t.push(n);var r=a["default"]({tagName:"span",className:"chat__username"});t.push(r);var o=a["default"]({tagName:"span",className:"chat__line-timestamp"});t.push(o);var i=a["default"]({tagName:"div",className:"chat__line-content"});t.push(i);var s=a["default"]({tagName:"button",className:"chat__action chat__action--delete",attributes:{"data-tooltip":"Delete Chat"}});t.push(s);var u=a["default"]({tagName:"button",className:"chat__action chat__action--more",attributes:{"data-tooltip":"More Actions"}});return t.push(u),this._lineElement=a["default"]({tagName:"div",className:"chat__line",childs:t}),this._lineElement.cloneNode(!0)}},{key:"writeChatToLine",value:function(t,e){var n=t,r=n.childNodes;return r[0].setAttribute("style","background-color: "+e.actor.color+"; background-image: url("+e.actor.avatar+");"),r[1].className="chat__line-role chat__line-role--"+e.actor.role,r[1].textContent=e.actor.role,r[2].setAttribute("style","color: "+e.actor.color),r[2].textContent=e.actor.username,r[3].textContent=this.formatDate(e.timestamp),r[4].innerHTML=this.parseChatText(e),n.className="chat__line"+(e.actor.username===this.chat._username?" chat__line--currentUser":""),n.setAttribute("data-username",e.actor.username),n.setAttribute("data-id",e.id),"moderator"===e.actor.role&&n.setAttribute("data-role",e.actor.role),e.url&&n.setAttribute("data-url",e.url),c["default"](r[5],"click",this.actionDelete),c["default"](r[6],"click",this.actionMore),n}},{key:"writeMessageToLine",value:function(t,e){var n=t,r=n.childNodes,o="";switch(e.level){case"warn":o="#EBC844";break;case"info":o="#1395BA";break;default:o="#D94E1F"}r[0].setAttribute("style","background-color: "+o+"; background-image: none;"),r[1].className="",r[1].textContent="",r[2].setAttribute("style","color: "+o),r[2].textContent=e.level,r[3].textContent="",r[4].innerHTML='<div class="chat__text">'+e.message+"</div>",n.className="chat__line chat__line--message chat__line--"+e.level;var i=function(t){t.parentElement.removeChild(t)}.bind(this,n);return c["default"](r[5],"click",i),n}},{key:"formatDate",value:function(t){var e=new Date(1e3*t),n="0"+e.getMinutes(),r=e.getHours();return r%=12,r=r||12,r+":"+n.substr(-2)}},{key:"parseChatText",value:function(t){var e="<div class='chat__text'>",n=t.message,r=t.positions,o=0;for(var i in r){i=parseInt(i,10);var s=n.slice(o,i),a=n.slice(i,i+r[i].length);switch(o=i+r[i].length,s.length&&(e+=s),r[i].type){case"emoticon":this.chat&&this.chat._me&&this.chat._me.showGifs,e+="<span class='chat__line-emoticon-wrap' data-pattern='"+a+"'><img class='chat__line-emoticon' src='"+r[i].url+"'/></span>";break;case"mention":var u=this.chat._username===r[i].username?"chat__line-mention chat__line-mention--me":"chat__line-mention";e+="<a class='"+u+"' href='/"+r[i].url+"' target='_blank'>"+a+"</a>";break;case"tag":e+="<a class='chat__line-tag' href='/tag/"+r[i].text+"' target='_blank'>"+a+"</a>";break;default:e+="<a class='chat__line-link' href='"+r[i].href+"' target='_blank'>"+a+"</a>"}}return o<n.length&&(e+=n.slice(o)),e+="</div>"}},{key:"scrollToggle",value:function(){return this._scrollPaused?(this._scrollPaused=!1,void this.chatBodyScrollButton.classList.remove("chat__body-scroll--paused")):(this._scrollPaused=!0,void this.chatBodyScrollButton.classList.add("chat__body-scroll--paused"))}},{key:"scrollBottom",value:function(){this.chatBody.scrollTop=this.chatBody.scrollHeight}},{key:"scrollWheelHandler",value:function(){if(this.chatBody.scrollTop<=0&&this._scrollPaused&&this._chunkHistory.length){var t=this._chunkHistory.shift();return this.chatBody.insertBefore(t,this.chatBody.firstChild),void this._chunkView.unshift(t)}return Math.abs(this.chatBody.scrollTop-(this.chatBody.scrollHeight-this.chatBody.offsetHeight))<=5?void(this._scrollPaused&&this.scrollToggle()):void(this._scrollPaused||this.scrollToggle())}},{key:"isMod",value:function(){return this.chat._me&&this.chat._me.room&&this.chat._me.room.role?"moderator"===this.chat._me.room.role:!1}},{key:"isAdmin",value:function(){return this.chat._me&&this.chat._me.room&&this.chat._me.room.role?"owner"===this.chat._me.room.role||"admin"===this.chat._me.room.role:!1}},{key:"actionDelete",value:function(t){var e=t.target.parentElement.getAttribute("data-id");this.chat.command("/delete "+e)}},{key:"actionMore",value:function(t){var e={username:t.target.parentElement.getAttribute("data-username"),id:t.target.parentElement.getAttribute("data-id"),url:t.target.parentElement.getAttribute("data-url"),role:t.target.parentElement.getAttribute("data-role")};return this.flyout&&!this.flyout._closed&&e.id===this.flyout.options.id?(this.flyout.close(),void(this.flyout=!1)):void(this.flyout=new h["default"](t.target,this,this.localize,e))}},{key:"modActionHandler",value:function(t,e){var n=this;this.chat.command("/mod "+t,function(t,r){return t||r&&r[0]?void n.errorHandler(t,r[0]):void(e&&e())})}},{key:"unmodActionHandler",value:function(t,e){var n=this;this.chat.command("/unmod "+t,function(t,r){return t||r&&r[0]?void n.errorHandler(t,r[0]):void(e&&e())})}},{key:"muteActionHandler",value:function(t,e){var n=this;this.chat.command("/mute "+t,function(t,r){return t||r&&r[0]?void n.errorHandler(t,r[0]):void(e&&e())}),this.deleteByUsername(t)}},{key:"unmuteActionHandler",value:function(t,e){var n=this;this.chat.command("/unmute "+t,function(t,r){return t||r&&r[0]?void n.errorHandler(t,r[0]):void(e&&e())})}},{key:"ignoreActionHandler",value:function(t,e){var n=this;this.chat.command("/ignore "+t,function(t,r){return t||r&&r[0]?void n.errorHandler(t,r[0]):void(e&&e())}),this.deleteByUsername(t,!0)}},{key:"unignoreActionHandler",value:function(t,e){var n=this;this.chat.command("/unignore "+t,function(t,r){return t||r&&r[0]?void n.errorHandler(t,r[0]):void(e&&e())})}},{key:"banActionHandler",value:function(t,e){var n=this;this.chat.command("/ban "+t,function(t,r){return t||r&&r[0]?void n.errorHandler(t,r[0]):void(e&&e())}),this.deleteByUsername(t)}},{key:"unbanActionHandler",value:function(t,e){var n=this;this.chat.command("/unban "+t,function(t,r){return t||r&&r[0]?void n.errorHandler(t,r[0]):void(e&&e())})}},{key:"deleteById",value:function(t){for(var e=0;e<this._chunkView.length;e++)for(var n=this._chunkView[e].childNodes,r=0;r<n.length;r++)if(n[r].getAttribute("data-id")===t){if(this.isMod||this.isAdmin)return void n[r].classList.add("chat__line--removed");n[r].parentElement.removeChild(n[r])}}},{key:"deleteByUsername",value:function(t,e){for(var n=0;n<this._chunkView.length;n++)for(var r=this._chunkView[n].childNodes,o=0;o<r.length;o++)if(r[o].getAttribute("data-username")===t){if(e)return void r[o].parentElement.removeChild(r[o]);this.actionDelete(r[o].getAttribute("data-id"))}}},{key:"destroy",value:function(){this._wheelListener1(),this._wheelListener2(),this._wheelListener3()}}]),t}();n["default"]=f,e.exports=n["default"]},{"../utils/addEvent":66,"../utils/createElement":67,"./chat-actions-flyout":55}],58:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("../utils/createElement"),a=r(s),u=function(){function t(e){o(this,t),this.parent=e,this.render()}return i(t,[{key:"render",value:function(){this.el=a["default"]({tagName:"div",className:"chat__controls"}),this.parent.appendChild(this.el)}}]),t}();n["default"]=u,e.exports=n["default"]},{"../utils/createElement":67}],59:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("../utils/createElement"),c=r(u),l=t("./chat-flyout"),h=r(l),f=function(t){function e(t,n,r,s,a){o(this,e);var u=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"emoticons",s("emoticons")));return u.parent=t,u.chat=n,u.chatInput=r,u.localize=s,u.errorHandler=a,u}return s(e,t),a(e,[{key:"initUser",value:function(){this.enableFlyout()}},{key:"getEmoticons",value:function(){var t=this;this.chat.getAllEmoticons(this.chat._roomname,this.chat._username,function(e,n){e&&t.errorHandler(e,t.localize("Chat Error")),t.emoticons=n.emoticons,t.render()})}},{key:"firstToggleHandler",value:function(){this.getEmoticons()}},{key:"render",value:function(){var t=this;Object.keys(this.emoticons).map(function(e){var n=t.emoticons[e],r=c["default"]({tagName:"button",className:"chat__emoticon-selector",attributes:{style:"background-image: url("+n.source+")",title:n.pattern}}),o=c["default"]({tagName:"span",className:"chat__emoticon-selector-container",childs:[r]}),i=t.selectEmoticon.bind(t,n.pattern);return o.addEventListener("click",i),t.flyout.appendChild(o)}),this.parent.appendChild(this.flyout);var e=c["default"]({tagName:"a",className:"chat__attribution-link",text:"EmojiOne",attributes:{href:"http://emojione.com"}}),n=c["default"]({tagName:"div",className:"chat__attribution",text:"Emoji provided free by ",childs:[e]});this.flyout.appendChild(n)}},{key:"selectEmoticon",value:function(t){this.chatInput.chatInput.value=""+this.chatInput.chatInput.value+t+" ",this.chatInput.chatInput.focus(),this.toggleFlyout()}}]),e}(h["default"]);n["default"]=f,e.exports=n["default"]},{"../utils/createElement":67,"./chat-flyout":60}],60:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("../utils/isBlurred"),a=r(s),u=t("../utils/createElement"),c=r(u),l=t("../utils/addEvent"),h=r(l),f=function(){function t(e,n,r){o(this,t),this.parent=e,this.flyoutClassModifier=n,this.tooltipText=r,this._firstToggle=!0,this.toggleFlyout=this.toggleFlyout.bind(this),this.closeFlyoutOnBlur=this.closeFlyoutOnBlur.bind(this),this.flyoutRender()}return i(t,[{key:"flyoutRender",value:function(){var t=c["default"]({tagName:"span",className:"chat__tooltip chat__tooltip--"+this.flyoutClassModifier,text:this.tooltipText});this.flyoutButton=c["default"]({tagName:"button",className:"chat__flyout-button chat__flyout-button--"+this.flyoutClassModifier+" chat__flyout-button--disabled",childs:[t]}),this.parent.appendChild(this.flyoutButton),this.flyout=c["default"]({tagName:"div",className:"chat__flyout chat__flyout--"+this.flyoutClassModifier}),this.parent.parentElement.appendChild(this.flyout)}},{key:"enableFlyout",value:function(){this.flyoutButton.classList.remove("chat__flyout-button--disabled"),h["default"](this.flyoutButton,"click",this.toggleFlyout)}},{key:"closeFlyoutOnBlur",value:function(t){a["default"](t,this.flyout,this.flyoutButton)&&(this._blurEvent(),this._blurEventTouch(),this._blurEvent=null,this.flyout.classList.remove("chat__flyout--visible"))}},{key:"toggleFlyout",value:function(){this._firstToggle&&this.firstToggleHandler&&(this._firstToggle=!1,this.firstToggleHandler()),this.flyout.classList.toggle("chat__flyout--visible"),this._blurEvent||(this._blurEvent=h["default"](document,"click",this.closeFlyoutOnBlur),this._blurEventTouch=h["default"](document,"touchend",this.closeFlyoutOnBlur))}}]),t}();n["default"]=f,e.exports=n["default"]},{"../utils/addEvent":66,"../utils/createElement":67,"../utils/isBlurred":68}],61:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("../utils/createElement"),a=r(s),u=function(){function t(e,n,r,i,s){o(this,t),this.parent=e,this.chat=n,this.chatBody=r,this.localize=i,this.errorHandler=s,this.send=this.send.bind(this),this.render()}return i(t,[{key:"initUser",value:function(){this.chatInput.classList.remove("chat__input--disabled"),this.chatInput.removeAttribute("disabled"),this.chatInput.setAttribute("placeholder",this.localize("Send message")),this.chatSend.classList.remove("chat__input-send--disabled"),this.chatSend.removeAttribute("disabled")}},{key:"render",value:function(){var t=this;this.chatInput=a["default"]({tagName:"input",className:"chat__input chat__input--disabled",attributes:{placeholder:this.localize("Login to chat"),disabled:"disabled"}});var e=a["default"]({tagName:"span",className:"chat__tooltip chat__tooltip--send",text:this.localize("send")});this.chatSend=a["default"]({tagName:"button",className:"chat__flyout-button chat__input-send chat__input-send--disabled",attributes:{disabled:"disabled"},events:{click:this.send},childs:[e]}),this.chatInputWrapper=a["default"]({tagName:"div",className:"chat__input-wrapper",childs:[this.chatInput,this.chatSend]}),this.chatInput.addEventListener("keyup",function(e){e.preventDefault(),13===e.keyCode&&t.send()}),this.parent.appendChild(this.chatInputWrapper)}},{key:"send",value:function(){var t=this,e=this.chatInput.value;return null!==e.match(/^\s+$/)?void(this.chatInput.value=""):void(e&&(this.chatInput.value="",this.chat.command(e,function(e,n){if(e)throw e;if(n&&n.length)for(var r=0;r<n.length;r++){if(n[r].data&&n[r].data.help){for(var o in n[r].data.help){var i=n[r].data.help[o];t.chatBody.processMessage({level:"info",message:"/"+i.name+" "+i.text})}return}t.chatBody.processMessage(n[r])}})))}}]),t}();n["default"]=u,e.exports=n["default"]},{"../utils/createElement":67}],62:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("../utils/createElement"),c=r(u),l=t("./chat-flyout"),h=r(l),f=function(t){function e(t,n,r,s){o(this,e);var a=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"options",r("options")));return a.parent=t,a.chat=n,a.localize=r,a.errorHandler=s,a.showGifsHandler=a.showGifsHandler.bind(a),a.showTimestampsHandler=a.showTimestampsHandler.bind(a),a}return s(e,t),a(e,[{key:"initUser",value:function(){this.enableFlyout(),this.renderOptions()}},{key:"renderOptions",value:function(){var t=c["default"]({tagName:"div",className:"chat__options-switch-slider"}),e=c["default"]({tagName:"div",className:"chat__options-switch-name",text:this.localize("Show Animated Gifs")}),n=c["default"]({tagName:"input",className:"chat__options-switch-checkbox",attributes:{type:"checkbox",id:"showGifs"},events:{change:this.showGifsHandler}});this.chat._me.showGifs&&(n.checked=!0);var r=c["default"]({tagName:"label",className:"chat__options-switch",childs:[t],attributes:{"for":"showGifs"}}),o=c["default"]({tagName:"div",className:"chat__options-switch-container",childs:[n,r,e]}),i=c["default"]({tagName:"div",className:"chat__options-switch-slider"}),s=c["default"]({tagName:"div",className:"chat__options-switch-name",text:this.localize("Show Timestamps")}),a=c["default"]({tagName:"input",className:"chat__options-switch-checkbox",attributes:{type:"checkbox",id:"showTimestamps"},events:{change:this.showTimestampsHandler}});this.chat._me.showTimestamps&&(a.checked=!0);var u=c["default"]({tagName:"label",className:"chat__options-switch",childs:[i],attributes:{"for":"showTimestamps"}}),l=c["default"]({tagName:"div",className:"chat__options-switch-container",childs:[a,u,s]});this.flyout.appendChild(l),this.flyout.appendChild(o)}},{key:"showGifsHandler",value:function(t){var e=this,n={};n.showGifs=t.target.checked,this.chat.patchUser(this.chat._username,n,function(t,n){t&&n&&e.errorHandler(t,n[0])})}},{key:"showTimestampsHandler",value:function(t){var e=this,n={};n.showTimestamps=t.target.checked,this.chat.patchUser(this.chat._username,n,function(t,n){t&&n&&e.errorHandler(t,n[0])})}}]),e}(h["default"]);n["default"]=f,e.exports=n["default"]},{"../utils/createElement":67,"./chat-flyout":60}],63:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{
value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("../utils/createElement"),a=r(s),u=function(){function t(e,n,r){o(this,t),this.parent=e,this.onClick=n,this.localize=r,this.render()}return i(t,[{key:"render",value:function(){var t=a["default"]({tagName:"span",className:"chat__tooltip",text:this.localize("popout")});this.el=a["default"]({tagName:"button",className:"chat__flyout-button chat__flyout-button--popout",events:{click:this.onClick},childs:[t]}),this.parent.appendChild(this.el)}}]),t}();n["default"]=u,e.exports=n["default"]},{"../utils/createElement":67}],64:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("../utils/createElement"),c=r(u),l=t("./chat-flyout"),h=r(l),f=t("./chat-actions-flyout"),d=r(f),p=function(t){function e(t,n,r,s,a,u){o(this,e);var c=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"roster",s("roster")));return c.parent=t,c.chat=n,c.chatBody=r,c.localize=s,c.errorHandler=a,c.options=u,c.updateRoster=c.updateRoster.bind(c),c.cleanUpdateRoster=c.cleanUpdateRoster.bind(c),c.handleRadioChange=c.handleRadioChange.bind(c),c.loadMoreHandler=c.loadMoreHandler.bind(c),c.actionMore=c.actionMore.bind(c),c}return s(e,t),a(e,[{key:"initUser",value:function(){this.render(),this.roster=this.chat.getRoster({limit:this.options.rosterLimit,role:""}),this.roster.update(this.updateRoster),this.enableFlyout()}},{key:"render",value:function(){this.rosterRadioUser=c["default"]({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:"rosterSort",value:"",checked:"checked",id:"rosterSortUser"},events:{change:this.handleRadioChange}}),this.rosterRadioModerator=c["default"]({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:"rosterSort",value:"moderator",id:"rosterSortModerator"},events:{change:this.handleRadioChange}}),this.rosterRadioUserLabel=c["default"]({tagName:"label",className:"chat__radio-label",text:this.localize("Everyone"),attributes:{"for":"rosterSortUser"}}),this.rosterRadioModeratorLabel=c["default"]({tagName:"label",className:"chat__radio-label",text:this.localize("Moderators"),attributes:{"for":"rosterSortModerator"}}),this.rosterRadioWrapper=c["default"]({tagName:"div",className:"chat__radio-wrapper",childs:[this.rosterRadioUser,this.rosterRadioUserLabel,this.rosterRadioModerator,this.rosterRadioModeratorLabel]}),this.rosterRadioContainer=c["default"]({tagName:"div",className:"chat__radio-container chat__radio-container--sort",childs:[this.rosterRadioWrapper]}),this.rosterLoadMore=c["default"]({tagName:"button",className:"chat__roster-load-more",text:this.localize("Load More"),events:{click:this.loadMoreHandler}}),this.rosterContainer=c["default"]({tagName:"div",className:"chat__roster-container"}),this.rosterScrollContainer=c["default"]({tagName:"div",className:"chat__roster-scroll",childs:[this.rosterContainer,this.rosterLoadMore]}),this.flyout.appendChild(this.rosterRadioContainer),this.flyout.appendChild(this.rosterScrollContainer)}},{key:"handleRadioChange",value:function(t){var e={limit:this.options.rosterLimit};e.role=t.target.value,this.roster._options=e,this.roster.update(this.cleanUpdateRoster)}},{key:"loadMoreHandler",value:function(){this.roster.next(this.updateRoster)}},{key:"cleanUpdateRoster",value:function(t,e){for(;this.rosterContainer.firstChild;)this.rosterContainer.removeChild(this.rosterContainer.firstChild);this.updateRoster(t,e)}},{key:"updateRoster",value:function(t,e){if(t)return void this.errorHandler(t,{message:this.localize("Error updating roster"),level:"error"});for(var n=0;n<e.length;n++){var r=[];if("user"!==e[n].role){var o=c["default"]({tagName:"span",className:"chat__roster-role",text:e[n].role,attributes:{style:"background:"+e[n].roleColor}});r.push(o)}var i=c["default"]({tagName:"span",className:"chat__roster-actor",text:e[n].username});r.push(i);var s=c["default"]({tagName:"button",className:"chat__action chat__action--more chat__action--roster",attributes:{"data-tooltip":"More Actions"},events:{click:this.actionMore}});r.push(s);var a=c["default"]({tagName:"div",className:"chat__roster-actor-container",childs:r,attributes:{"data-username":e[n].username,"data-role":e[n].role}});this.rosterContainer.appendChild(a)}return this.roster._nextParams?void this.rosterLoadMore.classList.remove("chat__roster-load-more--disable"):void this.rosterLoadMore.classList.add("chat__roster-load-more--disable")}},{key:"actionMore",value:function(t){var e={username:t.target.parentElement.getAttribute("data-username"),id:t.target.parentElement.getAttribute("data-username"),role:t.target.parentElement.getAttribute("data-role"),modifierClass:"chat__actions-flyout--roster"};return this.actionsFlyout&&!this.actionsFlyout._closed&&e.id===this.actionsFlyout.options.id?(this.actionsFlyout.close(),void(this.actionsFlyout=!1)):void(this.actionsFlyout=new d["default"](t.target,this.chatBody,this.localize,e))}}]),e}(h["default"]);n["default"]=p,e.exports=n["default"]},{"../utils/createElement":67,"./chat-actions-flyout":55,"./chat-flyout":60}],65:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("@livelyvideo/chat-core/lib"),c=r(u),l=t("@livelyvideo/localization"),h=r(l);t("classlist-polyfill");var f=t("./components/chat-body"),d=r(f),p=t("./components/chat-emoticons"),m=r(p),_=t("./components/chat-input"),y=r(_),v=t("./components/chat-options"),b=r(v),g=t("./components/chat-roster"),w=r(g),k=t("./components/chat-admin"),E=r(k),x=t("./components/chat-controls"),T=r(x),O=t("./components/chat-popout"),j=r(O),C=t("./utils/popout"),N=r(C),P=t("./utils/createElement"),A=r(P),B={user:null,room:null,host:null,authUrl:null,popout:null,chunkHistory:20,chunkSize:10,chunkView:5,rosterLimit:100,locale:null,messages:null,debug:!1},S=function(){function t(e,n){o(this,t),this.options=s({},B,n);var r=new h["default"](this.options.locale,this.options.messages);this.localize=r.localize.bind(r),this.errorHandler=this.errorHandler.bind(this),this.mount(e),this.init()}return a(t,[{key:"init",value:function(){this.chat=new c["default"]({room:this.options.room,host:this.options.host},{url:this.options.authUrl}),this.render(),this.initUnauthedUser()}},{key:"mount",value:function(t){switch("undefined"==typeof t?"undefined":i(t)){case"string":this.el=document.querySelector(t);break;case"object":this.el=t;break;default:console.warn(this.localize("Invalid Element"))}this.el.classList.add("chat")}},{key:"errorHandler",value:function(t,e){var n=void 0;n="object"===("undefined"==typeof e?"undefined":i(e))?e:{message:this.localize("Chat Error"),level:"error"},this.chatBody&&this.chatBody.processMessage(n),this.options.debug&&console.error(t,n)}},{key:"render",value:function(){var t=this;this.chatBody=new d["default"](this.el,this.chat,this.localize,this.errorHandler,this.options),this.chatInput=new y["default"](this.el,this.chat,this.chatBody,this.localize),this.chatEmoticons=new m["default"](this.el,this.chat,this.chatInput,this.localize,this.errorHandler),this.chatControls=new T["default"](this.el),this.options.popout&&(this.chatPopout=new j["default"](this.chatControls.el,this.openPopout.bind(this),this.localize)),this.chatAdmin=new E["default"](this.chatControls.el,this.chat,this.localize,this.errorHandler,this.options),this.chatRoster=new w["default"](this.chatControls.el,this.chat,this.chatBody,this.localize,this.errorHandler,this.options),this.chatOptions=new b["default"](this.chatControls.el,this.chat,this.localize,this.errorHandler),this.chat.on("chat",function(e){return t.chatBody.processChat(e)}),this.chat.once("room",function(e){t.chat._roomname=e.name}),this.chat.on("message",function(e){return t.chatBody.processMessage(e)}),this.chat.on("delete",function(e){return t.chatBody.deleteById(e.id)})}},{key:"initUnauthedUser",value:function(){var t=this;this.chat.on("error",function(e){return t.errorHandler(e)}),this.chat.once("me",function(e){if(t.chat._username=e.username,t.history)for(var n=0;n<t.history.messages.length;n++)t.chatBody.processChat(t.history.messages[n]);return e?(t.meHandler(e),void t.initAuthedUser(e)):void t.roleHandler({room:{role:"anon"}})}),this.history=null,this.chat.once("history",function(e){t.history=e})}},{key:"initAuthedUser",value:function(t){var e=this;this.chatOptions.initUser(),this.chatEmoticons.initUser(),this.chatInput.initUser(),this.chatRoster.initUser(),this.chatAdmin.initUser(),this._currentRole=t.room.role,this.chat.on("me",function(t){return e.meHandler(t)})}},{key:"meHandler",value:function(t){this.roleHandler(t),t.showTimestamps?this.el.classList.add("chat--timestamps"):this.el.classList.remove("chat--timestamps")}},{key:"roleHandler",value:function(t){if(this._currentRole&&this._currentRole!==t.room.role){var e={};switch(e.level="info",this._currentRole){case"user":e.message=this.localize("You have been modded");break;default:e.message=this.localize("You have been unmodded")}this.chatBody.processMessage(e)}this._currentRole=t.room.role;var n="chat";this.chatBody.isMod()&&(n+=" chat--isMod"),this.chatBody.isAdmin()&&(n+=" chat--isAdmin"),this.el.className=n}},{key:"openPopout",value:function(){var t=this;this.popout=new N["default"](this.options.popout,{width:340,height:640}),this._unmountClose=this.popout.on("close",function(){setTimeout(function(){t.popout&&t.popout.instance&&t.popout.instance.closed&&t.closePopout()},250)}),this.destroy(),this.renderNoPopout()}},{key:"closePopout",value:function(){this.popout&&(this.popout.close(),this.popout=null),this._unmountClose&&(this._unmountClose=null),this.destroyNoPopout(),this.init()}},{key:"renderNoPopout",value:function(){var t=A["default"]({tagName:"div",className:"chat__poppedout-text",text:"Your chat is popped out"});this._popoutEl=A["default"]({tagName:"div",className:"chat__poppedout",childs:[t]}),this.el.appendChild(this._popoutEl)}},{key:"destroyNoPopout",value:function(){this.el.removeChild(this._popoutEl)}},{key:"destroy",value:function(){for(this.chat.destroy(),this.chatBody.destroy(),this.el.className="chat";this.el.firstChild;)this.el.removeChild(this.el.firstChild)}}]),t}();n["default"]=S,e.exports=n["default"]},{"./components/chat-admin":56,"./components/chat-body":57,"./components/chat-controls":58,"./components/chat-emoticons":59,"./components/chat-input":61,"./components/chat-options":62,"./components/chat-popout":63,"./components/chat-roster":64,"./utils/createElement":67,"./utils/popout":69,"@livelyvideo/chat-core/lib":7,"@livelyvideo/localization":12,"classlist-polyfill":15}],66:[function(t,e,n){"use strict";function r(t,e,n){if(t.addEventListener){t.addEventListener(e,n);var r=function(){t.removeEventListener(e,n)};return r}t.attachEvent("on"+e,function(){n.call(t)});var o=function(){t.detachEvent("on"+e,function(){n.call(t)})};return o}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r,e.exports=n["default"]},{}],67:[function(t,e,n){"use strict";function r(t){var e=void 0,n=void 0,o=void 0;if(t.tagName){if(e=document.createElement(t.tagName),t.className&&(e.className=t.className),t.attributes)for(n in t.attributes)e.setAttribute(n,t.attributes[n]);void 0!==t.html&&(e.innerHTML=t.html)}else e=document.createDocumentFragment();if(t.text&&e.appendChild(document.createTextNode(t.text)),void 0===window.HTMLElement&&(window.HTMLElement=Element),t.childs&&t.childs.length)for(o=0;o<t.childs.length;o++)e.appendChild(t.childs[o]instanceof window.HTMLElement?t.childs[o]:r(t.childs[o]));if(t.events)for(var i in t.events)e.addEventListener(i,t.events[i]);return e}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r,e.exports=n["default"]},{}],68:[function(t,e,n){"use strict";function r(t,e,n){for(var r=t.target;r&&r!==document.body;){if(r===e||r===n)return!1;r=r.parentNode}return!0}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r,e.exports=n["default"]},{}],69:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("events"),c={width:640,height:550,toolbar:!1,menubar:!1,location:!1,status:!1,scrollbars:!1,resizable:!0,left:0,top:0},l=function(t){function e(t,n){r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(!(i instanceof e)){var a;return a=new e(t,n),o(i,a)}i.options=s({},c,n);var u=i.getParamsString(n);return i.instance=window.open(t,Date.now(),u),setTimeout(function(){return i.onPopupLoad()}),setTimeout(function(){return i.onPopupLoad()},250),i}return i(e,t),a(e,[{key:"onBeforeUnload",value:function(t){var e=this;this.emit("close",t),setTimeout(function(){e.instance.closed||(e.instance.onbeforeunload=e.onBeforeUnload.bind(e))},250)}},{key:"close",value:function(){this.instance.close()}},{key:"onPopupLoad",value:function(){try{this.instance.isPopup=!0,this.instance.onbeforeunload=this.onBeforeUnload.bind(this)}catch(t){}}},{key:"getParamsString",value:function(t){var e=[];for(var n in t)e.push(n+"="+t[n]);return e=e.join(",")}}]),e}(u.EventEmitter);n["default"]=l,e.exports=n["default"]},{events:52}]},{},[65])(65)});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}]},{},[1]);
