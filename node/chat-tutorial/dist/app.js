(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _chat = require('@livelyvideo/chat');

var _chat2 = _interopRequireDefault(_chat);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
Set up the chat instance

Params:
	- html element
	- options
			user: users username, should be unique to the user
			room: room name
			apiHost: lively chat api
			websocketHost: lively ws api
			url: the company's auth url, which should access livelyvideo to create an access token for the user
**/
var chat = void 0;
var ROOM = 'demo';
//const ROOM = 'sea1a~1~931c1d57-785d-4629-adb2-f290b74b16eb_585_426x240_56';
function createChat(user, role, el) {
	if (chat) {
		chat.destroy();
	}
	chat = new _chat2.default(el, {
		user: user,
		room: ROOM,
		insecure: true,
		roleHistory: true,
		host: 'localhost:8080',
		wshost: 'localhost:8081',
		authUrl: '/access-token?username=' + user + '&role=' + role
	});
}

document.querySelector('#pickuser').onsubmit = function (e) {
	e.preventDefault();
	createChat(e.target.querySelector('[name=username]').value, e.target.querySelector('[name=role]').value, document.querySelector('.chat'));
	e.target.setAttribute('disabled', true);
	e.target.querySelector('[name=username]').value = '';
	e.target.querySelector('[name=role]').value = '';
};

},{"@livelyvideo/chat":2}],2:[function(require,module,exports){
(function (global){
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).LivelyChat=e()}}(function(){return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return o(n||e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=r(e("@livelyvideo/logger-core/lib/source")),c=r(e("events")),l=r(e("deepmerge")),h=r(e("./package-json")),f=new u.default(h.default),d={timeout:5e3,headers:{},bootstrap:{},loggerOptions:{}},p={Accept:"application/json"},_=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(s.options=(0,l.default)(d,r),f.setOptions(s.options.loggerOptions),f.attachEmitter(s),s.options.host&&f.setInstanceOptions({host:s.options.host}),!e)return setTimeout(function(){return s.emit("error","scope is required")}),i(s);if(!n)return setTimeout(function(){return s.emit("error","authorization server url is required")}),i(s);if(-1===n.indexOf("?")?s._url=n+"?scope="+e:s._url=n+"&scope="+e,s._stopped=!1,s._fatalError=null,s._token=s.options.bootstrap.token||null,s._retries=[0,200,1e3,3e3],s._retry=0,s._autorefresh=null,s._headers=Object.assign({},p,r.headers),null===s._token)s._retryRequest();else if(s.options.bootstrap&&s.options.bootstrap.expire){var a=s.options.bootstrap.expire-Date.now()-6e4;s._autorefresh=setTimeout(function(){s._autorefresh=null,s._stopped||s._retryRequest()},a)}return s}return s(t,c.default),a(t,[{key:"destroy",value:function(){this._stopped=!0}},{key:"request",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._fatalError)t(this._fatalError);else if(null===this._token){var n=!1,r=function(){n||(n=!0,t(null,e._token))},o=function(){n||(n=!0,t(new Error("authorization: timeout")))},i=setTimeout(function(){e.removeListener("ready",r),o()},this.options.timeout);this.once("ready",function(){clearTimeout(i),r()})}else t(null,this._token)}},{key:"refreshToken",value:function(){var e=this;null!==this._token&&(null!==this._autorefresh&&(clearTimeout(this._autorefresh),this._autorefresh=null),this._token=null,e._retryRequest())}},{key:"ensureToken",value:function(e){this._token?e():this.once("ready",function(){e()})}},{key:"_parseJSON",value:function(e){return e.text().then(function(e){if(e)try{return JSON.parse(e)}catch(e){throw e.fatal=!0,e}return{}})}},{key:"_retryRequest",value:function(){var e=this,t=this._retries[this._retry];t?setTimeout(function(){e._makeRequest()},t):this._makeRequest()}},{key:"_makeRequest",value:function(){var e=this;fetch(this._url,{credentials:"same-origin",headers:this._headers}).then(function(t){if(t.status>=200&&t.status<300)return e._parseJSON(t);if(401===t.status){var n=new Error("authorization: unauthorized");throw n.fatal=!0,n}if(403===t.status){var r=new Error("authorization: forbidden");throw r.fatal=!0,r}throw new Error("authorization: non-200 response code from auth server")}).then(function(t){e._token=t.token,e._retry=0,e.emit("ready",{token:t.token});var n=new Date(t.expire).getTime()-Date.now()-6e4;e._autorefresh=setTimeout(function(){e._autorefresh=null,e._stopped||e._retryRequest()},n)}).catch(function(t){if(e._token=null,t.fatal)return e._fatalError=t,void e.emit("error",t.message||"",t);e.emit("log","network",t.message||"",t),e._retryRequest(),e._retry<e._retries.length-1&&e._retry++})}}]),t}();n.default=_,t.exports=n.default},{"./package-json":2,"@livelyvideo/logger-core/lib/source":22,deepmerge:115,events:133}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={version:"1.3.1",name:"@livelyvideo/auth-core"},t.exports=n.default},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./auth-core"));n.default=r.default,t.exports=n.default},{"./auth-core":1}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(e("events")),u=function(e){function t(e,n,i){r(this,t);var s=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e?n?(s._auth=e,s._url=n,s._nextParams="",s._options=i,s._retries=[0,300,1e3],s):(setTimeout(function(){return s.emit("error","url is required for a changerole request")}),o(s)):(setTimeout(function(){return s.emit("error","auth is required for a changerole request")}),o(s))}return i(t,a.default),s(t,[{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=this._url+"?";this._options.limit&&(t=t+"limit="+this._options.limit+"&"),this._request(t,e)}},{key:"next",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._nextParams){var t=this._url+"?"+this._nextParams;this._request(t,e)}else e(null,[])}},{key:"_request",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=-1;!function o(){t._auth.request(function(i,s){i?n(i):fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s}}).then(function(e){if(200===e.status)return e.json();if(401===e.status){var t=new Error("chat: unauthorized");throw t.retry=!0,t}if(503===e.status){var n=new Error("chat: server unavailable");throw n.retry=!0,n}if(403===e.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(e){t._nextParams=e&&e._links&&e._links.next&&e._links.next.href?e._links.next.href.split("?")[1]:"",n(null,e.changeroles)}).catch(function(e){if(e.retry&&r<t._retries.length-1){r++;var i=t._retries[r];return i?void setTimeout(o,i):void o()}n(e)})})}()}}]),t}();n.default=u,t.exports=n.default},{events:133}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=r(e("events")),l=r(e("@livelyvideo/logger-core/lib/source")),h=r(e("@livelyvideo/chat-parser-core/lib/source")),f=r(e("@livelyvideo/auth-core/lib/source")),d=r(e("@livelyvideo/utils/lib/forwardEvents")),p=r(e("./websocket")),_=r(e("./fallback")),m=r(e("./command")),v=r(e("./roster")),y=r(e("./changerole")),b=r(e("./http")),g=r(e("./package-json")),w=new l.default(g.default),j={room:null,host:null,roleHistory:!1,insecure:!1,loggerOptions:{}},k=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(w.setOptions(e.loggerOptions,r),!e)return setTimeout(function(){return r.emit("error","Chat options is required")}),i(r);if(!e.room)return setTimeout(function(){return r.emit("error","Chat room is required")}),i(r);if(!e.host)return setTimeout(function(){return r.emit("error","Chat server host required")}),i(r);e.wshost||(e.wshost="ws-"+e.host),r.options=a({},j,e),w.setInstanceOptions({host:r.options.host});var s="https",u="wss";e.insecure&&(s="http",u="ws");var c="";e.roleHistory&&(c="role-history=true");var l=s+"://"+e.host+"/chat/v1/rooms/"+e.room+"/command",v=s+"://"+e.host+"/chat/v1/manifests/say/rooms/"+e.room+"/version",y=u+"://"+e.wshost+"/chat/ws/v1/rooms/"+e.room+"?"+c,g="/chat/http/v1/rooms/"+e.room+"?"+c;if(r._rosterUrl=s+"://"+e.host+"/chat/v1/rooms/"+e.room+"/roster",r._changeroleUrl=s+"://"+e.host+"/chat/v1/rooms/"+e.room+"/changeroles",r._routeStart=s+"://"+e.host+"/chat/v1",n){if(!n.url)return setTimeout(function(){return r.emit("error","authorization options url is required")}),i(r);r._auth=new f.default("chat",n.url,n.options),(0,d.default)(r._auth,r,["error"]),r._http=new b.default(r._auth),(0,d.default)(r._http,r),r._command=new m.default(r._auth,l),(0,d.default)(r._command,r)}if(r._parser=new h.default(v),(0,d.default)(r._parser,r),"undefined"!=typeof window)if(window.WebSocket)r._socketInterface=new p.default(y,r._auth);else{var k=s+"://"+e.host+g;r._socketInterface=new _.default(k,r._auth)}else r._socketInterface=new p.default(y,r._auth);return(0,d.default)(r._socketInterface,r,["error","ready"]),r._historyEmitted=!1,r._socketInterface.on("unauthorized",function(){if(r._historyEmitted)r.emit("me",null);else{var e=function(){r.emit("me",null)},t=setTimeout(function(){e(),e=null},3e3);r.once("history",function(){e&&e(),clearTimeout(t)})}}),r._socketInterface.on("disconnect",function(){r._historyEmitted=!1,r.emit("disconnect")}),r._socketInterface.on("message",function(e){r._parser.parseMessage(e,r._emitCommand.bind(r))}),r._sayDedupe=[],r._me=null,r._room=null,r}return s(t,c.default),u(t,[{key:"getDefaultAvatars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._auth?this._http.execGet(this._routeStart+"/avatars",e):e(new Error("Http calls require authentication"))}},{key:"setDefaultUserAvatar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execPatch(this._routeStart+"/users/"+e+"/avatar",{default:t},n):n(new Error("Http calls require authentication"))}},{key:"getUserEmoticons",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._auth?this._http.execGet(this._routeStart+"/users/"+e+"/emoticons",t):t(new Error("Http calls require authentication"))}},{key:"getAllEmoticons",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execGet(this._routeStart+"/rooms/"+e+"/users/"+t+"/emoticons/all",n):n(new Error("Http calls require authentication"))}},{key:"postUserEmoticon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execPost(this._routeStart+"/users/"+e+"/emoticons",t,n):n(new Error("Http calls require authentication"))}},{key:"deleteUserEmoticon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execDelete(this._routeStart+"/users/"+e+"/emoticons/"+t,n):n(new Error("Http calls require authentication"))}},{key:"getUserAvatar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._auth?this._http.execGet(this._routeStart+"/users/"+e+"/avatar",t):t(new Error("Http calls require authentication"))}},{key:"putUserAvatar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execPut(this._routeStart+"/users/"+e+"/avatar",t,n):n(new Error("Http calls require authentication"))}},{key:"getUser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._auth?this._http.execGet(this._routeStart+"/users/"+e,t):t(new Error("Http calls require authentication"))}},{key:"patchUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execPatch(this._routeStart+"/users/"+e,t,n):n(new Error("Http calls require authentication"))}},{key:"getRoomUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execGet(this._routeStart+"/rooms/"+e+"/users/"+t,n):n(new Error("Http calls require authentication"))}},{key:"patchRoomUser",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};this._auth?this._http.execPatch(this._routeStart+"/rooms/"+e+"/users/"+t,n,r):r(new Error("Http calls require authentication"))}},{key:"getRoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._auth?this._http.execGet(this._routeStart+"/rooms/"+e,t):t(new Error("Http calls require authentication"))}},{key:"patchRoom",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execPatch(this._routeStart+"/rooms/"+e,t,n):n(new Error("Http calls require authentication"))}},{key:"getChangeroles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._auth)return this.emit("error","Changeroles calls require authentication"),!1;var t=Object.assign({},{limit:100,role:""},e);return new y.default(this._auth,this._changeroleUrl,t)}},{key:"getRoster",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},{limit:100,role:""},e);return new v.default(this._rosterUrl,t)}},{key:"command",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._auth?this._command.run(e,function(e,r){if(e)n(e);else{for(var o=r.length-1;o>=0;o--)r[o].data&&r[o].data&&r[o].data.command&&(t._parser.parseMessage(r[o].data.command,t._emitCommand.bind(t)),r.splice(0,1));n(null,r)}}):n(new Error("Command calls require authentication"))}},{key:"destroy",value:function(){this._auth.destroy(),this._socketInterface.destroy()}},{key:"_emitCommand",value:function(e,t,n){if(e)this.emit("error",e);else switch(t){case"NOTIFICATION":this.emit("notification",n);break;case"CLOSE":this.emit("close",n),this._socketInterface.destroy();break;case"SAY":this._emitSay(n);break;case"ME":this._me=n,this.emit("me",n);break;case"ROOM":this._room=n,this.emit("room",n);break;case"MESSAGE":this.emit("message",n);break;case"HISTORY":this.emit("history",n),this._historyEmitted=!0;break;case"DELETE":this.emit("delete",n)}}},{key:"_emitSay",value:function(e){for(var t=this._sayDedupe.length-1;t>=0;t--)if(this._sayDedupe[t]===e.id)return;this._me&&this._me.ignore&&-1!==this._me.ignore.indexOf(e.actor.id)&&(e.ignore=!0),this._sayDedupe.length>50&&this._sayDedupe.splice(0,1),this._sayDedupe.push(e.id),this.emit("chat",e)}}]),t}();n.default=k,t.exports=n.default},{"./changerole":4,"./command":6,"./fallback":7,"./http":8,"./package-json":9,"./roster":10,"./websocket":13,"@livelyvideo/auth-core/lib/source":3,"@livelyvideo/chat-parser-core/lib/source":15,"@livelyvideo/logger-core/lib/source":22,"@livelyvideo/utils/lib/forwardEvents":25,events:133}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(e("events")),u=function(e){function t(e,n){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e?n?(i._auth=e,i._url=n,i._retries=[0,300,1e3],i):(setTimeout(function(){return i.emit("error","url is required for a command")}),o(i)):(setTimeout(function(){return i.emit("error","auth is required for a command")}),o(i))}return i(t,a.default),s(t,[{key:"run",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(e){var r=-1;!function o(){t._auth.request(function(i,s){i?n(i):fetch(t._url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s},body:JSON.stringify({command:e})}).then(function(e){if(e.status>=200&&e.status<300)return 204===e.status?null:e.json();if(401===e.status){t._auth.refreshToken();var n=new Error("chat: unauthorized");throw n.retry=!0,n}if(503===e.status){var r=new Error("chat: server unavailable");throw r.retry=!0,r}if(403===e.status)throw new Error("chat: forbidden");if(e.status>=400&&e.status<500)return e.json();throw new Error("chat: non-200 response code from chat server")}).then(function(e){e&&e.messages?n(null,e.messages):n()}).catch(function(e){if(e.retry&&r<t._retries.length-1){r++;var i=t._retries[r];return i?void setTimeout(o,i):void o()}n(e)})})}()}else n(new Error("command is required for a command"))}}]),t}();n.default=u,t.exports=n.default},{events:133}],7:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("events"),u=function(e){return e&&e.__esModule?e:{default:e}}(e("./uuid")),c=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i._auth=n,e?(i._url=e,i._stopped=!0,i._connectionID=(0,u.default)(),i._isConnected=!1,i._retry=0,i._retries=[0,300,1e3],i._run(),i):(setTimeout(function(){return i.emit("error","url is required for a command")}),o(i))}return i(t,a.EventEmitter),s(t,[{key:"destroy",value:function(){this._stopped=!0}},{key:"_retryRun",value:function(e){var t=this;if(e)return this._retry=0,void this._run();this._retry<this._retries.length-1&&this._retry++,setTimeout(function(){t._run()},this._retries[this._retry])}},{key:"_run",value:function(){var e=this;this._auth?this._auth.request(function(t,n){t?e._disconnected(t):e._request(n)}):this._request()}},{key:"_request",value:function(e){var t=this,n={Accept:"application/json","Content-Type":"application/json"};e&&(n.Authorization="Bearer "+e);var r=void 0;r=this._url.indexOf("?")===this._url.length-1?this._url+"cid="+this._connectionID:this._url+"&cid="+this._connectionID,fetch(r,{method:"GET",headers:n}).then(function(e){if(200===e.status)return e.json();if(401===e.status){t._auth.refreshToken();var n=new Error("chat: unauthorized");throw n.retry=!0,n}if(503===e.status){var r=new Error("chat: server unavailable");throw r.retry=!0,r}if(404===e.status)throw new Error("Room does not exist");if(403===e.status)throw t.emit("unauthorized"),new Error("chat: forbidden");if(409===e.status){t._connectionID=(0,u.default)();var o=new Error("chat: connection id conflict");throw o.ignore=!0,o.retry=!0,o}throw new Error("non 200 response")}).then(function(e){t._connected();for(var n=0;n<e.length;n++)t.emit("message",e[n]);t._stopped||t._retryRun(!0)}).catch(function(e){t._disconnected(e),e.retry&&(t._stopped||t._retryRun())})}},{key:"_disconnected",value:function(e){e&&(e.ignore||this.emit("error",e)),this._isConnected&&(this.emit("disconnect"),this._isConnected=!1)}},{key:"_connected",value:function(){this._isConnected||(this.emit("ready"),this._isConnected=!0)}}]),t}();n.default=c,t.exports=n.default},{"./uuid":12,events:133}],8:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(e("events")),u=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e?(n._auth=e,n._retries=[0,300,1e3],n):(setTimeout(function(){return n.emit("error","auth is required for an http request")}),o(n))}return i(t,a.default),s(t,[{key:"execGet",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e?this._execute("GET",e,null,t):this.emit("error","url is required for an http request")}},{key:"execPut",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};e?this._execute("PUT",e,t,n):this.emit("error","url is required for an http request")}},{key:"execPost",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};e?this._execute("POST",e,t,n):this.emit("error","url is required for an http request")}},{key:"execPatch",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};e?this._execute("PATCH",e,t,n):this.emit("error","url is required for an http request")}},{key:"execDelete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e?this._execute("DELETE",e,t):this.emit("error","url is required for an http request")}},{key:"_execute",value:function(e,t,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i={method:e,headers:{Accept:"application/json","Content-Type":"application/json"}};n&&(i.body=JSON.stringify(n));var s=-1;!function e(){r._auth.request(function(n,a){n?o(n):(i.headers.Authorization="Bearer "+a,fetch(t,i).then(function(e){if(e.status>=200&&e.status<300)return e.json();if(401===e.status){var t=new Error("chat: unauthorized");throw t.retry=!0,t}if(503===e.status){var n=new Error("chat: server unavailable");throw n.retry=!0,n}if(403===e.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(e){o(null,e)}).catch(function(t){if(t.retry&&s<r._retries.length-1){s++;var n=r._retries[s];return n?void setTimeout(e,n):void e()}o(t)}))})}()}}]),t}();n.default=u,t.exports=n.default},{events:133}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={version:"1.2.4",name:"@livelyvideo/chat-core"},t.exports=n.default},{}],10:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(e("events")),u=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e?(i._url=e,i._nextParams="",i._options=n,i._retries=[0,300,1e3],i):(setTimeout(function(){return i.emit("url is required for a roster request")}),o(i))}return i(t,a.default),s(t,[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=this._url+"?";this._options.limit&&(t=t+"limit="+this._options.limit+"&"),this._options.role&&(t=t+"role="+this._options.role+"&"),this._request(t,e)}},{key:"next",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._nextParams){var t=this._url+"?"+this._nextParams;this._request(t,e)}else e(null,[])}},{key:"_request",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=-1;!function o(){fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){if(200===e.status)return e.json();if(503===e.status){var t=new Error("chat: server unavailable");throw t.retry=!0,t}if(403===e.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(e){t._nextParams=e&&e._links&&e._links.next&&e._links.next.href?e._links.next.href.split("?")[1]:"",n(null,e.users)}).catch(function(e){if(e.retry&&r<t._retries.length-1){r++;var i=t._retries[r];return i?void setTimeout(o,i):void o()}n(e)})}()}}]),t}();n.default=u,t.exports=n.default},{events:133}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./chat-core"));n.default=r.default,t.exports=n.default},{"./chat-core":5}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});for(var r=new Array(16),o=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r},i=function(e,t){var n=t||0,r=s;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]},s=[],a={},u=0;u<256;u++)s[u]=(u+256).toString(16).substr(1),a[s[u]]=u;n.default=function(){var e=o();return e[6]=15&e[6]|64,e[8]=63&e[8]|128,i(e)},t.exports=n.default},{}],13:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(e("reconnectable-websocket")),u=e("events"),c={MSG:"msg",FIN:"fin"},l={MSG:"msg",ERR:"err",FIN:"fin",ACK:"ack"},h={DEFAULT:"/",AUTH:"/auth"},f=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e?(i._auth=n,i._socket=new a.default(e,"livelyWebsocket",{automaticOpen:!1,reconnectOnError:!0,reconnectOnCleanClose:!0,randomRatio:!1}),i._retries=[0,200,1e3,2e3],i._retry=0,i.ready=!1,i.authed=!1,i._socket.onopen=function(){i._auth&&i._authenticate()},i._socket.onclose=function(e){i.emit("disconnect"),i.ready=!1,i.authed=!1,1003===e.code&&(i._socket._options.reconnectOnCleanClose=!1,i._socket._options.reconnectOnError=!1,i._socket.close(),i.emit("error",new Error("Requested room does not exist")))},i._socket.onmessage=function(e){i._onmessage(e)},i._socket.open(),i):(setTimeout(function(){return i.emit("error","url is required for chat")}),o(i))}return i(t,u.EventEmitter),s(t,[{key:"destroy",value:function(){this._socket._options.reconnectOnCleanClose=!1,this._socket._options.reconnectOnError=!1,this._socket.close()}},{key:"_authenticate",value:function(){var e=this;this._auth.request(function(t,n){t?e.emit("error",t):(e._send(e._socket,c.MSG,h.AUTH,n),e.once("_authed",function(t){t&&e.emit("unauthorized")}))})}},{key:"_send",value:function(e,t,n,r){if(e&&e.readyState===e.OPEN){var o=t+" "+n+" "+r;this._socket.send(o)}}},{key:"_onmessage",value:function(e){var t=e.data;if(t){var n=t.indexOf(" "),r=t.indexOf(" ",n+1),o=t.slice(0,n),i=t.slice(n+1,r),s=t.slice(r+1);if(o!==l.MSG)this.ready||o!==l.ACK||i!==h.DEFAULT||(this.emit("ready"),this.ready=!0,this._auth||this.emit("unauthorized")),this.authed||o!==l.FIN?o===l.ERR&&this.emit("error",new Error(s)):i===h.AUTH&&(this.emit("_authed"),this.authed=!0);else{var a=void 0;try{a=JSON.parse(s)}catch(e){return void this.emit("error",e)}this.emit("message",a)}}}}]),t}();n.default=f,t.exports=n.default},{events:133,"reconnectable-websocket":116}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=r(e("events")),c=r(e("./template-parser")),l={INDEX:"index",TYPE:"type",NESTED_ITEMS:"nestedItems"},h={KEY:"key",VARS:"vars"},f={NESTED_DATA_ARRAY:"nestedDataArray",NESTED_ARRAY:"nestedArray",NESTED_OBJECT:"nestedObject",TEMPLATE:"template",INT_ARRAY:"intArray",STRING_ARRAY:"stringArray",STRING:"string",INT:"int",BOOL:"bool"},d={emoticons:"emoticon",links:"link",mentions:"mention",tags:"tag"},p=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e?(n._baseUrl=e,n._manifests={},n._buffer={},n._fetchingManifests={},n):(setTimeout(function(){return n.emit("error","url is required for parser")}),i(n))}return s(t,u.default),a(t,[{key:"parseMessage",value:function(e,t){var n=this;e&&e instanceof Array&&!(e.length<2)||t(new Error("Invalid data format"));var r=e[0],o=e[1];this._parseMessage(r,o,function(e,o){e?t(e):("HISTORY"===r&&o.messages.length&&o.messages.forEach(function(e,t){n._parseMessage("SAY",e,function(e,n){e||(o.messages[t]=n)})}),t(null,r,o))})}},{key:"_addManifest",value:function(e){this._manifests[e.version]=e}},{key:"_parseMessage",value:function(e,t,n){var r=this,o=t[0],i=void 0;if(this._manifests[o])return this._manifests[o].manifests[e]?(i=this._parse(o,this._manifests[o].manifests[e],t),void n(null,i)):void n(new Error("manifest does not have "+e+" command"));this._buffer[o]?this._buffer[o].push([t,e,n]):this._buffer[o]=[[t,e,n]],!0!==this._fetchingManifests[o]&&(this._fetchingManifests[o]=!0,fetch(this._baseUrl+"/"+o).then(function(e){if(200!==e.status)throw new Error("chat: non-200 response code from chat server");return e.json()}).then(function(e){for(r._addManifest(e);r._buffer[e.version].length>0;){var t=r._buffer[e.version].shift();i=r._parse(e.version,e.manifests[t[1]],t[0]),t[2](null,i)}}).catch(function(e){r._buffer[o]=[],n(e)}))}},{key:"_parse",value:function(e,t,n){for(var r=this,o={},i=Object.keys(t),s=0;s<i.length;s++){(function(s){var a=i[s],u=t[a],c=n[u[l.INDEX]];if(null===c)return o[a]=null,"continue";var p=void 0;switch(u[l.TYPE]){case f.NESTED_ARRAY:p=[];for(var _=0;_<c.length;_++)p.push(r._parse(e,u[l.NESTED_ITEMS],c[_]));break;case f.NESTED_OBJECT:p=r._parse(e,u[l.NESTED_ITEMS],c);break;case f.TEMPLATE:p=r._parseTemplate(e,c[u[l.NESTED_ITEMS][h.KEY].index],c[u[l.NESTED_ITEMS][h.VARS].index]);break;default:p=c}p&&p instanceof Array&&p.forEach(function(e){var t=e;t.positions&&t.positions instanceof Array&&t.positions.forEach(function(e){d[a]&&(t.type=d[a],o.positions||(o.positions={}),o.positions[e]=t)})}),o[a]=p})(s)}return o}},{key:"_parseTemplate",value:function(e,t,n){return new c.default(this._manifests[e].templates[t],n).getParsed()}}]),t}();n.default=p,t.exports=n.default},{"./template-parser":16,events:133}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./chat-parser-core"));n.default=r.default,t.exports=n.default},{"./chat-parser-core":14}],16:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,n){r(this,e),this._parsed="",n&&0!==n.length?t&&0!==t.length&&(this._parsed="",this._varPos=0,this._curr="",this._template=t,this._templateLength=t.length,this._vars=n,this._next=this._startState.bind(this),this._pos=0,this._skipNext=!1):this._parsed=t}return o(e,[{key:"getParsed",value:function(){if(this._parsed)return this._parsed;for(var e=0;e<this._templateLength;e++)this._skipNext?this._skipNext=!1:(this._pos=e,this._curr=this._template[e],this._next=this._next().bind(this));return this._parsed}},{key:"_startDelim",value:function(){return!(this._pos>=this._templateLength-1)&&("{"===this._curr&&"{"===this._template[this._pos+1]&&(this._skipNext=!0,!0))}},{key:"_endDelim",value:function(){return!(this._pos>=this._templateLength-1)&&("}"===this._curr&&"}"===this._template[this._pos+1]&&(this._skipNext=!0,!0))}},{key:"_startState",value:function(){return this._startDelim()?this._midState:(this._parsed+=this._curr,this._startState)}},{key:"_midState",value:function(){return"n"===this._curr?this._endState:(this._parsed=this._parsed+"{{"+this._curr,this._startState)}},{key:"_endState",value:function(){return this._endDelim()?(this._parsed+=this._vars[this._varPos],this._varPos++):this._parsed+=this._curr,this._startState}}]),e}();n.default=i,t.exports=n.default},{}],17:[function(e,t,n){(function(r){!function(e){if("object"==typeof n&&void 0!==t)t.exports=e();else{("undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:this).LivelyLocales=e()}}(function(){return function t(n,r,o){function i(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof e&&e;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[a]={exports:{}};n[a][0].call(h.exports,function(e){var t=n[a][1][e];return i(t||e)},h,h.exports,t,n,r,o)}return r[a].exports}for(var s="function"==typeof e&&e,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s={},a={},u=function(){function e(t,n,o){r(this,e),t&&s[t]||n?(this.warned={},this.silent=o,this.name=t,this.data=s[t]||{},n&&Object.assign(this.data,n)):this.localize=function(e){return e}}return i(e,[{key:"localize",value:function(e){var t=void 0;return(t=this.data[e])?t:(this.silent||this.warned[e]||(this.warned[e]=!0,this.name?console.warn("'"+e+"' has no translation in the provided '"+this.name+"' locale files or localization messages"):console.warn("'"+e+"' has no translation in the provided localization messages.")),e)}}]),e}();[].map(function(e){var t=e.name.split("/")[2];s[t]=Object.assign({},s[t],e.module)});var c=new u;Object.keys(s).forEach(function(e){a[e]=new u(e)}),n.default=function(e,t,n){if(t){if("object"!==(void 0===t?"undefined":o(t)))throw new Error("Lively Localization instantiated with something other than a messages object",{messages:t});return new u(e,t,n)}return e&&a[e]?a[e]:c},t.exports=n.default},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.supportedLevels={error:0,warn:1,deprecated:1,info:2,debug:3,timing:3,network:3}},{}],19:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("serialize-error")),u=e("./const"),c=r(e("./package-json")),l={host:null,interval:3e4,limit:500,maxRequestSize:1048576,reportLevel:"error"},h=null,f=function(){function e(){return o(this,e),h||(h=this,this.options=l,this.storage=[],h)}return s(e,[{key:"setOptions",value:function(e){this.options=i({},l,e),this.options.host&&this._uri||(this._uri="https://"+this.options.host+"/client-logs")}},{key:"add",value:function(e){this.storage.push(e),u.supportedLevels[e.level]<=u.supportedLevels[this.options.reportLevel]?this.send():this.checkStorageLimit()}},{key:"send",value:function(){var e=this;if(this.storage.length&&this._uri){var t=this.storage;this.storage=[];var n={messages:t},r=void 0;try{r=JSON.stringify(n)}catch(e){return void this.storage.push({level:"error",package:c.default,source:"client",message:"Error stringifying batch. Dropped "+t.length+" logs.",error:(0,a.default)(e)})}this._byteLength(r)>this.options.maxRequestSize?this.storage.push({level:"error",package:c.default,source:"client",message:"Body exceeds maxRequestSize. Dropped "+t.length+" logs."}):fetch(this._uri,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:r}).then(this._handleFetchError).catch(function(n){e.storage.push({level:"network",package:c.default,source:"client",message:"Network failure. Dropped "+t.length+" logs.",error:(0,a.default)(n)})})}}},{key:"enable",value:function(){var e=this;this._uri&&(this._watchInterval=setInterval(function(){return e.send()},this.options.interval),"undefined"!=typeof window&&(this._watchUnload=this._eventHelper(window,"unload",function(){return e.send()})))}},{key:"disable",value:function(){this._watchInterval&&clearInterval(this._watchInterval),this._watchUnload&&this._watchUnload()}},{key:"checkStorageLimit",value:function(){this.options.limit&&this.storage.length>this.options.limit&&this.send()}},{key:"_handleFetchError",value:function(e){if(!e.ok)throw new TypeError(e.status,e.statusText);return e}},{key:"_byteLength",value:function(e){for(var t=e.length,n=e.length-1;n>=0;n--){var r=e.charCodeAt(n);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&n--}return t}},{key:"_eventHelper",value:function(e,t,n){e.addEventListener(t,n);return function(){e.removeEventListener(t,n)}}}]),e}();n.default=f,t.exports=n.default},{"./const":18,"./package-json":21,"serialize-error":117}],20:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=r(e("events")),c=r(e("serialize-error")),l=r(e("./instance")),h=r(e("./package-json")),f=e("./const"),d={level:"warn",silent:!0,disable:!1,events:!0,name:h.default.name,version:h.default.version},p=function(){function e(t){i(this,e),this.options=s({},d,t),this.instance=new l.default,this.enable()}return a(e,[{key:"setOptions",value:function(e,t,n){this.options=s({},this.options,e),t&&this.options.events&&this.attachEmitter(t,n)}},{key:"setInstanceOptions",value:function(e){this.instance.options.host&&e.host&&this.instance.options.host!==e.host?this.warn("Unable to set instance options. Host set to "+this.instance.options.host+" and cannot be set "+e.host+"."):(this.instance.setOptions(e),this.options.disable||this.enableInstance())}},{key:"enableInstance",value:function(){this.instance.enable()}},{key:"disableInstance",value:function(){this.instance.disable()}},{key:"instanceSend",value:function(){this.instance.send()}},{key:"setLevel",value:function(e){f.supportedLevels[e]?this.options.level=e:this.warn(e+" level is unsupported.")}},{key:"log",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(this._isWritable(e)){var o;(o=this.writer)[e].apply(o,n)}var i=this._validateLog(e,n);i&&this.instance.add(i)}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["debug"].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["error"].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["info"].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["warn"].concat(t))}},{key:"deprecated",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["deprecated"].concat(t))}},{key:"timing",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["timing"].concat(t))}},{key:"network",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log.apply(this,["network"].concat(t))}},{key:"enable",value:function(){"undefined"!=typeof window?this.writer=window.console:console&&(this.writer=console),this.writer&&(this.writer.timing=this.writer.info,this.writer.deprecated=this.writer.warn,this.writer.network=this.writer.warn)}},{key:"disable",value:function(){this.writer={}}},{key:"attachEmitter",value:function(e,t){if(e instanceof u.default)for(var n=t||["error","log"],r=0;r<n.length;r++)e.on(n[r],function(){this[arguments[0]]||this.error.apply(this,o(Array.prototype.slice.call(arguments,1))),this[arguments[0]].apply(this,o(Array.prototype.slice.call(arguments,1)))}.bind(this,n[r]));else this.error("attachEmitter not supplied with instanceof EventEmitter")}},{key:"detachEmitter",value:function(e,t){if(e instanceof u.default)for(var n=t||["error","log"],r=0;r<n.length;r++)e.removeListener(n[r],function(){this[arguments[0]]||this.error.apply(this,o(Array.prototype.slice.call(arguments,1))),this[arguments[0]].apply(this,o(Array.prototype.slice.call(arguments,1)))}.bind(this,n[r]));else this.error("detachEmitter not supplied with instanceof EventEmitter")}},{key:"_isWritable",value:function(e){return!this.options.silent&&this.writer[e]&&this.writer[e].apply&&f.supportedLevels[e]<=f.supportedLevels[this.options.level]}},{key:"_validateLog",value:function(e,t){var n={package:{name:this.options.name,version:this.options.version},timestamp:(new Date).toISOString(),source:"client",userAgent:"undefined"!=typeof navigator?navigator.userAgent:"node",referrer:"undefined"!=typeof document?document.referrer:"node",level:e},r=t[t.length-1];switch(Object.prototype.toString.call(r)){case"[object Object]":n=s({},n,t.pop());break;case"[object Error]":n.error=(0,c.default)(t.pop());break;case"[object Array]":n.array=t.pop()}n.message=t.join(" ");try{JSON.stringify(n)}catch(e){return this.error("Dropped log due to invalid data structure",e),null}return n}}]),e}();n.default=p,t.exports=n.default},{"./const":18,"./instance":19,"./package-json":21,events:133,"serialize-error":117}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={version:"1.1.1",name:"@livelyvideo/logger-core"},t.exports=n.default},{}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(e("./logger-core"));n.default=r.default,t.exports=n.default},{"./logger-core":20}],23:[function(e,t,n){"use strict";function r(e){var t=void 0,n=void 0,o=void 0;if(e.tagName){if(t=document.createElement(e.tagName),e.className&&(t.className=e.className),e.attributes)for(n in e.attributes)t.setAttribute(n,e.attributes[n]);void 0!==e.html&&(t.innerHTML=e.html)}else t=document.createDocumentFragment();if(e.text&&t.appendChild(document.createTextNode(e.text)),void 0===window.HTMLElement&&(window.HTMLElement=Element),e.childs&&e.childs.length)for(o=0;o<e.childs.length;o++)t.appendChild(e.childs[o]instanceof window.HTMLElement?e.childs[o]:r(e.childs[o]));if(e.events)for(var i in e.events)t.addEventListener(i,e.events[i]);return t}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r,t.exports=n.default},{}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){if(e.addEventListener)return e.addEventListener(t,n),function(){e.removeEventListener(t,n)};return e.attachEvent("on"+t,function(){n.call(e)}),function(){e.detachEvent("on"+t,function(){n.call(e)})}},t.exports=n.default},{}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(e("events"));n.default=function(e,t,n){if(!(e instanceof r.default))throw new Error("src must be an emitter");if(!(t instanceof r.default))throw new Error("dst must be an emitter");var o=e.emit;e.once("error",function(){}),e.emit=function(r){if(o.apply(e,arguments),!n||-1!==n.indexOf(r))return t.emit.apply(t,arguments)}.bind(e)},t.exports=n.default},{events:133}],26:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":36}],27:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":37}],28:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":38}],29:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":39}],30:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":40}],31:[function(e,t,n){t.exports={default:e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":41}],32:[function(e,t,n){t.exports={default:e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":42}],33:[function(e,t,n){t.exports={default:e("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":43}],34:[function(e,t,n){"use strict";n.__esModule=!0,n.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],35:[function(e,t,n){"document"in window.self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||function(e){"use strict";if("Element"in e){var t=e.Element.prototype,n=Object,r=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},i=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},s=function(e,t){if(""===t)throw new i("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new i("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(e,t)},a=function(e){for(var t=r.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],o=0,i=n.length;o<i;o++)this.push(n[o]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},u=a.prototype=[],c=function(){return new a(this)};if(i.prototype=Error.prototype,u.item=function(e){return this[e]||null},u.contains=function(e){return e+="",-1!==s(this,e)},u.add=function(){var e,t=arguments,n=0,r=t.length,o=!1;do{e=t[n]+"",-1===s(this,e)&&(this.push(e),o=!0)}while(++n<r);o&&this._updateClassName()},u.remove=function(){var e,t,n=arguments,r=0,o=n.length,i=!1;do{for(e=n[r]+"",t=s(this,e);-1!==t;)this.splice(t,1),i=!0,t=s(this,e)}while(++r<o);i&&this._updateClassName()},u.toggle=function(e,t){e+="";var n=this.contains(e),r=n?!0!==t&&"remove":!1!==t&&"add";return r&&this[r](e),!0===t||!1===t?t:!n},u.toString=function(){return this.join(" ")},n.defineProperty){var l={get:c,enumerable:!0,configurable:!0};try{n.defineProperty(t,"classList",l)}catch(e){void 0!==e.number&&-2146823252!==e.number||(l.enumerable=!1,n.defineProperty(t,"classList",l))}}else n.prototype.__defineGetter__&&t.__defineGetter__("classList",c)}}(window.self),function(){"use strict";var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var n,r=arguments.length;for(n=0;n<r;n++)e=arguments[n],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}e=null}())},{}],36:[function(e,t,n){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":49,"../../modules/es6.object.assign":103}],37:[function(e,t,n){e("../../modules/es6.object.create");var r=e("../../modules/_core").Object;t.exports=function(e,t){return r.create(e,t)}},{"../../modules/_core":49,"../../modules/es6.object.create":104}],38:[function(e,t,n){e("../../modules/es6.object.define-property");var r=e("../../modules/_core").Object;t.exports=function(e,t,n){return r.defineProperty(e,t,n)}},{"../../modules/_core":49,"../../modules/es6.object.define-property":105}],39:[function(e,t,n){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":49,"../../modules/es6.object.get-prototype-of":106}],40:[function(e,t,n){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":49,"../../modules/es6.object.keys":107}],41:[function(e,t,n){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":49,"../../modules/es6.object.set-prototype-of":108}],42:[function(e,t,n){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":49,"../../modules/es6.object.to-string":109,"../../modules/es6.symbol":111,"../../modules/es7.symbol.async-iterator":112,"../../modules/es7.symbol.observable":113}],43:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":100,"../../modules/es6.string.iterator":110,"../../modules/web.dom.iterable":114}],44:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],45:[function(e,t,n){t.exports=function(){}},{}],46:[function(e,t,n){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":65}],47:[function(e,t,n){var r=e("./_to-iobject"),o=e("./_to-length"),i=e("./_to-absolute-index");t.exports=function(e){return function(t,n,s){var a,u=r(t),c=o(u.length),l=i(s,c);if(e&&n!=n){for(;c>l;)if((a=u[l++])!=a)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},{"./_to-absolute-index":92,"./_to-iobject":94,"./_to-length":95}],48:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],49:[function(e,t,n){var r=t.exports={version:"2.5.1"};"number"==typeof __e&&(__e=r)},{}],50:[function(e,t,n){var r=e("./_a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":44}],51:[function(e,t,n){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],52:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":57}],53:[function(e,t,n){var r=e("./_is-object"),o=e("./_global").document,i=r(o)&&r(o.createElement);t.exports=function(e){return i?o.createElement(e):{}}},{"./_global":58,"./_is-object":65}],54:[function(e,t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],55:[function(e,t,n){var r=e("./_object-keys"),o=e("./_object-gops"),i=e("./_object-pie");t.exports=function(e){var t=r(e),n=o.f;if(n)for(var s,a=n(e),u=i.f,c=0;a.length>c;)u.call(e,s=a[c++])&&t.push(s);return t}},{"./_object-gops":79,"./_object-keys":82,"./_object-pie":83}],56:[function(e,t,n){var r=e("./_global"),o=e("./_core"),i=e("./_ctx"),s=e("./_hide"),a=function(e,t,n){var u,c,l,h=e&a.F,f=e&a.G,d=e&a.S,p=e&a.P,_=e&a.B,m=e&a.W,v=f?o:o[t]||(o[t]={}),y=v.prototype,b=f?r:d?r[t]:(r[t]||{}).prototype;f&&(n=t);for(u in n)(c=!h&&b&&void 0!==b[u])&&u in v||(l=c?b[u]:n[u],v[u]=f&&"function"!=typeof b[u]?n[u]:_&&c?i(l,r):m&&b[u]==l?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):p&&"function"==typeof l?i(Function.call,l):l,p&&((v.virtual||(v.virtual={}))[u]=l,e&a.R&&y&&!y[u]&&s(y,u,l)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},{"./_core":49,"./_ctx":50,"./_global":58,"./_hide":60}],57:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],58:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],59:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],60:[function(e,t,n){var r=e("./_object-dp"),o=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return r.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":52,"./_object-dp":74,"./_property-desc":85}],61:[function(e,t,n){var r=e("./_global").document;t.exports=r&&r.documentElement},{"./_global":58}],62:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":52,"./_dom-create":53,"./_fails":57}],63:[function(e,t,n){var r=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./_cof":48}],64:[function(e,t,n){var r=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==r(e)}},{"./_cof":48}],65:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],66:[function(e,t,n){"use strict";var r=e("./_object-create"),o=e("./_property-desc"),i=e("./_set-to-string-tag"),s={};e("./_hide")(s,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,n){e.prototype=r(s,{next:o(1,n)}),i(e,t+" Iterator")}},{"./_hide":60,"./_object-create":73,"./_property-desc":85,"./_set-to-string-tag":88,"./_wks":101}],67:[function(e,t,n){"use strict";var r=e("./_library"),o=e("./_export"),i=e("./_redefine"),s=e("./_hide"),a=e("./_has"),u=e("./_iterators"),c=e("./_iter-create"),l=e("./_set-to-string-tag"),h=e("./_object-gpo"),f=e("./_wks")("iterator"),d=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(e,t,n,_,m,v,y){c(n,t,_);var b,g,w,j=function(e){if(!d&&e in O)return O[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},k=t+" Iterator",E="values"==m,x=!1,O=e.prototype,T=O[f]||O["@@iterator"]||m&&O[m],N=T||j(m),C=m?E?j("entries"):N:void 0,S="Array"==t?O.entries||T:T;if(S&&(w=h(S.call(new e)))!==Object.prototype&&w.next&&(l(w,k,!0),r||a(w,f)||s(w,f,p)),E&&T&&"values"!==T.name&&(x=!0,N=function(){return T.call(this)}),r&&!y||!d&&!x&&O[f]||s(O,f,N),u[t]=N,u[k]=p,m)if(b={values:E?N:j("values"),keys:v?N:j("keys"),entries:C},y)for(g in b)g in O||i(O,g,b[g]);else o(o.P+o.F*(d||x),t,b);return b}},{"./_export":56,"./_has":59,"./_hide":60,"./_iter-create":66,"./_iterators":69,"./_library":70,"./_object-gpo":80,"./_redefine":86,"./_set-to-string-tag":88,"./_wks":101}],68:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],69:[function(e,t,n){t.exports={}},{}],70:[function(e,t,n){t.exports=!0},{}],71:[function(e,t,n){var r=e("./_uid")("meta"),o=e("./_is-object"),i=e("./_has"),s=e("./_object-dp").f,a=0,u=Object.isExtensible||function(){return!0},c=!e("./_fails")(function(){return u(Object.preventExtensions({}))}),l=function(e){s(e,r,{value:{i:"O"+ ++a,w:{}}})},h=t.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!i(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&h.NEED&&u(e)&&!i(e,r)&&l(e),e}}},{"./_fails":57,"./_has":59,"./_is-object":65,"./_object-dp":74,"./_uid":98}],72:[function(e,t,n){"use strict";var r=e("./_object-keys"),o=e("./_object-gops"),i=e("./_object-pie"),s=e("./_to-object"),a=e("./_iobject"),u=Object.assign;t.exports=!u||e("./_fails")(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e,t){for(var n=s(e),u=arguments.length,c=1,l=o.f,h=i.f;u>c;)for(var f,d=a(arguments[c++]),p=l?r(d).concat(l(d)):r(d),_=p.length,m=0;_>m;)h.call(d,f=p[m++])&&(n[f]=d[f]);return n}:u},{"./_fails":57,"./_iobject":63,"./_object-gops":79,"./_object-keys":82,"./_object-pie":83,"./_to-object":96}],73:[function(e,t,n){var r=e("./_an-object"),o=e("./_object-dps"),i=e("./_enum-bug-keys"),s=e("./_shared-key")("IE_PROTO"),a=function(){},u=function(){var t,n=e("./_dom-create")("iframe"),r=i.length;for(n.style.display="none",e("./_html").appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),u=t.F;r--;)delete u.prototype[i[r]];return u()};t.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=r(e),n=new a,a.prototype=null,n[s]=e):n=u(),void 0===t?n:o(n,t)}},{"./_an-object":46,"./_dom-create":53,"./_enum-bug-keys":54,"./_html":61,"./_object-dps":75,"./_shared-key":89}],74:[function(e,t,n){var r=e("./_an-object"),o=e("./_ie8-dom-define"),i=e("./_to-primitive"),s=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),o)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":46,"./_descriptors":52,"./_ie8-dom-define":62,"./_to-primitive":97}],75:[function(e,t,n){var r=e("./_object-dp"),o=e("./_an-object"),i=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){o(e);for(var n,s=i(t),a=s.length,u=0;a>u;)r.f(e,n=s[u++],t[n]);return e}},{"./_an-object":46,"./_descriptors":52,"./_object-dp":74,"./_object-keys":82}],76:[function(e,t,n){var r=e("./_object-pie"),o=e("./_property-desc"),i=e("./_to-iobject"),s=e("./_to-primitive"),a=e("./_has"),u=e("./_ie8-dom-define"),c=Object.getOwnPropertyDescriptor;n.f=e("./_descriptors")?c:function(e,t){if(e=i(e),t=s(t,!0),u)try{return c(e,t)}catch(e){}if(a(e,t))return o(!r.f.call(e,t),e[t])}},{"./_descriptors":52,"./_has":59,"./_ie8-dom-define":62,"./_object-pie":83,"./_property-desc":85,"./_to-iobject":94,"./_to-primitive":97}],77:[function(e,t,n){var r=e("./_to-iobject"),o=e("./_object-gopn").f,i={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(e){try{return o(e)}catch(e){return s.slice()}};t.exports.f=function(e){return s&&"[object Window]"==i.call(e)?a(e):o(r(e))}},{"./_object-gopn":78,"./_to-iobject":94}],78:[function(e,t,n){var r=e("./_object-keys-internal"),o=e("./_enum-bug-keys").concat("length","prototype");n.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},{"./_enum-bug-keys":54,"./_object-keys-internal":81}],79:[function(e,t,n){n.f=Object.getOwnPropertySymbols},{}],80:[function(e,t,n){var r=e("./_has"),o=e("./_to-object"),i=e("./_shared-key")("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},{"./_has":59,"./_shared-key":89,"./_to-object":96}],81:[function(e,t,n){var r=e("./_has"),o=e("./_to-iobject"),i=e("./_array-includes")(!1),s=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var n,a=o(e),u=0,c=[];for(n in a)n!=s&&r(a,n)&&c.push(n);for(;t.length>u;)r(a,n=t[u++])&&(~i(c,n)||c.push(n));return c}},{"./_array-includes":47,"./_has":59,"./_shared-key":89,"./_to-iobject":94}],82:[function(e,t,n){var r=e("./_object-keys-internal"),o=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return r(e,o)}},{"./_enum-bug-keys":54,"./_object-keys-internal":81}],83:[function(e,t,n){n.f={}.propertyIsEnumerable},{}],84:[function(e,t,n){var r=e("./_export"),o=e("./_core"),i=e("./_fails");t.exports=function(e,t){var n=(o.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*i(function(){n(1)}),"Object",s)}},{"./_core":49,"./_export":56,"./_fails":57}],85:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],86:[function(e,t,n){t.exports=e("./_hide")},{"./_hide":60}],87:[function(e,t,n){var r=e("./_is-object"),o=e("./_an-object"),i=function(e,t){if(o(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,r){try{(r=e("./_ctx")(Function.call,e("./_object-gopd").f(Object.prototype,"__proto__").set,2))(t,[]),n=!(t instanceof Array)}catch(e){n=!0}return function(e,t){return i(e,t),n?e.__proto__=t:r(e,t),e}}({},!1):void 0),check:i}},{"./_an-object":46,"./_ctx":50,"./_is-object":65,"./_object-gopd":76}],88:[function(e,t,n){var r=e("./_object-dp").f,o=e("./_has"),i=e("./_wks")("toStringTag");t.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},{"./_has":59,"./_object-dp":74,"./_wks":101}],89:[function(e,t,n){var r=e("./_shared")("keys"),o=e("./_uid");t.exports=function(e){return r[e]||(r[e]=o(e))}},{"./_shared":90,"./_uid":98}],90:[function(e,t,n){var r=e("./_global"),o=r["__core-js_shared__"]||(r["__core-js_shared__"]={});t.exports=function(e){return o[e]||(o[e]={})}},{"./_global":58}],91:[function(e,t,n){var r=e("./_to-integer"),o=e("./_defined");t.exports=function(e){return function(t,n){var i,s,a=String(o(t)),u=r(n),c=a.length;return u<0||u>=c?e?"":void 0:(i=a.charCodeAt(u))<55296||i>56319||u+1===c||(s=a.charCodeAt(u+1))<56320||s>57343?e?a.charAt(u):i:e?a.slice(u,u+2):s-56320+(i-55296<<10)+65536}}},{"./_defined":51,"./_to-integer":93}],92:[function(e,t,n){var r=e("./_to-integer"),o=Math.max,i=Math.min;t.exports=function(e,t){return(e=r(e))<0?o(e+t,0):i(e,t)}},{"./_to-integer":93}],93:[function(e,t,n){var r=Math.ceil,o=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?o:r)(e)}},{}],94:[function(e,t,n){var r=e("./_iobject"),o=e("./_defined");t.exports=function(e){return r(o(e))}},{"./_defined":51,"./_iobject":63}],95:[function(e,t,n){var r=e("./_to-integer"),o=Math.min;t.exports=function(e){return e>0?o(r(e),9007199254740991):0}},{"./_to-integer":93}],96:[function(e,t,n){var r=e("./_defined");t.exports=function(e){return Object(r(e))}},{"./_defined":51}],97:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":65}],98:[function(e,t,n){var r=0,o=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+o).toString(36))}},{}],99:[function(e,t,n){var r=e("./_global"),o=e("./_core"),i=e("./_library"),s=e("./_wks-ext"),a=e("./_object-dp").f;t.exports=function(e){var t=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},{"./_core":49,"./_global":58,"./_library":70,"./_object-dp":74,"./_wks-ext":100}],100:[function(e,t,n){n.f=e("./_wks")},{"./_wks":101}],101:[function(e,t,n){var r=e("./_shared")("wks"),o=e("./_uid"),i=e("./_global").Symbol,s="function"==typeof i;(t.exports=function(e){return r[e]||(r[e]=s&&i[e]||(s?i:o)("Symbol."+e))}).store=r},{"./_global":58,"./_shared":90,"./_uid":98}],102:[function(e,t,n){"use strict";var r=e("./_add-to-unscopables"),o=e("./_iter-step"),i=e("./_iterators"),s=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,o(1)):"keys"==t?o(0,n):"values"==t?o(0,e[n]):o(0,[n,e[n]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},{"./_add-to-unscopables":45,"./_iter-define":67,"./_iter-step":68,"./_iterators":69,"./_to-iobject":94}],103:[function(e,t,n){var r=e("./_export");r(r.S+r.F,"Object",{assign:e("./_object-assign")})},{"./_export":56,"./_object-assign":72}],104:[function(e,t,n){var r=e("./_export");r(r.S,"Object",{create:e("./_object-create")})},{"./_export":56,"./_object-create":73}],105:[function(e,t,n){var r=e("./_export");r(r.S+r.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":52,"./_export":56,"./_object-dp":74}],106:[function(e,t,n){var r=e("./_to-object"),o=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return o(r(e))}})},{"./_object-gpo":80,"./_object-sap":84,"./_to-object":96}],107:[function(e,t,n){var r=e("./_to-object"),o=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return o(r(e))}})},{"./_object-keys":82,"./_object-sap":84,"./_to-object":96}],108:[function(e,t,n){var r=e("./_export");r(r.S,"Object",{setPrototypeOf:e("./_set-proto").set})},{"./_export":56,"./_set-proto":87}],109:[function(e,t,n){},{}],110:[function(e,t,n){"use strict";var r=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":67,"./_string-at":91}],111:[function(e,t,n){"use strict";var r=e("./_global"),o=e("./_has"),i=e("./_descriptors"),s=e("./_export"),a=e("./_redefine"),u=e("./_meta").KEY,c=e("./_fails"),l=e("./_shared"),h=e("./_set-to-string-tag"),f=e("./_uid"),d=e("./_wks"),p=e("./_wks-ext"),_=e("./_wks-define"),m=e("./_enum-keys"),v=e("./_is-array"),y=e("./_an-object"),b=e("./_to-iobject"),g=e("./_to-primitive"),w=e("./_property-desc"),j=e("./_object-create"),k=e("./_object-gopn-ext"),E=e("./_object-gopd"),x=e("./_object-dp"),O=e("./_object-keys"),T=E.f,N=x.f,C=k.f,S=r.Symbol,M=r.JSON,P=M&&M.stringify,L=d("_hidden"),A=d("toPrimitive"),R={}.propertyIsEnumerable,H=l("symbol-registry"),B=l("symbols"),I=l("op-symbols"),z=Object.prototype,q="function"==typeof S,D=r.QObject,U=!D||!D.prototype||!D.prototype.findChild,F=i&&c(function(){return 7!=j(N({},"a",{get:function(){return N(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=T(z,t);r&&delete z[t],N(e,t,n),r&&e!==z&&N(z,t,r)}:N,G=function(e){var t=B[e]=j(S.prototype);return t._k=e,t},W=q&&"symbol"==typeof S.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof S},V=function(e,t,n){return e===z&&V(I,t,n),y(e),t=g(t,!0),y(n),o(B,t)?(n.enumerable?(o(e,L)&&e[L][t]&&(e[L][t]=!1),n=j(n,{enumerable:w(0,!1)})):(o(e,L)||N(e,L,w(1,{})),e[L][t]=!0),F(e,t,n)):N(e,t,n)},Y=function(e,t){y(e);for(var n,r=m(t=b(t)),o=0,i=r.length;i>o;)V(e,n=r[o++],t[n]);return e},Q=function(e){var t=R.call(this,e=g(e,!0));return!(this===z&&o(B,e)&&!o(I,e))&&(!(t||!o(this,e)||!o(B,e)||o(this,L)&&this[L][e])||t)},J=function(e,t){if(e=b(e),t=g(t,!0),e!==z||!o(B,t)||o(I,t)){var n=T(e,t);return!n||!o(B,t)||o(e,L)&&e[L][t]||(n.enumerable=!0),n}},K=function(e){for(var t,n=C(b(e)),r=[],i=0;n.length>i;)o(B,t=n[i++])||t==L||t==u||r.push(t);return r},$=function(e){for(var t,n=e===z,r=C(n?I:b(e)),i=[],s=0;r.length>s;)!o(B,t=r[s++])||n&&!o(z,t)||i.push(B[t]);return i};q||(a((S=function(){if(this instanceof S)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function(n){this===z&&t.call(I,n),o(this,L)&&o(this[L],e)&&(this[L][e]=!1),F(this,e,w(1,n))};return i&&U&&F(z,e,{configurable:!0,set:t}),G(e)}).prototype,"toString",function(){return this._k}),E.f=J,x.f=V,e("./_object-gopn").f=k.f=K,e("./_object-pie").f=Q,e("./_object-gops").f=$,i&&!e("./_library")&&a(z,"propertyIsEnumerable",Q,!0),p.f=function(e){return G(d(e))}),s(s.G+s.W+s.F*!q,{Symbol:S});for(var X="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),Z=0;X.length>Z;)d(X[Z++]);for(var ee=O(d.store),te=0;ee.length>te;)_(ee[te++]);s(s.S+s.F*!q,"Symbol",{for:function(e){return o(H,e+="")?H[e]:H[e]=S(e)},keyFor:function(e){if(!W(e))throw TypeError(e+" is not a symbol!");for(var t in H)if(H[t]===e)return t},useSetter:function(){U=!0},useSimple:function(){U=!1}}),s(s.S+s.F*!q,"Object",{create:function(e,t){return void 0===t?j(e):Y(j(e),t)},defineProperty:V,defineProperties:Y,getOwnPropertyDescriptor:J,getOwnPropertyNames:K,getOwnPropertySymbols:$}),M&&s(s.S+s.F*(!q||c(function(){var e=S();return"[null]"!=P([e])||"{}"!=P({a:e})||"{}"!=P(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!W(e)){for(var t,n,r=[e],o=1;arguments.length>o;)r.push(arguments[o++]);return"function"==typeof(t=r[1])&&(n=t),!n&&v(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!W(t))return t}),r[1]=t,P.apply(M,r)}}}),S.prototype[A]||e("./_hide")(S.prototype,A,S.prototype.valueOf),h(S,"Symbol"),h(Math,"Math",!0),h(r.JSON,"JSON",!0)},{"./_an-object":46,"./_descriptors":52,"./_enum-keys":55,"./_export":56,"./_fails":57,"./_global":58,"./_has":59,"./_hide":60,"./_is-array":64,"./_library":70,"./_meta":71,"./_object-create":73,"./_object-dp":74,"./_object-gopd":76,"./_object-gopn":78,"./_object-gopn-ext":77,"./_object-gops":79,"./_object-keys":82,"./_object-pie":83,"./_property-desc":85,"./_redefine":86,"./_set-to-string-tag":88,"./_shared":90,"./_to-iobject":94,"./_to-primitive":97,"./_uid":98,"./_wks":101,"./_wks-define":99,"./_wks-ext":100}],112:[function(e,t,n){e("./_wks-define")("asyncIterator")},{"./_wks-define":99}],113:[function(e,t,n){e("./_wks-define")("observable")},{"./_wks-define":99}],114:[function(e,t,n){e("./es6.array.iterator");for(var r=e("./_global"),o=e("./_hide"),i=e("./_iterators"),s=e("./_wks")("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<a.length;u++){var c=a[u],l=r[c],h=l&&l.prototype;h&&!h[s]&&o(h,s,c),i[c]=i.Array}},{"./_global":58,"./_hide":60,"./_iterators":69,"./_wks":101,"./es6.array.iterator":102}],115:[function(e,t,n){"use strict";function r(e){return!!e&&"object"==typeof e}function o(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||i(e)}function i(e){return e.$$typeof===f}function s(e){return Array.isArray(e)?[]:{}}function a(e,t){return t&&!0===t.clone&&h(e)?l(s(e),e,t):e}function u(e,t,n){var r=e.slice();return t.forEach(function(t,o){void 0===r[o]?r[o]=a(t,n):h(t)?r[o]=l(e[o],t,n):-1===e.indexOf(t)&&r.push(a(t,n))}),r}function c(e,t,n){var r={};return h(e)&&Object.keys(e).forEach(function(t){r[t]=a(e[t],n)}),Object.keys(t).forEach(function(o){h(t[o])&&e[o]?r[o]=l(e[o],t[o],n):r[o]=a(t[o],n)}),r}function l(e,t,n){var r=Array.isArray(t),o=Array.isArray(e),i=n||{arrayMerge:u};return r===o?r?(i.arrayMerge||u)(e,t,n):c(e,t,n):a(t,n)}var h=function(e){return r(e)&&!o(e)},f="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;l.all=function(e,t){if(!Array.isArray(e)||e.length<2)throw new Error("first argument should be an array with at least two elements");return e.reduce(function(e,n){return l(e,n,t)})};var d=l;t.exports=d},{}],116:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return Math.random()*(t-e)+e}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/assign")),s=r(e("babel-runtime/helpers/classCallCheck")),a={debug:!1,automaticOpen:!0,reconnectOnError:!1,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,randomRatio:3,binaryType:"blob",reconnectOnCleanClose:!1};n.default=function e(t){var n=this,r=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],u=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];(0,s.default)(this,e),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.open=function(){var e=n._socket=new WebSocket(n._url,n._protocols);e.binaryType=n._options.binaryType,n._options.maxReconnectAttempts&&n._options.maxReconnectAttempts<n._reconnectAttempts||(n._syncState(),e.onmessage=n._onmessage.bind(n),e.onopen=n._onopen.bind(n),e.onclose=n._onclose.bind(n),e.onerror=n._onerror.bind(n))},this.send=function(e){n._socket&&n._socket.readyState===WebSocket.OPEN&&0===n._messageQueue.length?n._socket.send(e):n._messageQueue.push(e)},this.close=function(e,t){void 0===e&&(e=1e3),n._socket&&n._socket.close(e,t)},this._onmessage=function(e){n.onmessage&&n.onmessage(e)},this._onopen=function(e){n._syncState(),n._flushQueue(),n._reconnectAttempts=0,n.onopen&&n.onopen(e)},this._onclose=function(e){n._syncState(),n._debug("WebSocket: connection is broken",e),n.onclose&&n.onclose(e),n._tryReconnect(e)},this._onerror=function(e){n._socket.close(),n._debug("WebSocket: error",e),n.onerror&&n.onerror(e),n._options.reconnectOnError&&n._tryReconnect(e)},this._tryReconnect=function(e){e.wasClean&&!n._options.reconnectOnCleanClose||setTimeout(function(){n.readyState!==n.CLOSING&&n.readyState!==n.CLOSED||(n._reconnectAttempts++,n.open())},n._getTimeout())},this._flushQueue=function(){for(;0!==n._messageQueue.length;){var e=n._messageQueue.shift();n._socket.send(e)}},this._getTimeout=function(){var e=n._options.reconnectInterval*Math.pow(n._options.reconnectDecay,n._reconnectAttempts);return e=e>n._options.maxReconnectInterval?n._options.maxReconnectInterval:e,n._options.randomRatio?o(e/n._options.randomRatio,e):e},this._syncState=function(){n.readyState=n._socket.readyState},this._url=t,this._protocols=r,this._options=(0,i.default)({},a,u),this._messageQueue=[],this._reconnectAttempts=0,this.readyState=this.CONNECTING,"function"==typeof this._options.debug?this._debug=this._options.debug:this._options.debug?this._debug=console.log.bind(console):this._debug=function(){},u.automaticOpen&&this.open()},t.exports=n.default},{"babel-runtime/core-js/object/assign":26,"babel-runtime/helpers/classCallCheck":34}],117:[function(e,t,n){"use strict";function r(e,t){var n;return n=Array.isArray(e)?[]:{},t.push(e),Object.keys(e).forEach(function(o){var i=e[o];"function"!=typeof i&&(i&&"object"==typeof i?-1!==t.indexOf(e[o])?n[o]="[Circular]":n[o]=r(e[o],t.slice(0)):n[o]=i)}),"string"==typeof e.name&&(n.name=e.name),"string"==typeof e.message&&(n.message=e.message),"string"==typeof e.stack&&(n.stack=e.stack),n}t.exports=function(e){return"object"==typeof e?r(e,[]):"function"==typeof e?"[Function: "+(e.name||"anonymous")+"]":e}},{}],118:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/define-property")),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("@livelyvideo/utils/lib/createElement")),u=r(e("@livelyvideo/utils/lib/eventListener")),c=r(e("../utils/isBlurred")),l=function(){function e(t,n,r,i){o(this,e),this.parent=t,this.chatBody=n,this.localize=r,this.options=i,this.closeFlyoutOnBlur=this.closeFlyoutOnBlur.bind(this),this.actionMuteHandler=this.actionMuteHandler.bind(this),this.actionIgnoreHandler=this.actionIgnoreHandler.bind(this),this.actionBanHandler=this.actionBanHandler.bind(this),this.actionModHandler=this.actionModHandler.bind(this),this.render(),this._blurEvent=(0,u.default)(document,"click",this.closeFlyoutOnBlur),this._blurEventTouch=(0,u.default)(document,"touchend",this.closeFlyoutOnBlur)}return s(e,[{key:"render",value:function(){var e=this.parent.getBoundingClientRect().y<215?"chat__actions-flyout--bounds":"";this.flyout=(0,a.default)({tagName:"div",className:"chat__actions-flyout "+e+" "+(this.options.modifierClass||"")}),this.parent.parentElement.appendChild(this.flyout);var t=(0,a.default)({tagName:"div",className:"chat__actions-flyout-username",text:this.options.username});if(this.flyout.appendChild(t),this.options.url){var n=(0,a.default)({tagName:"a",className:"chat__actions-flyout-button",text:this.localize("View"),attributes:{href:this.options.url}});this.flyout.appendChild(n)}(this.chatBody.isMod||this.chatBody.isAdmin)&&(this.muteButton=(0,a.default)({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Mute"),events:{click:this.actionMuteHandler}}),this.flyout.appendChild(this.muteButton),this.banButton=(0,a.default)({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Ban IP"),events:{click:this.actionBanHandler}}),this.flyout.appendChild(this.banButton),this.ignoreButton=(0,a.default)({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Ignore"),events:{click:this.actionIgnoreHandler}}),this.flyout.appendChild(this.ignoreButton)),this.chatBody.isAdmin&&(this.modButton=(0,a.default)({tagName:"button",className:"chat__actions-flyout-button",text:this.options.role?this.localize("Unmod"):this.localize("Mod"),events:{click:this.actionModHandler}}),this.flyout.appendChild(this.modButton))}},{key:"actionModHandler",value:function(){var e=this;this.modButton.textContent!==this.localize("Unmod")?this.chatBody.modActionHandler(this.options.username,function(){e.modButton.textContent=e.localize("Unmod")}):this.chatBody.unmodActionHandler(this.options.username,function(){e.modButton.textContent=e.localize("Mod")})}},{key:"actionMuteHandler",value:function(){this.muteButton.textContent!==this.localize("Unmute")?(this.chatBody.muteActionHandler(this.options.username),this.muteButton.textContent=this.localize("Unmute")):this.chatBody.unmuteActionHandler(this.options.username)}},{key:"actionIgnoreHandler",value:function(){this.ignoreButton.textContent!==this.localize("Unignore")?(this.chatBody.ignoreActionHandler(this.options.username),this.ignoreButton.textContent=this.localize("Unignore")):this.chatBody.unignoreActionHandler(this.options.username)}},{key:"actionBanHandler",value:function(){this.banButton.textContent!==this.localize("Unban IP")?(this.chatBody.banActionHandler(this.options.username),this.banButton.textContent=this.localize("Unban IP")):this.chatBody.unbanActionHandler(this.options.username)}},{key:"closeFlyoutOnBlur",value:function(e){(0,c.default)(e,this.flyout,this.parent)&&this.close()}},{key:"close",value:function(){this._blurEvent(),this._blurEventTouch(),this._closed=!0,this.flyout.parentElement.removeChild(this.flyout)}}]),e}();n.default=l,t.exports=n.default},{"../utils/isBlurred":131,"@livelyvideo/utils/lib/createElement":23,"@livelyvideo/utils/lib/eventListener":24,"babel-runtime/core-js/object/define-property":28}],119:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=(0,c.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(u.default?(0,u.default)(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("babel-runtime/core-js/object/define-property")),u=r(e("babel-runtime/core-js/object/set-prototype-of")),c=r(e("babel-runtime/core-js/object/create")),l=r(e("babel-runtime/core-js/object/get-prototype-of")),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,a.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=r(e("@livelyvideo/utils/lib/createElement")),d=r(e("./chat-flyout")),p=[{name:"rateLimitDuration",value:1,text:"1s"},{name:"rateLimitDuration",value:5,text:"5s"},{name:"rateLimitDuration",value:30,text:"30s"},{name:"rateLimitDuration",value:60,text:"1m"},{name:"rateLimitDuration",value:300,text:"5m"},{name:"rateLimitDuration",value:900,text:"15m"}],_=[{name:"rateLimitMax",value:1,text:"1 chat"},{name:"rateLimitMax",value:5,text:"5 chats"},{name:"rateLimitMax",value:10,text:"10 chats"}],m=[{name:"mode",value:"user",text:"Everyone"},{name:"mode",value:"moderator",text:"Moderators"},{name:"mode",value:"owner",text:"Owner"}],v=function(e){function t(e,n,r,s){o(this,t);var a=i(this,(t.__proto__||(0,l.default)(t)).call(this,e,"admin",r("admin")));return a.parent=e,a.chat=n,a.localize=r,a.errorHandler=s,a.handleRadioChange=a.handleRadioChange.bind(a),a}return s(t,d.default),h(t,[{key:"initUser",value:function(){this.chat._roomname&&this.chat._me&&("moderator"!==this.chat._me.room.role&&"owner"!==this.chat._me.room.role&&"admin"!==this.chat._me.room.role||(this.render(),this.enableFlyout()))}},{key:"render",value:function(){var e=(0,f.default)({tagName:"div",className:"chat__info chat__info--mode",text:this.localize("Chat Mode")});this.flyout.appendChild(e),this.radioRenderer(m);var t=(0,f.default)({tagName:"div",className:"chat__description chat__description--mode",text:this.localize("The current mode of the room specifying which users can chat")});this.flyout.appendChild(t);var n=(0,f.default)({tagName:"div",className:"chat__info",text:this.localize("Chat Rate Limit")});this.flyout.appendChild(n),this.radioRenderer(_),this.radioRenderer(p);var r=(0,f.default)({tagName:"div",className:"chat__description",text:this.localize("Maximum amount of chats during time period")});this.flyout.appendChild(r)}},{key:"radioRenderer",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=(0,f.default)({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:e[n].name,value:e[n].value,id:e[n].name+n},events:{change:this.handleRadioChange}});this.chat._room[e[n].name]===e[n].value&&(r.checked="checked"),t.push(r);var o=(0,f.default)({tagName:"label",className:"chat__radio-label chat__radio-label--"+e.length,text:this.localize(e[n].text),attributes:{for:e[n].name+n}});t.push(o)}var i=(0,f.default)({tagName:"div",className:"chat__radio-slider chat__radio-slider--"+e.length});t.push(i);var s=(0,f.default)({tagName:"div",className:"chat__radio-wrapper",childs:t}),a=(0,f.default)({tagName:"div",className:"chat__radio-container chat__radio-container--restricted chat__radio-container--"+e[0].name,childs:[s]});this.flyout.appendChild(a)}},{key:"handleRadioChange",value:function(e){var t=this,n={};n[e.target.name]=isNaN(e.target.value)?e.target.value:parseInt(e.target.value,10),this.chat.patchRoom(this.chat._roomname,n,function(e,n){e&&n&&n[0]&&t.errorHandler(e,n[0])})}}]),t}();n.default=v,t.exports=n.default},{"./chat-flyout":123,"@livelyvideo/utils/lib/createElement":23,"babel-runtime/core-js/object/create":27,"babel-runtime/core-js/object/define-property":28,"babel-runtime/core-js/object/get-prototype-of":29,"babel-runtime/core-js/object/set-prototype-of":31}],120:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/define-property")),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("@livelyvideo/utils/lib/createElement")),u=r(e("@livelyvideo/utils/lib/eventListener")),c=r(e("./chat-actions-flyout")),l=function(){function e(t,n,r,i,s){var a=this;o(this,e),this.parent=t,this.chat=n,this.localize=r,this.errorHandler=i,this.options=s,this._chatLineQueue=[],this._currentChunk=this.buildChunkElement(),this._currentChunkSize=0,this._chunkView=[],this._chunkHistory=[],this._chunkStorage=[],this._scrollLocked=!0,this._scrollPaused=!1,this._scrollThrottleCount=0,this._scrollThrottleRate=100,this._scrollThrottleNewRate=!1,this.scrollToggle=this.scrollToggle.bind(this),this.scrollWheelHandler=this.scrollWheelHandler.bind(this),this.actionDelete=this.actionDelete.bind(this),this.actionMore=this.actionMore.bind(this),this.render(),this._queueProcess=setInterval(function(){a.queueProcessor()},100),setTimeout(function(){a._scrollThrottleCount=0,a._scrollThrottleInterval=setInterval(function(){a.scrollThrottleHandler()},2e3)},500),this._wheelListener1=(0,u.default)(this.chatBody,"DOMMouseScroll",this.scrollWheelHandler),this._wheelListener2=(0,u.default)(this.chatBody,"mousewheel",this.scrollWheelHandler),this._wheelListener3=(0,u.default)(this.chatBody,"wheel",this.scrollWheelHandler)}return s(e,[{key:"queueProcessor",value:function(){if(!this._scrollPaused){this._chatLineQueue.length&&this._scrollThrottleCount++;for(var e=document.createDocumentFragment();this._chatLineQueue.length&&this._currentChunkSize!==this.options.chunkSize;){var t=this._chatLineQueue.shift();e.appendChild(t),this._currentChunkSize++}if(this._currentChunk.appendChild(e),this._currentChunk.parentElement||this._chunkStorage.push(this._currentChunk),this._currentChunkSize===this.options.chunkSize&&(this._currentChunk=this.buildChunkElement(),this._currentChunksProcessed++,this._currentChunkSize=0),this._chatLineQueue.length)this.queueProcessor();else{for(var n=document.createDocumentFragment(),r=this._chunkStorage.splice(-Math.abs(this.options.chunkView));r.length;){var o=r.shift();n.appendChild(o),this._chunkView.push(o)}for(this.chatBody.appendChild(n);this._chunkView.length>this.options.chunkView;){var i=this._chunkView.shift();this.chatBody.removeChild(i),this._chunkHistory.unshift(i)}for(;this._chunkStorage.length;)this._chunkHistory.unshift(this._chunkStorage.shift());for(;this._chunkHistory>this.options.chunkHistory;)this._chunkHistory.shift();this.scrollBottom()}}}},{key:"scrollThrottleHandler",value:function(){var e=this;switch(this._scrollThrottleNewRate&&(this._scrollThrottleNewRate=!1,this._scrollThrottleCount++),this._scrollThrottleRate){case 100:this._scrollThrottleCount>=10&&(this._scrollThrottleRate=200,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate));break;case 200:this._scrollThrottleCount>=10?(this._scrollThrottleRate=250,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate)):this._scrollThrottleCount<5&&(this._scrollThrottleRate=100,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate));break;default:this._scrollThrottleCount<8&&(this._scrollThrottleRate=200,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate))}this._scrollThrottleCount=0}},{key:"processChat",value:function(e){if(!e.ignore){var t=this.buildLineElement(),n=this.writeChatToLine(t,e);this._chatLineQueue.push(n)}}},{key:"processMessage",value:function(e){var t=this.buildLineElement(),n=this.writeMessageToLine(t,e);this._chatLineQueue.push(n)}},{key:"render",value:function(){this.chatBody=(0,a.default)({tagName:"div",className:"chat__body"}),this.chatBodyContainer=(0,a.default)({tagName:"div",className:"chat__body-container",childs:[this.chatBody]}),this.chatBodyScrollButton=(0,a.default)({tagName:"div",className:"chat__body-scroll",events:{click:this.scrollToggle}}),this.parent.appendChild(this.chatBodyContainer),this.parent.appendChild(this.chatBodyScrollButton)}},{key:"buildChunkElement",value:function(){return this._chunkElement?this._chunkElement.cloneNode():(this._chunkElement=(0,a.default)({tagName:"div",className:"chat__chunk"}),this._chunkElement.cloneNode(!0))}},{key:"buildLineElement",value:function(){if(this._lineElement)return this._lineElement.cloneNode(!0);var e=[],t=(0,a.default)({tagName:"div",className:"chat__avatar"});e.push(t);var n=(0,a.default)({tagName:"span",className:"chat__line-role"});e.push(n);var r=(0,a.default)({tagName:"span",className:"chat__username"});e.push(r);var o=(0,a.default)({tagName:"span",className:"chat__line-timestamp"});e.push(o);var i=(0,a.default)({tagName:"div",className:"chat__line-content"});e.push(i);var s=(0,a.default)({tagName:"button",className:"chat__action chat__action--delete",attributes:{"data-tooltip":"Delete Chat"}});e.push(s);var u=(0,a.default)({tagName:"button",className:"chat__action chat__action--more",attributes:{"data-tooltip":"More Actions"}});return e.push(u),this._lineElement=(0,a.default)({tagName:"div",className:"chat__line",childs:e}),this._lineElement.cloneNode(!0)}},{key:"writeChatToLine",value:function(e,t){var n=e,r=n.childNodes;return r[0].setAttribute("style","background-color: "+t.actor.color+"; background-image: url("+t.actor.avatar+");"),r[1].className="chat__line-role chat__line-role--"+t.actor.role,r[1].textContent=t.actor.role,r[2].setAttribute("style","color: "+t.actor.color),r[2].textContent=t.actor.username,r[3].textContent=this.formatDate(t.timestamp),r[4].innerHTML=this.parseChatText(t),n.className="chat__line"+(t.actor.username===this.chat._username||void 0===this.chat._username?" chat__line--currentUser":""),n.setAttribute("data-username",t.actor.username),n.setAttribute("data-id",t.id),"moderator"===t.actor.role&&n.setAttribute("data-role",t.actor.role),t.url&&n.setAttribute("data-url",t.url),(0,u.default)(r[5],"click",this.actionDelete),(0,u.default)(r[6],"click",this.actionMore),n}},{key:"writeMessageToLine",value:function(e,t){var n=e,r=n.childNodes,o="";switch(t.level){case"warn":o="#EBC844";break;case"info":o="#1395BA";break;default:o="#D94E1F"}r[0].setAttribute("style","background-color: "+o+"; background-image: none;"),r[1].className="",r[1].textContent="",r[2].setAttribute("style","color: "+o),r[2].textContent=t.level,r[3].textContent="",r[4].innerHTML='<div class="chat__text">'+t.message+"</div>",n.className="chat__line chat__line--message chat__line--"+t.level;var i=function(e){e.parentElement.removeChild(e)}.bind(this,n);return(0,u.default)(r[5],"click",i),n}},{key:"formatDate",value:function(e){var t=new Date(1e3*e),n="0"+t.getMinutes(),r=t.getHours();return r%=12,(r=r||12)+":"+n.substr(-2)}},{key:"parseChatText",value:function(e){var t="<div class='chat__text'>",n=e.message,r=e.positions,o=0;for(var i in r){i=parseInt(i,10);var s=n.slice(o,i),a=n.slice(i,i+r[i].length);switch(o=i+r[i].length,s.length&&(t+=s),r[i].type){case"emoticon":this.chat&&this.chat._me&&this.chat._me.showGifs,t+="<span class='chat__line-emoticon-wrap' data-pattern='"+a+"'><img class='chat__line-emoticon' src='"+r[i].url+"'/></span>";break;case"mention":t+="<a class='"+(this.chat._username===r[i].username?"chat__line-mention chat__line-mention--me":"chat__line-mention")+"' href='/"+r[i].url+"' target='_blank'>"+a+"</a>";break;case"tag":t+="<a class='chat__line-tag' href='/tag/"+r[i].text+"' target='_blank'>"+a+"</a>";break;default:t+="<a class='chat__line-link' href='"+r[i].href+"' target='_blank'>"+a+"</a>"}}return o<n.length&&(t+=n.slice(o)),t+="</div>"}},{key:"scrollToggle",value:function(){if(this._scrollPaused)return this._scrollPaused=!1,void this.chatBodyScrollButton.classList.remove("chat__body-scroll--paused");this._scrollPaused=!0,this.chatBodyScrollButton.classList.add("chat__body-scroll--paused")}},{key:"scrollBottom",value:function(){this.chatBody.scrollTop=this.chatBody.scrollHeight}},{key:"scrollWheelHandler",value:function(){if(this.chatBody.scrollTop<=0&&this._scrollPaused&&this._chunkHistory.length){var e=this._chunkHistory.shift();return this.chatBody.insertBefore(e,this.chatBody.firstChild),void this._chunkView.unshift(e)}Math.abs(this.chatBody.scrollTop-(this.chatBody.scrollHeight-this.chatBody.offsetHeight))<=5?this._scrollPaused&&this.scrollToggle():this._scrollPaused||this.scrollToggle()}},{key:"actionDelete",value:function(e){var t=e.target.parentElement.getAttribute("data-id");this.chat.command("/delete "+t)}},{key:"actionMore",value:function(e){var t={username:e.target.parentElement.getAttribute("data-username"),id:e.target.parentElement.getAttribute("data-id"),url:e.target.parentElement.getAttribute("data-url"),role:e.target.parentElement.getAttribute("data-role")};if(this.flyout&&!this.flyout._closed&&t.id===this.flyout.options.id)return this.flyout.close(),void(this.flyout=!1);this.flyout=new c.default(e.target,this,this.localize,t)}},{key:"modActionHandler",value:function(e,t){var n=this;this.chat.command("/mod "+e,function(e,r){e?n.errorHandler(e,r[0]):(r&&r[0],t&&t())})}},{key:"unmodActionHandler",value:function(e,t){var n=this;this.chat.command("/unmod "+e,function(e,r){e?n.errorHandler(e,r[0]):(r&&r[0],t&&t())})}},{key:"muteActionHandler",value:function(e,t){var n=this;this.chat.command("/mute "+e,function(e,r){e?n.errorHandler(e,r[0]):(r&&r[0],t&&t())}),this.deleteByUsername(e)}},{key:"unmuteActionHandler",value:function(e,t){var n=this;this.chat.command("/unmute "+e,function(e,r){e?n.errorHandler(e,r[0]):(r&&r[0],t&&t())})}},{key:"ignoreActionHandler",value:function(e,t){var n=this;this.chat.command("/ignore "+e,function(e,r){e?n.errorHandler(e,r[0]):(r&&r[0],t&&t())}),this.deleteByUsername(e,!0)}},{key:"unignoreActionHandler",value:function(e,t){var n=this;this.chat.command("/unignore "+e,function(e,r){e?n.errorHandler(e,r[0]):(r&&r[0],t&&t())})}},{key:"banActionHandler",value:function(e,t){var n=this;this.chat.command("/ban "+e,function(e,r){e?n.errorHandler(e,r[0]):(r&&r[0],t&&t())}),this.deleteByUsername(e)}},{key:"unbanActionHandler",value:function(e,t){var n=this;this.chat.command("/unban "+e,function(e,r){e?n.errorHandler(e,r[0]):(r&&r[0],t&&t())})}},{key:"deleteById",value:function(e){for(var t=0;t<this._chunkView.length;t++)for(var n=this._chunkView[t].childNodes,r=0;r<n.length;r++)if(n[r].getAttribute("data-id")===e){if(this.isMod||this.isAdmin)return void n[r].classList.add("chat__line--removed");n[r].parentElement.removeChild(n[r])}}},{key:"deleteByUsername",value:function(e,t){for(var n=0;n<this._chunkView.length;n++)for(var r=this._chunkView[n].childNodes,o=0;o<r.length;o++)if(r[o].getAttribute("data-username")===e){if(t)return void r[o].parentElement.removeChild(r[o]);this.actionDelete(r[o].getAttribute("data-id"))}}},{key:"destroy",value:function(){this._wheelListener1(),this._wheelListener2(),this._wheelListener3()}},{key:"isMod",get:function(){return!!(this.chat._me&&this.chat._me.room&&this.chat._me.room.role)&&"moderator"===this.chat._me.room.role}},{key:"isAdmin",get:function(){return!!(this.chat._me&&this.chat._me.room&&this.chat._me.room.role)&&("owner"===this.chat._me.room.role||"admin"===this.chat._me.room.role)}}]),e}();n.default=l,t.exports=n.default},{"./chat-actions-flyout":118,"@livelyvideo/utils/lib/createElement":23,"@livelyvideo/utils/lib/eventListener":24,"babel-runtime/core-js/object/define-property":28}],121:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/define-property")),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("@livelyvideo/utils/lib/createElement")),u=function(){function e(t){o(this,e),this.parent=t,this.render()}return s(e,[{key:"render",value:function(){this.el=(0,a.default)({tagName:"div",className:"chat__controls"}),this.parent.appendChild(this.el)}}]),e}();n.default=u,t.exports=n.default},{"@livelyvideo/utils/lib/createElement":23,"babel-runtime/core-js/object/define-property":28}],122:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=(0,c.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(u.default?(0,u.default)(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("babel-runtime/core-js/object/define-property")),u=r(e("babel-runtime/core-js/object/set-prototype-of")),c=r(e("babel-runtime/core-js/object/create")),l=r(e("babel-runtime/core-js/object/keys")),h=r(e("babel-runtime/core-js/object/get-prototype-of")),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,a.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=r(e("@livelyvideo/utils/lib/createElement")),p=r(e("./chat-flyout")),_=function(e){function t(e,n,r,s,a){o(this,t);var u=i(this,(t.__proto__||(0,h.default)(t)).call(this,e,"emoticons",s("emoticons")));return u.parent=e,u.chat=n,u.chatInput=r,u.localize=s,u.errorHandler=a,u}return s(t,p.default),f(t,[{key:"initUser",value:function(){this.enableFlyout()}},{key:"getEmoticons",value:function(){var e=this;this.chat.getAllEmoticons(this.chat._roomname,this.chat._username,function(t,n){t&&e.errorHandler(t,e.localize("Chat Error")),e.emoticons=n.emoticons,e.render()})}},{key:"firstToggleHandler",value:function(){this.getEmoticons()}},{key:"render",value:function(){var e=this;(0,l.default)(this.emoticons).map(function(t){var n=e.emoticons[t],r=(0,d.default)({tagName:"button",className:"chat__emoticon-selector",attributes:{style:"background-image: url("+n.source+")",title:n.pattern}}),o=(0,d.default)({tagName:"span",className:"chat__emoticon-selector-container",childs:[r]}),i=e.selectEmoticon.bind(e,n.pattern);return o.addEventListener("click",i),e.flyout.appendChild(o)}),this.parent.appendChild(this.flyout);var t=(0,d.default)({tagName:"a",className:"chat__attribution-link",text:"EmojiOne",attributes:{href:"http://emojione.com"}}),n=(0,d.default)({tagName:"div",className:"chat__attribution",text:"Emoji provided free by ",childs:[t]});this.flyout.appendChild(n)}},{key:"selectEmoticon",value:function(e){this.chatInput.chatInput.value=""+this.chatInput.chatInput.value+e+" ",this.chatInput.chatInput.focus(),this.toggleFlyout()}}]),t}();n.default=_,t.exports=n.default},{"./chat-flyout":123,"@livelyvideo/utils/lib/createElement":23,"babel-runtime/core-js/object/create":27,"babel-runtime/core-js/object/define-property":28,"babel-runtime/core-js/object/get-prototype-of":29,"babel-runtime/core-js/object/keys":30,"babel-runtime/core-js/object/set-prototype-of":31}],123:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/define-property")),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("@livelyvideo/utils/lib/createElement")),u=r(e("@livelyvideo/utils/lib/eventListener")),c=r(e("../utils/isBlurred")),l=function(){function e(t,n,r){o(this,e),this.parent=t,this.flyoutClassModifier=n,this.tooltipText=r,this._firstToggle=!0,this._toggleState=!1,this.toggleFlyout=this.toggleFlyout.bind(this),this.closeFlyoutOnBlur=this.closeFlyoutOnBlur.bind(this),this.flyoutRender()}return s(e,[{key:"flyoutRender",value:function(){var e=(0,a.default)({tagName:"span",className:"chat__tooltip chat__tooltip--"+this.flyoutClassModifier,text:this.tooltipText});this.flyoutButton=(0,a.default)({tagName:"button",className:"chat__flyout-button chat__flyout-button--"+this.flyoutClassModifier+" chat__flyout-button--disabled",childs:[e]}),this.parent.appendChild(this.flyoutButton),this.flyout=(0,a.default)({tagName:"div",className:"chat__flyout chat__flyout--"+this.flyoutClassModifier}),this.parent.parentElement.appendChild(this.flyout)}},{key:"enableFlyout",value:function(){this.flyoutButton.classList.remove("chat__flyout-button--disabled"),(0,u.default)(this.flyoutButton,"click",this.toggleFlyout)}},{key:"closeFlyoutOnBlur",value:function(e){(0,c.default)(e,this.flyout,this.flyoutButton)&&(this._blurEvent(),this._blurEventTouch(),this._blurEvent=null,this.flyout.classList.remove("chat__flyout--visible"))}},{key:"toggleFlyout",value:function(){this._firstToggle&&this.firstToggleHandler&&(this._firstToggle=!1,this.firstToggleHandler()),this.toggleStateHandler&&(this.toggleStateHandler(this._toggleState),this._toggleState=!this._toggleState),this.flyout.classList.toggle("chat__flyout--visible"),this._blurEvent||(this._blurEvent=(0,u.default)(document,"click",this.closeFlyoutOnBlur),this._blurEventTouch=(0,u.default)(document,"touchend",this.closeFlyoutOnBlur))}}]),e}();n.default=l,t.exports=n.default},{"../utils/isBlurred":131,"@livelyvideo/utils/lib/createElement":23,"@livelyvideo/utils/lib/eventListener":24,"babel-runtime/core-js/object/define-property":28}],124:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/define-property")),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("@livelyvideo/utils/lib/createElement")),u=function(){function e(t,n){o(this,e),this.parent=t,this.chat=n,this.render()}return s(e,[{key:"initRoom",value:function(e){this.chatHeaderTitle.textContent=e}},{key:"render",value:function(){this.chatHeaderTitle=(0,a.default)({tagName:"h1",className:"chat__header-title"}),this.el=(0,a.default)({tagName:"div",className:"chat__header",childs:[this.chatHeaderTitle]}),this.parent.appendChild(this.el)}}]),e}();n.default=u,t.exports=n.default},{"@livelyvideo/utils/lib/createElement":23,"babel-runtime/core-js/object/define-property":28}],125:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/define-property")),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("@livelyvideo/utils/lib/createElement")),u=function(){function e(t,n,r,i,s,a){o(this,e),this.parent=t,this.chat=n,this.chatBody=r,this.localize=i,this.errorHandler=s,this.sendMiddleware=a&&a.sendMiddleware,this.send=this.send.bind(this),this.render()}return s(e,[{key:"initUser",value:function(){this.chatInput.classList.remove("chat__input--disabled"),this.chatInput.removeAttribute("disabled"),this.chatInput.setAttribute("placeholder",this.localize("Send message")),this.chatSend.classList.remove("chat__input-send--disabled"),this.chatSend.removeAttribute("disabled")}},{key:"render",value:function(){var e=this;this.chatInput=(0,a.default)({tagName:"input",className:"chat__input chat__input--disabled",attributes:{placeholder:this.localize("Login to chat"),disabled:"disabled"}});var t=(0,a.default)({tagName:"span",className:"chat__tooltip chat__tooltip--send",text:this.localize("send")});this.chatSend=(0,a.default)({tagName:"button",className:"chat__flyout-button chat__input-send chat__input-send--disabled",attributes:{disabled:"disabled"},events:{click:this.send},childs:[t]}),this.chatInputWrapper=(0,a.default)({tagName:"div",className:"chat__input-wrapper",childs:[this.chatInput,this.chatSend]}),this.chatInput.addEventListener("keyup",function(t){t.preventDefault(),13===t.keyCode&&e.send()}),this.parent.appendChild(this.chatInputWrapper)}},{key:"send",value:function(){var e=this,t=this.chatInput.value;if(null===t.match(/^\s+$/)){if(t){this.chatInput.value="";var n=function(){e.chat.command(t,function(t,n){if(t)throw t;if(n&&n.length)for(var r=0;r<n.length;r++){if(n[r].data&&n[r].data.help){for(var o in n[r].data.help){var i=n[r].data.help[o];e.chatBody.processMessage({level:"info",message:"/"+i.name+" "+i.text})}return}e.chatBody.processMessage(n[r])}})};if(this.sendMiddleware)return void this.sendMiddleware(t,n);n()}}else this.chatInput.value=""}}]),e}();n.default=u,t.exports=n.default},{"@livelyvideo/utils/lib/createElement":23,"babel-runtime/core-js/object/define-property":28}],126:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=(0,c.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(u.default?(0,u.default)(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("babel-runtime/core-js/object/define-property")),u=r(e("babel-runtime/core-js/object/set-prototype-of")),c=r(e("babel-runtime/core-js/object/create")),l=r(e("babel-runtime/core-js/object/get-prototype-of")),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,a.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=r(e("@livelyvideo/utils/lib/createElement")),d=r(e("./chat-flyout")),p=function(e){function t(e,n,r,s){o(this,t);var a=i(this,(t.__proto__||(0,l.default)(t)).call(this,e,"options",r("options")));return a.parent=e,a.chat=n,a.localize=r,a.errorHandler=s,a.showGifsHandler=a.showGifsHandler.bind(a),a.showTimestampsHandler=a.showTimestampsHandler.bind(a),a}return s(t,d.default),h(t,[{key:"initUser",value:function(){this.enableFlyout(),this.renderOptions()}},{key:"renderOptions",value:function(){var e=(0,f.default)({tagName:"div",className:"chat__options-switch-slider"}),t=(0,f.default)({tagName:"div",className:"chat__options-switch-name",text:this.localize("Show Animated Gifs")}),n=(0,f.default)({tagName:"input",className:"chat__options-switch-checkbox",attributes:{type:"checkbox",id:"showGifs"},events:{change:this.showGifsHandler}});this.chat._me.showGifs&&(n.checked=!0);var r=(0,f.default)({tagName:"label",className:"chat__options-switch",childs:[e],attributes:{for:"showGifs"}}),o=(0,f.default)({tagName:"div",className:"chat__options-switch-container",childs:[n,r,t]}),i=(0,f.default)({tagName:"div",className:"chat__options-switch-slider"}),s=(0,f.default)({tagName:"div",className:"chat__options-switch-name",text:this.localize("Show Timestamps")}),a=(0,f.default)({tagName:"input",className:"chat__options-switch-checkbox",attributes:{type:"checkbox",id:"showTimestamps"},events:{change:this.showTimestampsHandler}});this.chat._me.showTimestamps&&(a.checked=!0);var u=(0,f.default)({tagName:"label",className:"chat__options-switch",childs:[i],attributes:{for:"showTimestamps"}}),c=(0,f.default)({tagName:"div",className:"chat__options-switch-container",childs:[a,u,s]});this.flyout.appendChild(c),this.flyout.appendChild(o)}},{key:"showGifsHandler",value:function(e){var t=this,n={};n.showGifs=e.target.checked,this.chat.patchUser(this.chat._username,n,function(e,n){e&&n&&t.errorHandler(e,n[0])})}},{key:"showTimestampsHandler",value:function(e){var t=this,n={};n.showTimestamps=e.target.checked,this.chat.patchUser(this.chat._username,n,function(e,n){e&&n&&t.errorHandler(e,n[0])})}}]),t}();n.default=p,t.exports=n.default},{"./chat-flyout":123,"@livelyvideo/utils/lib/createElement":23,"babel-runtime/core-js/object/create":27,"babel-runtime/core-js/object/define-property":28,"babel-runtime/core-js/object/get-prototype-of":29,"babel-runtime/core-js/object/set-prototype-of":31}],127:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=r(e("babel-runtime/core-js/object/define-property")),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=r(e("@livelyvideo/utils/lib/createElement")),u=function(){function e(t,n,r){o(this,e),this.parent=t,this.onClick=n,this.localize=r,this.render()}return s(e,[{key:"render",value:function(){var e=(0,a.default)({tagName:"span",className:"chat__tooltip",text:this.localize("popout")});this.el=(0,a.default)({tagName:"button",className:"chat__flyout-button chat__flyout-button--popout",events:{click:this.onClick},childs:[e]}),this.parent.appendChild(this.el)}}]),e}();n.default=u,t.exports=n.default},{"@livelyvideo/utils/lib/createElement":23,"babel-runtime/core-js/object/define-property":28}],128:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=(0,c.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(u.default?(0,u.default)(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("babel-runtime/core-js/object/define-property")),u=r(e("babel-runtime/core-js/object/set-prototype-of")),c=r(e("babel-runtime/core-js/object/create")),l=r(e("babel-runtime/core-js/object/get-prototype-of")),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,a.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=r(e("@livelyvideo/utils/lib/createElement")),d=r(e("./chat-flyout")),p=r(e("./chat-actions-flyout")),_=function(e){function t(e,n,r,s,a,u){o(this,t);var c=i(this,(t.__proto__||(0,l.default)(t)).call(this,e,"roster",s("roster")));return c.parent=e,c.chat=n,c.chatBody=r,c.localize=s,c.errorHandler=a,c.options=u,c.updateRoster=c.updateRoster.bind(c),c.cleanUpdateRoster=c.cleanUpdateRoster.bind(c),c.handleRadioChange=c.handleRadioChange.bind(c),c.loadMoreHandler=c.loadMoreHandler.bind(c),c.actionMore=c.actionMore.bind(c),c}return s(t,d.default),h(t,[{key:"initUser",value:function(){this.render(),this.roster=this.chat.getRoster({limit:this.options.rosterLimit,role:""}),this.enableFlyout()}},{key:"toggleStateHandler",value:function(e){e||this.roster.update(this.cleanUpdateRoster)}},{key:"render",value:function(){this.rosterRadioUser=(0,f.default)({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:"rosterSort",value:"",checked:"checked",id:"rosterSortUser"},events:{change:this.handleRadioChange}}),this.rosterRadioModerator=(0,f.default)({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:"rosterSort",value:"moderator",id:"rosterSortModerator"},events:{change:this.handleRadioChange}}),this.rosterRadioUserLabel=(0,f.default)({tagName:"label",className:"chat__radio-label",text:this.localize("Everyone"),attributes:{for:"rosterSortUser"}}),this.rosterRadioModeratorLabel=(0,f.default)({tagName:"label",className:"chat__radio-label",text:this.localize("Moderators"),attributes:{for:"rosterSortModerator"}}),this.rosterRadioWrapper=(0,f.default)({tagName:"div",className:"chat__radio-wrapper",childs:[this.rosterRadioUser,this.rosterRadioUserLabel,this.rosterRadioModerator,this.rosterRadioModeratorLabel]}),this.rosterRadioContainer=(0,f.default)({tagName:"div",className:"chat__radio-container chat__radio-container--sort",childs:[this.rosterRadioWrapper]}),this.rosterLoadMore=(0,f.default)({tagName:"button",className:"chat__roster-load-more",text:this.localize("Load More"),events:{click:this.loadMoreHandler}}),this.rosterContainer=(0,f.default)({tagName:"div",className:"chat__roster-container"}),this.rosterScrollContainer=(0,f.default)({tagName:"div",className:"chat__roster-scroll",childs:[this.rosterContainer,this.rosterLoadMore]}),this.flyout.appendChild(this.rosterRadioContainer),this.flyout.appendChild(this.rosterScrollContainer)}},{key:"handleRadioChange",value:function(e){var t={limit:this.options.rosterLimit};t.role=e.target.value,this.roster._options=t,this.roster.update(this.cleanUpdateRoster)}},{key:"loadMoreHandler",value:function(){this.roster.next(this.updateRoster)}},{key:"cleanUpdateRoster",value:function(e,t){for(;this.rosterContainer.firstChild;)this.rosterContainer.removeChild(this.rosterContainer.firstChild);this.updateRoster(e,t)}},{key:"updateRoster",value:function(e,t){if(e)this.errorHandler(e,{message:this.localize("Error updating roster"),level:"error"});else{for(var n=0;n<t.length;n++){var r=[];if("user"!==t[n].role){var o=(0,f.default)({tagName:"span",className:"chat__roster-role",text:t[n].role,attributes:{style:"background:"+t[n].roleColor}});r.push(o)}var i=(0,f.default)({tagName:"span",className:"chat__roster-actor",text:t[n].username});r.push(i);var s=(0,f.default)({tagName:"button",className:"chat__action chat__action--more chat__action--roster",attributes:{"data-tooltip":"More Actions"},events:{click:this.actionMore}});r.push(s);var a=(0,f.default)({tagName:"div",className:"chat__roster-actor-container",childs:r,attributes:{"data-username":t[n].username,"data-role":t[n].role}});this.rosterContainer.appendChild(a)}this.roster._nextParams?this.rosterLoadMore.classList.remove("chat__roster-load-more--disable"):this.rosterLoadMore.classList.add("chat__roster-load-more--disable")}}},{key:"actionMore",value:function(e){var t={username:e.target.parentElement.getAttribute("data-username"),id:e.target.parentElement.getAttribute("data-username"),role:e.target.parentElement.getAttribute("data-role"),modifierClass:"chat__actions-flyout--roster"};if(this.actionsFlyout&&!this.actionsFlyout._closed&&t.id===this.actionsFlyout.options.id)return this.actionsFlyout.close(),void(this.actionsFlyout=!1);this.actionsFlyout=new p.default(e.target,this.chatBody,this.localize,t)}}]),t}();n.default=_,t.exports=n.default},{"./chat-actions-flyout":118,"./chat-flyout":123,"@livelyvideo/utils/lib/createElement":23,"babel-runtime/core-js/object/create":27,"babel-runtime/core-js/object/define-property":28,"babel-runtime/core-js/object/get-prototype-of":29,"babel-runtime/core-js/object/set-prototype-of":31}],129:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=(0,f.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(h.default?(0,h.default)(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("babel-runtime/core-js/symbol/iterator")),u=r(e("babel-runtime/core-js/symbol")),c=r(e("babel-runtime/core-js/object/assign")),l=r(e("babel-runtime/core-js/object/define-property")),h=r(e("babel-runtime/core-js/object/set-prototype-of")),f=r(e("babel-runtime/core-js/object/create")),d=r(e("babel-runtime/core-js/object/get-prototype-of")),p="function"==typeof u.default&&"symbol"==typeof a.default?function(e){return typeof e}:function(e){return e&&"function"==typeof u.default&&e.constructor===u.default&&e!==u.default.prototype?"symbol":typeof e},_=c.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,l.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();e("classlist-polyfill");var v=r(e("events")),y=r(e("@livelyvideo/chat-core/lib/source")),b=r(e("@livelyvideo/logger-core/lib/source")),g=r(e("@livelyvideo/localization")),w=r(e("@livelyvideo/utils/lib/createElement")),j=r(e("@livelyvideo/utils/lib/forwardEvents")),k=r(e("./utils/popout")),E=r(e("./package-json")),x=r(e("./components/chat-body")),O=r(e("./components/chat-emoticons")),T=r(e("./components/chat-input")),N=r(e("./components/chat-options")),C=r(e("./components/chat-roster")),S=r(e("./components/chat-admin")),M=r(e("./components/chat-controls")),P=r(e("./components/chat-popout")),L=r(e("./components/chat-header")),A=new b.default(E.default),R={user:null,room:null,host:null,authUrl:null,popout:null,chunkHistory:20,chunkSize:10,chunkView:5,rosterLimit:100,locale:null,messages:null,sendMiddleware:null,loggerOptions:{}},H=function(e){function t(e,n){o(this,t);var r=i(this,(t.__proto__||(0,d.default)(t)).call(this));r.options=_({},R,n);var s=new g.default(r.options.locale,r.options.messages);return r.localize=s.localize.bind(s),r.errorHandler=r.errorHandler.bind(r),r.mount(e),r.init(),r}return s(t,v.default),m(t,[{key:"init",value:function(){var e=this;this.chat=new y.default({room:this.options.room,host:this.options.host,wshost:this.options.wshost,insecure:this.options.insecure,roleHistory:this.options.roleHistory},{url:this.options.authUrl}),this.chat.on("error",function(t,n){return e.errorHandler(t,n)}),(0,j.default)(this.chat,this),A.setOptions(this.options.loggerOptions,this),A.setInstanceOptions({host:this.options.host}),this.render(),this.initUnauthedUser()}},{key:"mount",value:function(e){var t=this;switch(void 0===e?"undefined":p(e)){case"string":this.el=document.querySelector(e);break;case"object":this.el=e;break;default:setTimeout(function(){return t.emit("error",new Error("The constructor has not been given a valid element or selector."))})}this.el.classList.add("chat")}},{key:"errorHandler",value:function(e,t){var n=void 0;switch(void 0===e?"undefined":p(e)){case"string":n={level:"error",message:this.localize(e)};break;case"object":if(e instanceof Error){n={level:"error",message:this.localize(e.message)};break}}this.chatBody&&this.chatBody.processMessage(n)}},{key:"render",value:function(){var e=this;this.chatHeader=new L.default(this.el,this.chat),this.chatBody=new x.default(this.el,this.chat,this.localize,this.errorHandler,this.options),this.chatInput=new T.default(this.el,this.chat,this.chatBody,this.localize,this.errorHandler,this.options),this.chatEmoticons=new O.default(this.el,this.chat,this.chatInput,this.localize,this.errorHandler),this.chatControls=new M.default(this.el),this.options.popout&&(this.chatPopout=new P.default(this.chatControls.el,this.openPopout.bind(this),this.localize)),this.chatAdmin=new S.default(this.chatControls.el,this.chat,this.localize,this.errorHandler,this.options),this.chatRoster=new C.default(this.chatControls.el,this.chat,this.chatBody,this.localize,this.errorHandler,this.options),this.chatOptions=new N.default(this.chatControls.el,this.chat,this.localize,this.errorHandler),this.chat.on("chat",function(t){return e.chatBody.processChat(t)}),this.chat.once("room",function(t){e.chat._roomname=t.name,e.chatHeader.initRoom(t.title||t.name)}),this.chat.on("message",function(t){return e.chatBody.processMessage(t)}),this.chat.on("delete",function(t){return e.chatBody.deleteById(t.id)})}},{key:"initUnauthedUser",value:function(){var e=this;this.chat.once("me",function(t){if(e.chat._username=t.username,t){if(e.history)for(var n=0;n<e.history.messages.length;n++)e.chatBody.processChat(e.history.messages[n]);e.meHandler(t),e.initAuthedUser(t)}else e.roleHandler({room:{role:"anon"}})}),this.history=!1,this.chat.once("history",function(t){if(e.chat_username&&t)for(var n=0;n<t.messages.length;n++)e.chatBody.processChat(t.messages[n]);else e.history=t})}},{key:"initAuthedUser",value:function(e){var t=this;this.chatOptions.initUser(),this.chatEmoticons.initUser(),this.chatInput.initUser(),this.chatRoster.initUser(),this.chatAdmin.initUser(),this._currentRole=e.room.role,this.chat.on("me",function(e){return t.meHandler(e)})}},{key:"meHandler",value:function(e){this.roleHandler(e),e.showTimestamps?this.el.classList.add("chat--timestamps"):this.el.classList.remove("chat--timestamps")}},{key:"roleHandler",value:function(e){if(this._currentRole&&this._currentRole!==e.room.role){var t={};switch(t.level="info",this._currentRole){case"user":t.message=this.localize("You have been modded");break;default:t.message=this.localize("You have been unmodded")}this.chatBody.processMessage(t)}this._currentRole=e.room.role;var n="chat";this.chatBody.isMod&&(n+=" chat--isMod"),this.chatBody.isAdmin&&(n+=" chat--isAdmin"),this.el.className=n}},{key:"openPopout",value:function(){var e=this;this.popout=new k.default(this.options.popout,{width:340,height:640}),this._unmountClose=this.popout.on("close",function(){setTimeout(function(){e.popout&&e.popout.instance&&e.popout.instance.closed&&e.closePopout()},250)}),this.destroy(),this.renderNoPopout()}},{key:"closePopout",value:function(){this.popout&&(this.popout.close(),this.popout=null),this._unmountClose&&(this._unmountClose=null),this.destroyNoPopout(),this.init()}},{key:"renderNoPopout",value:function(){var e=(0,w.default)({tagName:"div",className:"chat__poppedout-text",text:"Your chat is popped out"});this._popoutEl=(0,w.default)({tagName:"div",className:"chat__poppedout",childs:[e]}),this.el.appendChild(this._popoutEl)}},{key:"destroyNoPopout",value:function(){this.el.removeChild(this._popoutEl)}},{key:"destroy",value:function(){for(this.chat.destroy(),this.chatBody.destroy(),this.el.className="chat";this.el.firstChild;)this.el.removeChild(this.el.firstChild)}}]),t}();n.default=H,t.exports=n.default},{"./components/chat-admin":119,"./components/chat-body":120,"./components/chat-controls":121,"./components/chat-emoticons":122,"./components/chat-header":124,"./components/chat-input":125,"./components/chat-options":126,"./components/chat-popout":127,"./components/chat-roster":128,"./package-json":130,"./utils/popout":132,"@livelyvideo/chat-core/lib/source":11,"@livelyvideo/localization":17,"@livelyvideo/logger-core/lib/source":22,"@livelyvideo/utils/lib/createElement":23,"@livelyvideo/utils/lib/forwardEvents":25,"babel-runtime/core-js/object/assign":26,"babel-runtime/core-js/object/create":27,"babel-runtime/core-js/object/define-property":28,"babel-runtime/core-js/object/get-prototype-of":29,"babel-runtime/core-js/object/set-prototype-of":31,"babel-runtime/core-js/symbol":32,"babel-runtime/core-js/symbol/iterator":33,"classlist-polyfill":35,events:133}],130:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={version:"1.1.2",name:"@livelyvideo/chat"},t.exports=n.default},{}],131:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(e,t,n){for(var r=e.target;r&&r!==document.body;){if(r===t||r===n)return!1;r=r.parentNode}return!0},t.exports=n.default},{}],132:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=(0,l.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(c.default?(0,c.default)(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("babel-runtime/core-js/object/assign")),u=r(e("babel-runtime/core-js/object/define-property")),c=r(e("babel-runtime/core-js/object/set-prototype-of")),l=r(e("babel-runtime/core-js/object/create")),h=r(e("babel-runtime/core-js/object/get-prototype-of")),f=a.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,u.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=e("events"),_={width:640,height:550,toolbar:!1,menubar:!1,location:!1,status:!1,scrollbars:!1,resizable:!0,left:0,top:0},m=function(e){function t(e,n){o(this,t);var r=i(this,(t.__proto__||(0,h.default)(t)).call(this));if(!(r instanceof t)){var s;return s=new t(e,n),i(r,s)}r.options=f({},_,n);var a=r.getParamsString(n);return r.instance=window.open(e,Date.now(),a),setTimeout(function(){return r.onPopupLoad()}),setTimeout(function(){return r.onPopupLoad()},250),r}return s(t,p.EventEmitter),d(t,[{key:"onBeforeUnload",value:function(e){var t=this;this.emit("close",e),setTimeout(function(){t.instance.closed||(t.instance.onbeforeunload=t.onBeforeUnload.bind(t))},250)}},{key:"close",value:function(){this.instance.close()}},{key:"onPopupLoad",value:function(){try{this.instance.isPopup=!0,this.instance.onbeforeunload=this.onBeforeUnload.bind(this)}catch(e){}}},{key:"getParamsString",value:function(e){var t=[];for(var n in e)t.push(n+"="+e[n]);return t=t.join(",")}}]),t}();n.default=m,t.exports=n.default},{"babel-runtime/core-js/object/assign":26,"babel-runtime/core-js/object/create":27,"babel-runtime/core-js/object/define-property":28,"babel-runtime/core-js/object/get-prototype-of":29,"babel-runtime/core-js/object/set-prototype-of":31,events:133}],133:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function i(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,i,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],a(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(s(n))for(i=Array.prototype.slice.call(arguments,1),r=(c=n.slice()).length,u=0;u<r;u++)c[u].apply(this,i);return!0},r.prototype.addListener=function(e,t){var n;if(!o(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!o(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,i,a;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,r=-1,n===t||o(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=i;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],o(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(o(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}]},{},[129])(129)});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}]},{},[1]);
