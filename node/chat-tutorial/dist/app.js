(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _chat = require('@livelyvideo/chat');

var _chat2 = _interopRequireDefault(_chat);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
Set up the chat instance

Params:
	- html element
	- options
			user: users username, should be unique to the user
			room: room name
			apiHost: lively chat api
			websocketHost: lively ws api
			url: the company's auth url, which should access livelyvideo to create an access token for the user
**/
var chat = void 0;
var ROOM = 'blt';
//const ROOM = 'sea1a~1~931c1d57-785d-4629-adb2-f290b74b16eb_585_426x240_56';
function createChat(user, el) {
	if (chat) {
		chat.destroy();
	}
	chat = new _chat2.default(el, {
		user: user,
		room: ROOM,
		host: 'dev.livelyvideo.tv',
		authUrl: '/access-token?username=' + user
	});
}

document.querySelector('#pickuser').onsubmit = function (e) {
	e.preventDefault();
	createChat(e.target.querySelector('[name=username]').value, document.querySelector('.chat'));
	e.target.setAttribute('disabled', true);
	e.target.querySelector('[name=username]').value = '';
};

},{"@livelyvideo/chat":2}],2:[function(require,module,exports){
(function (global){
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).LivelyChat=t()}}(function(){return function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return o(n||t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=r(t("@livelyvideo/logger-core/lib/source")),c=r(t("events")),l=r(t("deepmerge")),h=r(t("./package-json")),f=new u.default(h.default),d={timeout:5e3,headers:{},bootstrap:{},loggerOptions:{}},p={Accept:"application/json"},_=function(t){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o(this,e);var s=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(s.options=(0,l.default)(d,r),f.setOptions(s.options.loggerOptions),f.attachEmitter(s),s.options.host&&f.setInstanceOptions({host:s.options.host}),!t)return setTimeout(function(){return s.emit("error","scope is required")}),i(s);if(!n)return setTimeout(function(){return s.emit("error","authorization server url is required")}),i(s);if(-1===n.indexOf("?")?s._url=n+"?scope="+t:s._url=n+"&scope="+t,s._stopped=!1,s._fatalError=null,s._token=s.options.bootstrap.token||null,s._retries=[0,200,1e3,3e3],s._retry=0,s._autorefresh=null,s._headers=Object.assign({},p,r.headers),null===s._token)s._retryRequest();else if(s.options.bootstrap&&s.options.bootstrap.expire){var a=s.options.bootstrap.expire-Date.now()-6e4;s._autorefresh=setTimeout(function(){s._autorefresh=null,s._stopped||s._retryRequest()},a)}return s}return s(e,c.default),a(e,[{key:"destroy",value:function(){this._stopped=!0}},{key:"request",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._fatalError)e(this._fatalError);else if(null===this._token){var n=!1,r=function(){n||(n=!0,e(null,t._token))},o=function(){n||(n=!0,e(new Error("authorization: timeout")))},i=setTimeout(function(){t.removeListener("ready",r),o()},this.options.timeout);this.once("ready",function(){clearTimeout(i),r()})}else e(null,this._token)}},{key:"refreshToken",value:function(){var t=this;null!==this._token&&(null!==this._autorefresh&&(clearTimeout(this._autorefresh),this._autorefresh=null),this._token=null,t._retryRequest())}},{key:"ensureToken",value:function(t){this._token?t():this.once("ready",function(){t()})}},{key:"_retryRequest",value:function(){var t=this,e=this._retries[this._retry];e?setTimeout(function(){t._makeRequest()},e):this._makeRequest()}},{key:"_makeRequest",value:function(){var t=this;fetch(this._url,{credentials:"same-origin",headers:this._headers}).then(function(t){if(t.status>=200&&t.status<300)return t.json();if(401===t.status){var e=new Error("authorization: unauthorized");throw e.fatal=!0,e}if(403===t.status){var n=new Error("authorization: forbidden");throw n.fatal=!0,n}throw new Error("authorization: non-200 response code from auth server")}).then(function(e){t._token=e.token,t._retry=0,t.emit("ready",{token:e.token});var n=new Date(e.expire).getTime()-Date.now()-6e4;t._autorefresh=setTimeout(function(){t._autorefresh=null,t._stopped||t._retryRequest()},n)}).catch(function(e){if(t._token=null,e.fatal)return t._fatalError=e,void t.emit("error",e.message||"",e);t.emit("log","network",e.message||"",e),t._retryRequest(),t._retry<t._retries.length-1&&t._retry++})}}]),e}();n.default=_,e.exports=n.default},{"./package-json":2,"@livelyvideo/logger-core/lib/source":22,deepmerge:62,events:84}],2:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={version:"1.3.0",name:"@livelyvideo/auth-core"},e.exports=n.default},{}],3:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./auth-core"));n.default=r.default,e.exports=n.default},{"./auth-core":1}],4:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var a=function(t){return t&&t.__esModule?t:{default:t}}(t("events")),u=function(t){function e(t,n,i){r(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t?n?(s._auth=t,s._url=n,s._nextParams="",s._options=i,s._retries=[0,300,1e3],s):(setTimeout(function(){return s.emit("error","url is required for a changerole request")}),o(s)):(setTimeout(function(){return s.emit("error","auth is required for a changerole request")}),o(s))}return i(e,a.default),s(e,[{key:"get",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},e=this._url+"?";this._options.limit&&(e=e+"limit="+this._options.limit+"&"),this._request(e,t)}},{key:"next",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._nextParams){var e=this._url+"?"+this._nextParams;this._request(e,t)}else t(null,[])}},{key:"_request",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=-1;!function o(){e._auth.request(function(i,s){i?n(i):fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s}}).then(function(t){if(200===t.status)return t.json();if(401===t.status){var e=new Error("chat: unauthorized");throw e.retry=!0,e}if(503===t.status){var n=new Error("chat: server unavailable");throw n.retry=!0,n}if(403===t.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(t){e._nextParams=t&&t._links&&t._links.next&&t._links.next.href?t._links.next.href.split("?")[1]:"",n(null,t.changeroles)}).catch(function(t){if(t.retry&&r<e._retries.length-1){r++;var i=e._retries[r];return i?void setTimeout(o,i):void o()}n(t)})})}()}}]),e}();n.default=u,e.exports=n.default},{events:84,"whatwg-fetch":65}],5:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=r(t("events")),l=r(t("@livelyvideo/logger-core/lib/source")),h=r(t("@livelyvideo/chat-parser-core/lib/source")),f=r(t("@livelyvideo/auth-core/lib/source")),d=r(t("./websocket")),p=r(t("./fallback")),_=r(t("./command")),m=r(t("./roster")),y=r(t("./changerole")),v=r(t("./http")),b=r(t("./utils/forwardEvents")),g=r(t("./package-json")),w=new l.default(g.default),k={room:null,host:null,roleHistory:!1,insecure:!1,loggerOptions:{}},E=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(w.setOptions(t.loggerOptions,r),!t)return setTimeout(function(){return r.emit("error","Chat options is required")}),i(r);if(!t.room)return setTimeout(function(){return r.emit("error","Chat room is required")}),i(r);if(!t.host)return setTimeout(function(){return r.emit("error","Chat server host required")}),i(r);t.wshost||(t.wshost="ws-"+t.host),r.options=a({},k,t),w.setInstanceOptions({host:r.options.host});var s="https",u="wss";t.insecure&&(s="http",u="ws");var c="";t.roleHistory&&(c="role-history=true");var l=s+"://"+t.host+"/chat/v1/rooms/"+t.room+"/command",m=s+"://"+t.host+"/chat/v1/manifests/say/rooms/"+t.room+"/version",y=u+"://"+t.wshost+"/chat/ws/v1/rooms/"+t.room+"?"+c,g="/chat/http/v1/rooms/"+t.room+"?"+c;if(r._rosterUrl=s+"://"+t.host+"/chat/v1/rooms/"+t.room+"/roster",r._changeroleUrl=s+"://"+t.host+"/chat/v1/rooms/"+t.room+"/changeroles",r._routeStart=s+"://"+t.host+"/chat/v1",n){if(!n.url)return setTimeout(function(){return r.emit("error","authorization options url is required")}),i(r);r._auth=new f.default("chat",n.url,n.options),(0,b.default)(r._auth,r,["error"]),r._http=new v.default(r._auth),(0,b.default)(r._http,r),r._command=new _.default(r._auth,l),(0,b.default)(r._command,r)}if(r._parser=new h.default(m),(0,b.default)(r._parser,r),window.WebSocket)r._socketInterface=new d.default(y,r._auth);else{var E=s+"://"+t.host+g;r._socketInterface=new p.default(E,r._auth)}return(0,b.default)(r._socketInterface,r,["error","ready"]),r._historyEmitted=!1,r._socketInterface.on("unauthorized",function(){if(r._historyEmitted)r.emit("me",null);else{var t=function(){r.emit("me",null)},e=window.setTimeout(function(){t(),t=null},3e3);r.once("history",function(){t&&t(),window.clearTimeout(e)})}}),r._socketInterface.on("disconnect",function(){r._historyEmitted=!1,r.emit("disconnect")}),r._socketInterface.on("message",function(t){r._parser.parseMessage(t,r._emitCommand.bind(r))}),r._sayDedupe=[],r._me=null,r._room=null,r}return s(e,c.default),u(e,[{key:"getDefaultAvatars",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._auth?this._http.execGet(this._routeStart+"/avatars",t):t(new Error("Http calls require authentication"))}},{key:"setDefaultUserAvatar",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execPatch(this._routeStart+"/users/"+t+"/avatar",{default:e},n):n(new Error("Http calls require authentication"))}},{key:"getUserEmoticons",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._auth?this._http.execGet(this._routeStart+"/users/"+t+"/emoticons",e):e(new Error("Http calls require authentication"))}},{key:"getAllEmoticons",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execGet(this._routeStart+"/rooms/"+t+"/users/"+e+"/emoticons/all",n):n(new Error("Http calls require authentication"))}},{key:"postUserEmoticon",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execPost(this._routeStart+"/users/"+t+"/emoticons",e,n):n(new Error("Http calls require authentication"))}},{key:"deleteUserEmoticon",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execDelete(this._routeStart+"/users/"+t+"/emoticons/"+e,n):n(new Error("Http calls require authentication"))}},{key:"getUserAvatar",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._auth?this._http.execGet(this._routeStart+"/users/"+t+"/avatar",e):e(new Error("Http calls require authentication"))}},{key:"putUserAvatar",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execPut(this._routeStart+"/users/"+t+"/avatar",e,n):n(new Error("Http calls require authentication"))}},{key:"getUser",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._auth?this._http.execGet(this._routeStart+"/users/"+t,e):e(new Error("Http calls require authentication"))}},{key:"patchUser",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execPatch(this._routeStart+"/users/"+t,e,n):n(new Error("Http calls require authentication"))}},{key:"getRoomUser",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execGet(this._routeStart+"/rooms/"+t+"/users/"+e,n):n(new Error("Http calls require authentication"))}},{key:"patchRoomUser",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};this._auth?this._http.execPatch(this._routeStart+"/rooms/"+t+"/users/"+e,n,r):r(new Error("Http calls require authentication"))}},{key:"getRoom",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._auth?this._http.execGet(this._routeStart+"/rooms/"+t,e):e(new Error("Http calls require authentication"))}},{key:"patchRoom",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._auth?this._http.execPatch(this._routeStart+"/rooms/"+t,e,n):n(new Error("Http calls require authentication"))}},{key:"getChangeroles",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._auth)return this.emit("error","Changeroles calls require authentication"),!1;var e=Object.assign({},{limit:100,role:""},t);return new y.default(this._auth,this._changeroleUrl,e)}},{key:"getRoster",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Object.assign({},{limit:100,role:""},t);return new m.default(this._rosterUrl,e)}},{key:"command",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._auth?this._command.run(t,function(t,r){if(t)n(t);else{for(var o=r.length-1;o>=0;o--)r[o].data&&r[o].data&&r[o].data.command&&(e._parser.parseMessage(r[o].data.command,e._emitCommand.bind(e)),r.splice(0,1));n(null,r)}}):n(new Error("Command calls require authentication"))}},{key:"destroy",value:function(){this._auth.destroy(),this._socketInterface.destroy()}},{key:"_emitCommand",value:function(t,e,n){if(t)this.emit("error",t);else switch(e){case"NOTIFICATION":this.emit("notification",n);break;case"CLOSE":this.emit("close",n),this._socketInterface.destroy();break;case"SAY":this._emitSay(n);break;case"ME":this._me=n,this.emit("me",n);break;case"ROOM":this._room=n,this.emit("room",n);break;case"MESSAGE":this.emit("message",n);break;case"HISTORY":this.emit("history",n),this._historyEmitted=!0;break;case"DELETE":this.emit("delete",n)}}},{key:"_emitSay",value:function(t){for(var e=this._sayDedupe.length-1;e>=0;e--)if(this._sayDedupe[e]===t.id)return;this._me&&this._me.ignore&&-1!==this._me.ignore.indexOf(t.actor.id)&&(t.ignore=!0),this._sayDedupe.length>50&&this._sayDedupe.splice(0,1),this._sayDedupe.push(t.id),this.emit("chat",t)}}]),e}();n.default=E,e.exports=n.default},{"./changerole":4,"./command":6,"./fallback":7,"./http":8,"./package-json":9,"./roster":10,"./utils/forwardEvents":12,"./websocket":14,"@livelyvideo/auth-core/lib/source":3,"@livelyvideo/chat-parser-core/lib/source":16,"@livelyvideo/logger-core/lib/source":22,events:84}],6:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var a=function(t){return t&&t.__esModule?t:{default:t}}(t("events")),u=function(t){function e(t,n){r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t?n?(i._auth=t,i._url=n,i._retries=[0,300,1e3],i):(setTimeout(function(){return i.emit("error","url is required for a command")}),o(i)):(setTimeout(function(){return i.emit("error","auth is required for a command")}),o(i))}return i(e,a.default),s(e,[{key:"run",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(t){var r=-1;!function o(){e._auth.request(function(i,s){i?n(i):fetch(e._url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s},body:JSON.stringify({command:t})}).then(function(t){if(t.status>=200&&t.status<300)return 204===t.status?null:t.json();if(401===t.status){e._auth.refreshToken();var n=new Error("chat: unauthorized");throw n.retry=!0,n}if(503===t.status){var r=new Error("chat: server unavailable");throw r.retry=!0,r}if(403===t.status)throw new Error("chat: forbidden");if(t.status>=400&&t.status<500)return t.json();throw new Error("chat: non-200 response code from chat server")}).then(function(t){t&&t.messages?n(null,t.messages):n()}).catch(function(t){if(t.retry&&r<e._retries.length-1){r++;var i=e._retries[r];return i?void setTimeout(o,i):void o()}n(t)})})}()}else n(new Error("command is required for a command"))}}]),e}();n.default=u,e.exports=n.default},{events:84,"whatwg-fetch":65}],7:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var a=t("events"),u=function(t){return t&&t.__esModule?t:{default:t}}(t("./uuid")),c=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._auth=n,t?(i._url=t,i._stopped=!0,i._connectionID=(0,u.default)(),i._isConnected=!1,i._retry=0,i._retries=[0,300,1e3],i._run(),i):(setTimeout(function(){return i.emit("error","url is required for a command")}),o(i))}return i(e,a.EventEmitter),s(e,[{key:"destroy",value:function(){this._stopped=!0}},{key:"_retryRun",value:function(t){var e=this;if(t)return this._retry=0,void this._run();this._retry<this._retries.length-1&&this._retry++,setTimeout(function(){e._run()},this._retries[this._retry])}},{key:"_run",value:function(){var t=this;this._auth?this._auth.request(function(e,n){e?t._disconnected(e):t._request(n)}):this._request()}},{key:"_request",value:function(t){var e=this,n={Accept:"application/json","Content-Type":"application/json"};t&&(n.Authorization="Bearer "+t);var r=void 0;r=this._url.indexOf("?")===this._url.length-1?this._url+"cid="+this._connectionID:this._url+"&cid="+this._connectionID,fetch(r,{method:"GET",headers:n}).then(function(t){if(200===t.status)return t.json();if(401===t.status){e._auth.refreshToken();var n=new Error("chat: unauthorized");throw n.retry=!0,n}if(503===t.status){var r=new Error("chat: server unavailable");throw r.retry=!0,r}if(404===t.status)throw new Error("Room does not exist");if(403===t.status)throw e.emit("unauthorized"),new Error("chat: forbidden");if(409===t.status){e._connectionID=(0,u.default)();var o=new Error("chat: connection id conflict");throw o.ignore=!0,o.retry=!0,o}throw new Error("non 200 response")}).then(function(t){e._connected();for(var n=0;n<t.length;n++)e.emit("message",t[n]);e._stopped||e._retryRun(!0)}).catch(function(t){e._disconnected(t),t.retry&&(e._stopped||e._retryRun())})}},{key:"_disconnected",value:function(t){t&&(t.ignore||this.emit("error",t)),this._isConnected&&(this.emit("disconnect"),this._isConnected=!1)}},{key:"_connected",value:function(){this._isConnected||(this.emit("ready"),this._isConnected=!0)}}]),e}();n.default=c,e.exports=n.default},{"./uuid":13,events:84,"whatwg-fetch":65}],8:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var a=function(t){return t&&t.__esModule?t:{default:t}}(t("events")),u=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t?(n._auth=t,n._retries=[0,300,1e3],n):(setTimeout(function(){return n.emit("error","auth is required for an http request")}),o(n))}return i(e,a.default),s(e,[{key:"execGet",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t?this._execute("GET",t,null,e):this.emit("error","url is required for an http request")}},{key:"execPut",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};t?this._execute("PUT",t,e,n):this.emit("error","url is required for an http request")}},{key:"execPost",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};t?this._execute("POST",t,e,n):this.emit("error","url is required for an http request")}},{key:"execPatch",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};t?this._execute("PATCH",t,e,n):this.emit("error","url is required for an http request")}},{key:"execDelete",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t?this._execute("DELETE",t,e):this.emit("error","url is required for an http request")}},{key:"_execute",value:function(t,e,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i={method:t,headers:{Accept:"application/json","Content-Type":"application/json"}};n&&(i.body=JSON.stringify(n));var s=-1;!function t(){r._auth.request(function(n,a){n?o(n):(i.headers.Authorization="Bearer "+a,fetch(e,i).then(function(t){if(t.status>=200&&t.status<300)return t.json();if(401===t.status){var e=new Error("chat: unauthorized");throw e.retry=!0,e}if(503===t.status){var n=new Error("chat: server unavailable");throw n.retry=!0,n}if(403===t.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(t){o(null,t)}).catch(function(e){if(e.retry&&s<r._retries.length-1){s++;var n=r._retries[s];return n?void setTimeout(t,n):void t()}o(e)}))})}()}}]),e}();n.default=u,e.exports=n.default},{events:84,"whatwg-fetch":65}],9:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={version:"1.2.0",name:"@livelyvideo/chat-core"},e.exports=n.default},{}],10:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("whatwg-fetch");var a=function(t){return t&&t.__esModule?t:{default:t}}(t("events")),u=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t?(i._url=t,i._nextParams="",i._options=n,i._retries=[0,300,1e3],i):(setTimeout(function(){return i.emit("url is required for a roster request")}),o(i))}return i(e,a.default),s(e,[{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},e=this._url+"?";this._options.limit&&(e=e+"limit="+this._options.limit+"&"),this._options.role&&(e=e+"role="+this._options.role+"&"),this._request(e,t)}},{key:"next",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._nextParams){var e=this._url+"?"+this._nextParams;this._request(e,t)}else t(null,[])}},{key:"_request",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=-1;!function o(){fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(t){if(200===t.status)return t.json();if(503===t.status){var e=new Error("chat: server unavailable");throw e.retry=!0,e}if(403===t.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(t){e._nextParams=t&&t._links&&t._links.next&&t._links.next.href?t._links.next.href.split("?")[1]:"",n(null,t.users)}).catch(function(t){if(t.retry&&r<e._retries.length-1){r++;var i=e._retries[r];return i?void setTimeout(o,i):void o()}n(t)})}()}}]),e}();n.default=u,e.exports=n.default},{events:84,"whatwg-fetch":65}],11:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./chat-core"));n.default=r.default,e.exports=n.default},{"./chat-core":5}],12:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(t("events"));n.default=function(t,e,n){if(!(t instanceof r.default))throw new Error("src must be an emitter");if(!(e instanceof r.default))throw new Error("dst must be an emitter");var o=t.emit;t.once("error",function(){}),t.emit=function(r){if(o.apply(t,arguments),!n||-1!==n.indexOf(r))return e.emit.apply(e,arguments)}.bind(t)},e.exports=n.default},{events:84}],13:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});for(var r=new Array(16),o=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r},i=function(t,e){var n=e||0,r=s;return r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+"-"+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]+r[t[n++]]},s=[],a={},u=0;u<256;u++)s[u]=(u+256).toString(16).substr(1),a[s[u]]=u;n.default=function(){var t=o();return t[6]=15&t[6]|64,t[8]=63&t[8]|128,i(t)},e.exports=n.default},{}],14:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(t){return t&&t.__esModule?t:{default:t}}(t("reconnectable-websocket")),u=t("events"),c={MSG:"msg",FIN:"fin"},l={MSG:"msg",ERR:"err",FIN:"fin",ACK:"ack"},h={DEFAULT:"/",AUTH:"/auth"},f=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t?(i._auth=n,i._socket=new a.default(t,"livelyWebsocket",{automaticOpen:!1,reconnectOnError:!0,reconnectOnCleanClose:!0,randomRatio:!1}),i._retries=[0,200,1e3,2e3],i._retry=0,i.ready=!1,i.authed=!1,i._socket.onopen=function(){i._auth&&i._authenticate()},i._socket.onclose=function(t){i.emit("disconnect"),i.ready=!1,i.authed=!1,1003===t.code&&(i._socket._options.reconnectOnCleanClose=!1,i._socket._options.reconnectOnError=!1,i._socket.close(),i.emit("error",new Error("Requested room does not exist")))},i._socket.onmessage=function(t){i._onmessage(t)},i._socket.open(),i):(setTimeout(function(){return i.emit("error","url is required for chat")}),o(i))}return i(e,u.EventEmitter),s(e,[{key:"destroy",value:function(){this._socket._options.reconnectOnCleanClose=!1,this._socket._options.reconnectOnError=!1,this._socket.close()}},{key:"_authenticate",value:function(){var t=this;this._auth.request(function(e,n){e?t.emit("error",e):(t._send(t._socket,c.MSG,h.AUTH,n),t.once("_authed",function(e){e&&t.emit("unauthorized")}))})}},{key:"_send",value:function(t,e,n,r){if(t&&t.readyState===t.OPEN){var o=e+" "+n+" "+r;this._socket.send(o)}}},{key:"_onmessage",value:function(t){var e=t.data;if(e){var n=e.indexOf(" "),r=e.indexOf(" ",n+1),o=e.slice(0,n),i=e.slice(n+1,r),s=e.slice(r+1);if(o!==l.MSG)this.ready||o!==l.ACK||i!==h.DEFAULT||(this.emit("ready"),this.ready=!0,this._auth||this.emit("unauthorized")),this.authed||o!==l.FIN?o===l.ERR&&this.emit("error",new Error(s)):i===h.AUTH&&(this.emit("_authed"),this.authed=!0);else{var a=void 0;try{a=JSON.parse(s)}catch(t){return void this.emit("error",t)}this.emit("message",a)}}}}]),e}();n.default=f,e.exports=n.default},{events:84,"reconnectable-websocket":63}],15:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=r(t("events")),c=r(t("./template-parser")),l={INDEX:"index",TYPE:"type",NESTED_ITEMS:"nestedItems"},h={KEY:"key",VARS:"vars"},f={NESTED_DATA_ARRAY:"nestedDataArray",NESTED_ARRAY:"nestedArray",NESTED_OBJECT:"nestedObject",TEMPLATE:"template",INT_ARRAY:"intArray",STRING_ARRAY:"stringArray",STRING:"string",INT:"int",BOOL:"bool"},d={emoticons:"emoticon",links:"link",mentions:"mention",tags:"tag"},p=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t?(n._baseUrl=t,n._manifests={},n._buffer={},n._fetchingManifests={},n):(setTimeout(function(){return n.emit("error","url is required for parser")}),i(n))}return s(e,u.default),a(e,[{key:"parseMessage",value:function(t,e){var n=this;t&&t instanceof Array&&!(t.length<2)||e(new Error("Invalid data format"));var r=t[0],o=t[1];this._parseMessage(r,o,function(t,o){t?e(t):("HISTORY"===r&&o.messages.length&&o.messages.forEach(function(t,e){n._parseMessage("SAY",t,function(t,n){t||(o.messages[e]=n)})}),e(null,r,o))})}},{key:"_addManifest",value:function(t){this._manifests[t.version]=t}},{key:"_parseMessage",value:function(t,e,n){var r=this,o=e[0],i=void 0;if(this._manifests[o])return this._manifests[o].manifests[t]?(i=this._parse(o,this._manifests[o].manifests[t],e),void n(null,i)):void n(new Error("manifest does not have "+t+" command"));if(this._buffer[o]?this._buffer[o].push([e,t,n]):this._buffer[o]=[[e,t,n]],!0!==this._fetchingManifests[o]){this._fetchingManifests[o]=!0;("undefined"==typeof window?nodefetch(this._baseUrl+"/"+o):fetch(this._baseUrl+"/"+o)).then(function(t){if(200!==t.status)throw new Error("chat: non-200 response code from chat server");return t.json()}).then(function(t){for(r._addManifest(t);r._buffer[t.version].length>0;){var e=r._buffer[t.version].shift();i=r._parse(t.version,t.manifests[e[1]],e[0]),e[2](null,i)}}).catch(function(t){r._buffer[o]=[],n(t)})}}},{key:"_parse",value:function(t,e,n){for(var r=this,o={},i=Object.keys(e),s=0;s<i.length;s++){(function(s){var a=i[s],u=e[a],c=n[u[l.INDEX]];if(null===c)return o[a]=null,"continue";var p=void 0;switch(u[l.TYPE]){case f.NESTED_ARRAY:p=[];for(var _=0;_<c.length;_++)p.push(r._parse(t,u[l.NESTED_ITEMS],c[_]));break;case f.NESTED_OBJECT:p=r._parse(t,u[l.NESTED_ITEMS],c);break;case f.TEMPLATE:p=r._parseTemplate(t,c[u[l.NESTED_ITEMS][h.KEY].index],c[u[l.NESTED_ITEMS][h.VARS].index]);break;default:p=c}p&&p instanceof Array&&p.forEach(function(t){var e=t;e.positions&&e.positions instanceof Array&&e.positions.forEach(function(t){d[a]&&(e.type=d[a],o.positions||(o.positions={}),o.positions[t]=e)})}),o[a]=p})(s)}return o}},{key:"_parseTemplate",value:function(t,e,n){return new c.default(this._manifests[t].templates[e],n).getParsed()}}]),e}();n.default=p,e.exports=n.default},{"./template-parser":17,events:84}],16:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./chat-parser-core"));n.default=r.default,e.exports=n.default},{"./chat-parser-core":15}],17:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e,n){r(this,t),this._parsed="",n&&0!==n.length?e&&0!==e.length&&(this._parsed="",this._varPos=0,this._curr="",this._template=e,this._templateLength=e.length,this._vars=n,this._next=this._startState.bind(this),this._pos=0,this._skipNext=!1):this._parsed=e}return o(t,[{key:"getParsed",value:function(){if(this._parsed)return this._parsed;for(var t=0;t<this._templateLength;t++)this._skipNext?this._skipNext=!1:(this._pos=t,this._curr=this._template[t],this._next=this._next().bind(this));return this._parsed}},{key:"_startDelim",value:function(){return!(this._pos>=this._templateLength-1)&&("{"===this._curr&&"{"===this._template[this._pos+1]&&(this._skipNext=!0,!0))}},{key:"_endDelim",value:function(){return!(this._pos>=this._templateLength-1)&&("}"===this._curr&&"}"===this._template[this._pos+1]&&(this._skipNext=!0,!0))}},{key:"_startState",value:function(){return this._startDelim()?this._midState:(this._parsed+=this._curr,this._startState)}},{key:"_midState",value:function(){return"n"===this._curr?this._endState:(this._parsed=this._parsed+"{{"+this._curr,this._startState)}},{key:"_endState",value:function(){return this._endDelim()?(this._parsed+=this._vars[this._varPos],this._varPos++):this._parsed+=this._curr,this._startState}}]),t}();n.default=i,e.exports=n.default},{}],18:[function(t,e,n){(function(r){!function(t){if("object"==typeof n&&void 0!==e)e.exports=t();else{("undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:this).LivelyLocales=t()}}(function(){return function e(n,r,o){function i(a,u){if(!r[a]){if(!n[a]){var c="function"==typeof t&&t;if(!u&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[a]={exports:{}};n[a][0].call(h.exports,function(t){var e=n[a][1][t];return i(e||t)},h,h.exports,e,n,r,o)}return r[a].exports}for(var s="function"==typeof t&&t,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s={},a={},u=function(){function t(e,n,o){r(this,t),e&&s[e]||n?(this.warned={},this.silent=o,this.name=e,this.data=s[e]||{},n&&Object.assign(this.data,n)):this.localize=function(t){return t}}return i(t,[{key:"localize",value:function(t){var e=void 0;return(e=this.data[t])?e:(this.silent||this.warned[t]||(this.warned[t]=!0,this.name?console.warn("'"+t+"' has no translation in the provided '"+this.name+"' locale files or localization messages"):console.warn("'"+t+"' has no translation in the provided localization messages.")),t)}}]),t}();[].map(function(t){var e=t.name.split("/")[2];s[e]=Object.assign({},s[e],t.module)});var c=new u;Object.keys(s).forEach(function(t){a[t]=new u(t)}),n.default=function(t,e,n){if(e){if("object"!==(void 0===e?"undefined":o(e)))throw new Error("Lively Localization instantiated with something other than a messages object",{messages:e});return new u(t,e,n)}return t&&a[t]?a[t]:c},e.exports=n.default},{}]},{},[1])(1)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=r(t("serialize-error")),u=r(t("./package-json")),c={host:null,interval:3e4,limit:500,maxRequestSize:1048576},l=null,h=function(){function t(){return o(this,t),l||(l=this,this.options=c,this.storage=[],l)}return s(t,[{key:"setOptions",value:function(t){this.options=i({},c,t),this.options.host&&this._uri||(this._uri="https://"+this.options.host+"/client-logs")}},{key:"add",value:function(t){this.storage.push(t),this.checkStorageLimit()}},{key:"send",value:function(){var t=this;if(this.storage.length&&this._uri){var e=this.storage;this.storage=[];var n={messages:e},r=void 0;try{r=JSON.stringify(n)}catch(t){return void this.storage.push({level:"error",package:{name:u.default.name,version:u.default.name},source:"client",message:"Error stringifying batch. Dropped "+e.length+" logs.",error:(0,a.default)(t)})}this._byteLength(r)>this.options.maxRequestSize?this.storage.push({level:"error",package:{name:u.default.name,version:u.default.name},source:"client",message:"Body exceeds maxRequestSize. Dropped "+e.length+" logs."}):fetch(this._uri,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:r}).then(this._handleFetchError).catch(function(n){t.storage.push({level:"network",package:{name:u.default.name,version:u.default.name},source:"client",message:"Network failure. Dropped "+e.length+" logs.",error:(0,a.default)(n)})})}}},{key:"enable",value:function(){var t=this;this._uri&&(this._watchInterval=setInterval(function(){return t.send()},this.options.interval),"undefined"!=typeof window&&(this._watchUnload=this._eventHelper(window,"unload",function(){return t.send()})))}},{key:"disable",value:function(){this._watchInterval&&clearInterval(this._watchInterval),this._watchUnload&&this._watchUnload()}},{key:"checkStorageLimit",value:function(){this.options.limit&&this.storage.length>this.options.limit&&this.send()}},{key:"_handleFetchError",value:function(t){if(!t.ok)throw new TypeError(t.status,t.statusText);return t}},{key:"_byteLength",value:function(t){for(var e=t.length,n=t.length-1;n>=0;n--){var r=t.charCodeAt(n);r>127&&r<=2047?e++:r>2047&&r<=65535&&(e+=2),r>=56320&&r<=57343&&n--}return e}},{key:"_eventHelper",value:function(t,e,n){t.addEventListener(e,n);return function(){t.removeEventListener(e,n)}}}]),t}();n.default=h,e.exports=n.default},{"./package-json":21,"serialize-error":64}],20:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=r(t("events")),c=r(t("serialize-error")),l=r(t("./instance")),h=r(t("./package-json")),f={level:"warn",silent:!0,disable:!1,events:!0,name:h.default.name,version:h.default.version},d={error:0,warn:1,deprecated:1,info:2,debug:3,timing:3,network:3},p=function(){function t(e){i(this,t),this.options=s({},f,e),this.instance=new l.default,this.enable()}return a(t,[{key:"setOptions",value:function(t,e,n){this.options=s({},this.options,t),e&&this.options.events&&this.attachEmitter(e,n)}},{key:"setInstanceOptions",value:function(t){this.instance.options.host&&t.host&&this.instance.options.host!==t.host?this.warn("Unable to set instance options. Host set to "+this.instance.options.host+" and cannot be set "+t.host+"."):(this.instance.setOptions(t),this.options.disable||this.enableInstance())}},{key:"enableInstance",value:function(){this.instance.enable()}},{key:"disableInstance",value:function(){this.instance.disable()}},{key:"instanceSend",value:function(){this.instance.send()}},{key:"setLevel",value:function(t){d[t]?this.options.level=t:this.warn(t+" level is unsupported.")}},{key:"log",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];if(this._isWritable(t)){var o;(o=this.writer)[t].apply(o,n)}var i=this._validateLog(t,n);i&&this.instance.add(i)}},{key:"debug",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log.apply(this,["debug"].concat(e))}},{key:"error",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log.apply(this,["error"].concat(e))}},{key:"info",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log.apply(this,["info"].concat(e))}},{key:"warn",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log.apply(this,["warn"].concat(e))}},{key:"deprecated",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log.apply(this,["deprecated"].concat(e))}},{key:"timing",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log.apply(this,["timing"].concat(e))}},{key:"network",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];this.log.apply(this,["network"].concat(e))}},{key:"enable",value:function(){"undefined"!=typeof window?this.writer=window.console:console&&(this.writer=console),this.writer&&(this.writer.timing=this.writer.info,this.writer.deprecated=this.writer.warn,this.writer.network=this.writer.warn)}},{key:"disable",value:function(){this.writer={}}},{key:"attachEmitter",value:function(t,e){if(t instanceof u.default)for(var n=e||["error","log"],r=0;r<n.length;r++)t.on(n[r],function(){this[arguments[0]]||this.error.apply(this,o(Array.prototype.slice.call(arguments,1))),this[arguments[0]].apply(this,o(Array.prototype.slice.call(arguments,1)))}.bind(this,n[r]));else this.error("attachEmitter not supplied with instanceof EventEmitter")}},{key:"detachEmitter",value:function(t,e){if(t instanceof u.default)for(var n=e||["error","log"],r=0;r<n.length;r++)t.removeListener(n[r],function(){this[arguments[0]]||this.error.apply(this,o(Array.prototype.slice.call(arguments,1))),this[arguments[0]].apply(this,o(Array.prototype.slice.call(arguments,1)))}.bind(this,n[r]));else this.error("detachEmitter not supplied with instanceof EventEmitter")}},{key:"_isWritable",value:function(t){return!this.options.silent&&this.writer[t]&&this.writer[t].apply&&d[t]<=d[this.options.level]}},{key:"_validateLog",value:function(t,e){var n={package:{name:this.options.name,version:this.options.version},timestamp:(new Date).toISOString(),source:"client",userAgent:"undefined"!=typeof navigator?navigator.userAgent:"node",referrer:"undefined"!=typeof document?document.referrer:"node",level:t},r=e[e.length-1];switch(Object.prototype.toString.call(r)){case"[object Object]":n=s({},n,e.pop());break;case"[object Error]":n.error=(0,c.default)(e.pop());break;case"[object Array]":n.array=e.pop()}n.message=e.join(" ");try{JSON.stringify(n)}catch(t){return this.error("Dropped log due to invalid data structure",t),null}return n}}]),t}();n.default=p,e.exports=n.default},{"./instance":19,"./package-json":21,events:84,"serialize-error":64}],21:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={version:"1.1.0",name:"@livelyvideo/logger-core"},e.exports=n.default},{}],22:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(t("./logger-core"));n.default=r.default,e.exports=n.default},{"./logger-core":20}],23:[function(t,e,n){e.exports={default:t("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":26}],24:[function(t,e,n){"use strict";n.__esModule=!0,n.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},{}],25:[function(t,e,n){"document"in window.self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))||function(t){"use strict";if("Element"in t){var e=t.Element.prototype,n=Object,r=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},o=Array.prototype.indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},i=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},s=function(t,e){if(""===e)throw new i("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(e))throw new i("INVALID_CHARACTER_ERR","String contains an invalid character");return o.call(t,e)},a=function(t){for(var e=r.call(t.getAttribute("class")||""),n=e?e.split(/\s+/):[],o=0,i=n.length;o<i;o++)this.push(n[o]);this._updateClassName=function(){t.setAttribute("class",this.toString())}},u=a.prototype=[],c=function(){return new a(this)};if(i.prototype=Error.prototype,u.item=function(t){return this[t]||null},u.contains=function(t){return t+="",-1!==s(this,t)},u.add=function(){var t,e=arguments,n=0,r=e.length,o=!1;do{t=e[n]+"",-1===s(this,t)&&(this.push(t),o=!0)}while(++n<r);o&&this._updateClassName()},u.remove=function(){var t,e,n=arguments,r=0,o=n.length,i=!1;do{for(t=n[r]+"",e=s(this,t);-1!==e;)this.splice(e,1),i=!0,e=s(this,t)}while(++r<o);i&&this._updateClassName()},u.toggle=function(t,e){t+="";var n=this.contains(t),r=n?!0!==e&&"remove":!1!==e&&"add";return r&&this[r](t),!0===e||!1===e?e:!n},u.toString=function(){return this.join(" ")},n.defineProperty){var l={get:c,enumerable:!0,configurable:!0};try{n.defineProperty(e,"classList",l)}catch(t){void 0!==t.number&&-2146823252!==t.number||(l.enumerable=!1,n.defineProperty(e,"classList",l))}}else n.prototype.__defineGetter__&&e.__defineGetter__("classList",c)}}(window.self),function(){"use strict";var t=document.createElement("_");if(t.classList.add("c1","c2"),!t.classList.contains("c2")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var n,r=arguments.length;for(n=0;n<r;n++)t=arguments[n],e.call(this,t)}};e("add"),e("remove")}if(t.classList.toggle("c3",!1),t.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}t=null}())},{}],26:[function(t,e,n){t("../../modules/es6.object.assign"),e.exports=t("../../modules/_core").Object.assign},{"../../modules/_core":31,"../../modules/es6.object.assign":61}],27:[function(t,e,n){e.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},{}],28:[function(t,e,n){var r=t("./_is-object");e.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},{"./_is-object":44}],29:[function(t,e,n){var r=t("./_to-iobject"),o=t("./_to-length"),i=t("./_to-absolute-index");e.exports=function(t){return function(e,n,s){var a,u=r(e),c=o(u.length),l=i(s,c);if(t&&n!=n){for(;c>l;)if((a=u[l++])!=a)return!0}else for(;c>l;l++)if((t||l in u)&&u[l]===n)return t||l||0;return!t&&-1}}},{"./_to-absolute-index":54,"./_to-iobject":56,"./_to-length":57}],30:[function(t,e,n){var r={}.toString;e.exports=function(t){return r.call(t).slice(8,-1)}},{}],31:[function(t,e,n){var r=e.exports={version:"2.5.1"};"number"==typeof __e&&(__e=r)},{}],32:[function(t,e,n){var r=t("./_a-function");e.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}}},{"./_a-function":27}],33:[function(t,e,n){e.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},{}],34:[function(t,e,n){e.exports=!t("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":38}],35:[function(t,e,n){var r=t("./_is-object"),o=t("./_global").document,i=r(o)&&r(o.createElement);e.exports=function(t){return i?o.createElement(t):{}}},{"./_global":39,"./_is-object":44}],36:[function(t,e,n){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],37:[function(t,e,n){var r=t("./_global"),o=t("./_core"),i=t("./_ctx"),s=t("./_hide"),a=function(t,e,n){var u,c,l,h=t&a.F,f=t&a.G,d=t&a.S,p=t&a.P,_=t&a.B,m=t&a.W,y=f?o:o[e]||(o[e]={}),v=y.prototype,b=f?r:d?r[e]:(r[e]||{}).prototype;f&&(n=e);for(u in n)(c=!h&&b&&void 0!==b[u])&&u in y||(l=c?b[u]:n[u],y[u]=f&&"function"!=typeof b[u]?n[u]:_&&c?i(l,r):m&&b[u]==l?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(l):p&&"function"==typeof l?i(Function.call,l):l,p&&((y.virtual||(y.virtual={}))[u]=l,t&a.R&&v&&!v[u]&&s(v,u,l)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,e.exports=a},{"./_core":31,"./_ctx":32,"./_global":39,"./_hide":41}],38:[function(t,e,n){e.exports=function(t){try{return!!t()}catch(t){return!0}}},{}],39:[function(t,e,n){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],40:[function(t,e,n){var r={}.hasOwnProperty;e.exports=function(t,e){return r.call(t,e)}},{}],41:[function(t,e,n){var r=t("./_object-dp"),o=t("./_property-desc");e.exports=t("./_descriptors")?function(t,e,n){return r.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},{"./_descriptors":34,"./_object-dp":46,"./_property-desc":51}],42:[function(t,e,n){e.exports=!t("./_descriptors")&&!t("./_fails")(function(){return 7!=Object.defineProperty(t("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":34,"./_dom-create":35,"./_fails":38}],43:[function(t,e,n){var r=t("./_cof");e.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},{"./_cof":30}],44:[function(t,e,n){e.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},{}],45:[function(t,e,n){"use strict";var r=t("./_object-keys"),o=t("./_object-gops"),i=t("./_object-pie"),s=t("./_to-object"),a=t("./_iobject"),u=Object.assign;e.exports=!u||t("./_fails")(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=u({},t)[n]||Object.keys(u({},e)).join("")!=r})?function(t,e){for(var n=s(t),u=arguments.length,c=1,l=o.f,h=i.f;u>c;)for(var f,d=a(arguments[c++]),p=l?r(d).concat(l(d)):r(d),_=p.length,m=0;_>m;)h.call(d,f=p[m++])&&(n[f]=d[f]);return n}:u},{"./_fails":38,"./_iobject":43,"./_object-gops":47,"./_object-keys":49,"./_object-pie":50,"./_to-object":58}],46:[function(t,e,n){var r=t("./_an-object"),o=t("./_ie8-dom-define"),i=t("./_to-primitive"),s=Object.defineProperty;n.f=t("./_descriptors")?Object.defineProperty:function(t,e,n){if(r(t),e=i(e,!0),r(n),o)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},{"./_an-object":28,"./_descriptors":34,"./_ie8-dom-define":42,"./_to-primitive":59}],47:[function(t,e,n){n.f=Object.getOwnPropertySymbols},{}],48:[function(t,e,n){var r=t("./_has"),o=t("./_to-iobject"),i=t("./_array-includes")(!1),s=t("./_shared-key")("IE_PROTO");e.exports=function(t,e){var n,a=o(t),u=0,c=[];for(n in a)n!=s&&r(a,n)&&c.push(n);for(;e.length>u;)r(a,n=e[u++])&&(~i(c,n)||c.push(n));return c}},{"./_array-includes":29,"./_has":40,"./_shared-key":52,"./_to-iobject":56}],49:[function(t,e,n){var r=t("./_object-keys-internal"),o=t("./_enum-bug-keys");e.exports=Object.keys||function(t){return r(t,o)}},{"./_enum-bug-keys":36,"./_object-keys-internal":48}],50:[function(t,e,n){n.f={}.propertyIsEnumerable},{}],51:[function(t,e,n){e.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},{}],52:[function(t,e,n){var r=t("./_shared")("keys"),o=t("./_uid");e.exports=function(t){return r[t]||(r[t]=o(t))}},{"./_shared":53,"./_uid":60}],53:[function(t,e,n){var r=t("./_global"),o=r["__core-js_shared__"]||(r["__core-js_shared__"]={});e.exports=function(t){return o[t]||(o[t]={})}},{"./_global":39}],54:[function(t,e,n){var r=t("./_to-integer"),o=Math.max,i=Math.min;e.exports=function(t,e){return(t=r(t))<0?o(t+e,0):i(t,e)}},{"./_to-integer":55}],55:[function(t,e,n){var r=Math.ceil,o=Math.floor;e.exports=function(t){return isNaN(t=+t)?0:(t>0?o:r)(t)}},{}],56:[function(t,e,n){var r=t("./_iobject"),o=t("./_defined");e.exports=function(t){return r(o(t))}},{"./_defined":33,"./_iobject":43}],57:[function(t,e,n){var r=t("./_to-integer"),o=Math.min;e.exports=function(t){return t>0?o(r(t),9007199254740991):0}},{"./_to-integer":55}],58:[function(t,e,n){var r=t("./_defined");e.exports=function(t){return Object(r(t))}},{"./_defined":33}],59:[function(t,e,n){var r=t("./_is-object");e.exports=function(t,e){if(!r(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!r(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":44}],60:[function(t,e,n){var r=0,o=Math.random();e.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+o).toString(36))}},{}],61:[function(t,e,n){var r=t("./_export");r(r.S+r.F,"Object",{assign:t("./_object-assign")})},{"./_export":37,"./_object-assign":45}],62:[function(t,e,n){"use strict";function r(t){return!!t&&"object"==typeof t}function o(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||i(t)}function i(t){return t.$$typeof===f}function s(t){return Array.isArray(t)?[]:{}}function a(t,e){return e&&!0===e.clone&&h(t)?l(s(t),t,e):t}function u(t,e,n){var r=t.slice();return e.forEach(function(e,o){void 0===r[o]?r[o]=a(e,n):h(e)?r[o]=l(t[o],e,n):-1===t.indexOf(e)&&r.push(a(e,n))}),r}function c(t,e,n){var r={};return h(t)&&Object.keys(t).forEach(function(e){r[e]=a(t[e],n)}),Object.keys(e).forEach(function(o){h(e[o])&&t[o]?r[o]=l(t[o],e[o],n):r[o]=a(e[o],n)}),r}function l(t,e,n){var r=Array.isArray(e),o=Array.isArray(t),i=n||{arrayMerge:u};return r===o?r?(i.arrayMerge||u)(t,e,n):c(t,e,n):a(e,n)}var h=function(t){return r(t)&&!o(t)},f="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;l.all=function(t,e){if(!Array.isArray(t)||t.length<2)throw new Error("first argument should be an array with at least two elements");return t.reduce(function(t,n){return l(t,n,e)})};var d=l;e.exports=d},{}],63:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){return Math.random()*(e-t)+t}Object.defineProperty(n,"__esModule",{value:!0});var i=r(t("babel-runtime/core-js/object/assign")),s=r(t("babel-runtime/helpers/classCallCheck")),a={debug:!1,automaticOpen:!0,reconnectOnError:!1,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,randomRatio:3,binaryType:"blob",reconnectOnCleanClose:!1};n.default=function t(e){var n=this,r=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],u=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];(0,s.default)(this,t),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.open=function(){var t=n._socket=new WebSocket(n._url,n._protocols);t.binaryType=n._options.binaryType,n._options.maxReconnectAttempts&&n._options.maxReconnectAttempts<n._reconnectAttempts||(n._syncState(),t.onmessage=n._onmessage.bind(n),t.onopen=n._onopen.bind(n),t.onclose=n._onclose.bind(n),t.onerror=n._onerror.bind(n))},this.send=function(t){n._socket&&n._socket.readyState===WebSocket.OPEN&&0===n._messageQueue.length?n._socket.send(t):n._messageQueue.push(t)},this.close=function(t,e){void 0===t&&(t=1e3),n._socket&&n._socket.close(t,e)},this._onmessage=function(t){n.onmessage&&n.onmessage(t)},this._onopen=function(t){n._syncState(),n._flushQueue(),n._reconnectAttempts=0,n.onopen&&n.onopen(t)},this._onclose=function(t){n._syncState(),n._debug("WebSocket: connection is broken",t),n.onclose&&n.onclose(t),n._tryReconnect(t)},this._onerror=function(t){n._socket.close(),n._debug("WebSocket: error",t),n.onerror&&n.onerror(t),n._options.reconnectOnError&&n._tryReconnect(t)},this._tryReconnect=function(t){t.wasClean&&!n._options.reconnectOnCleanClose||setTimeout(function(){n.readyState!==n.CLOSING&&n.readyState!==n.CLOSED||(n._reconnectAttempts++,n.open())},n._getTimeout())},this._flushQueue=function(){for(;0!==n._messageQueue.length;){var t=n._messageQueue.shift();n._socket.send(t)}},this._getTimeout=function(){var t=n._options.reconnectInterval*Math.pow(n._options.reconnectDecay,n._reconnectAttempts);return t=t>n._options.maxReconnectInterval?n._options.maxReconnectInterval:t,n._options.randomRatio?o(t/n._options.randomRatio,t):t},this._syncState=function(){n.readyState=n._socket.readyState},this._url=e,this._protocols=r,this._options=(0,i.default)({},a,u),this._messageQueue=[],this._reconnectAttempts=0,this.readyState=this.CONNECTING,"function"==typeof this._options.debug?this._debug=this._options.debug:this._options.debug?this._debug=console.log.bind(console):this._debug=function(){},u.automaticOpen&&this.open()},e.exports=n.default},{"babel-runtime/core-js/object/assign":23,"babel-runtime/helpers/classCallCheck":24}],64:[function(t,e,n){"use strict";function r(t,e){var n;return n=Array.isArray(t)?[]:{},e.push(t),Object.keys(t).forEach(function(o){var i=t[o];"function"!=typeof i&&(i&&"object"==typeof i?-1!==e.indexOf(t[o])?n[o]="[Circular]":n[o]=r(t[o],e.slice(0)):n[o]=i)}),"string"==typeof t.name&&(n.name=t.name),"string"==typeof t.message&&(n.message=t.message),"string"==typeof t.stack&&(n.stack=t.stack),n}e.exports=function(t){return"object"==typeof t?r(t,[]):"function"==typeof t?"[Function: "+(t.name||"anonymous")+"]":t}},{}],65:[function(t,e,n){!function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function n(t){return"string"!=typeof t&&(t=String(t)),t}function r(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return y.iterable&&(e[Symbol.iterator]=function(){return e}),e}function o(t){this.map={},t instanceof o?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function i(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function s(t){return new Promise(function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}})}function a(t){var e=new FileReader,n=s(e);return e.readAsArrayBuffer(t),n}function u(t){var e=new FileReader,n=s(e);return e.readAsText(t),n}function c(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}function l(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function h(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(y.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(y.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(y.arrayBuffer&&y.blob&&b(t))this._bodyArrayBuffer=l(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!g(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=l(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob&&(this.blob=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?i(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var t=i(this);if(t)return t;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function f(t){var e=t.toUpperCase();return w.indexOf(e)>-1?e:t}function d(t,e){var n=(e=e||{}).body;if("string"==typeof t)this.url=t;else{if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new o(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new o(e.headers)),this.method=f(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var n=t.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(r),decodeURIComponent(o))}}),e}function _(t){var e=new o;return t.split("\r\n").forEach(function(t){var n=t.split(":"),r=n.shift().trim();if(r){var o=n.join(":").trim();e.append(r,o)}}),e}function m(t,e){e||(e={}),this.type="default",this.status="status"in e?e.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new o(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var y={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(y.arrayBuffer)var v=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],b=function(t){return t&&DataView.prototype.isPrototypeOf(t)},g=ArrayBuffer.isView||function(t){return t&&v.indexOf(Object.prototype.toString.call(t))>-1};o.prototype.append=function(t,r){t=e(t),r=n(r);var o=this.map[t];o||(o=[],this.map[t]=o),o.push(r)},o.prototype.delete=function(t){delete this.map[e(t)]},o.prototype.get=function(t){var n=this.map[e(t)];return n?n[0]:null},o.prototype.getAll=function(t){return this.map[e(t)]||[]},o.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},o.prototype.set=function(t,r){this.map[e(t)]=[n(r)]},o.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){t.call(e,r,n,this)},this)},this)},o.prototype.keys=function(){var t=[];return this.forEach(function(e,n){t.push(n)}),r(t)},o.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),r(t)},o.prototype.entries=function(){var t=[];return this.forEach(function(e,n){t.push([n,e])}),r(t)},y.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];d.prototype.clone=function(){return new d(this,{body:this._bodyInit})},h.call(d.prototype),h.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},m.error=function(){var t=new m(null,{status:0,statusText:""});return t.type="error",t};var k=[301,302,303,307,308];m.redirect=function(t,e){if(-1===k.indexOf(e))throw new RangeError("Invalid status code");return new m(null,{status:e,headers:{location:t}})},t.Headers=o,t.Request=d,t.Response=m,t.fetch=function(t,e){return new Promise(function(n,r){var o=new d(t,e),i=new XMLHttpRequest;i.onload=function(){var t={status:i.status,statusText:i.statusText,headers:_(i.getAllResponseHeaders()||"")};t.url="responseURL"in i?i.responseURL:t.headers.get("X-Request-URL");var e="response"in i?i.response:i.responseText;n(new m(e,t))},i.onerror=function(){r(new TypeError("Network request failed"))},i.ontimeout=function(){r(new TypeError("Network request failed"))},i.open(o.method,o.url,!0),"include"===o.credentials&&(i.withCredentials=!0),"responseType"in i&&y.blob&&(i.responseType="blob"),o.headers.forEach(function(t,e){i.setRequestHeader(e,t)}),i.send(void 0===o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},{}],66:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=r(t("../utils/isBlurred")),a=r(t("../utils/createElement")),u=r(t("../utils/addEvent")),c=function(){function t(e,n,r,i){o(this,t),this.parent=e,this.chatBody=n,this.localize=r,this.options=i,this.closeFlyoutOnBlur=this.closeFlyoutOnBlur.bind(this),this.actionMuteHandler=this.actionMuteHandler.bind(this),this.actionIgnoreHandler=this.actionIgnoreHandler.bind(this),this.actionBanHandler=this.actionBanHandler.bind(this),this.actionModHandler=this.actionModHandler.bind(this),this.render(),this._blurEvent=(0,u.default)(document,"click",this.closeFlyoutOnBlur),this._blurEventTouch=(0,u.default)(document,"touchend",this.closeFlyoutOnBlur)}return i(t,[{key:"render",value:function(){var t=this.parent.getBoundingClientRect().y<215?"chat__actions-flyout--bounds":"";this.flyout=(0,a.default)({tagName:"div",className:"chat__actions-flyout "+t+" "+(this.options.modifierClass||"")}),this.parent.parentElement.appendChild(this.flyout);var e=(0,a.default)({tagName:"div",className:"chat__actions-flyout-username",text:this.options.username});if(this.flyout.appendChild(e),this.options.url){var n=(0,a.default)({tagName:"a",className:"chat__actions-flyout-button",text:this.localize("View"),attributes:{href:this.options.url}});this.flyout.appendChild(n)}(this.chatBody.isMod||this.chatBody.isAdmin)&&(this.muteButton=(0,a.default)({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Mute"),events:{click:this.actionMuteHandler}}),this.flyout.appendChild(this.muteButton),this.banButton=(0,a.default)({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Ban IP"),events:{click:this.actionBanHandler}}),this.flyout.appendChild(this.banButton),this.ignoreButton=(0,a.default)({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Ignore"),events:{click:this.actionIgnoreHandler}}),this.flyout.appendChild(this.ignoreButton)),this.chatBody.isAdmin&&(this.modButton=(0,a.default)({tagName:"button",className:"chat__actions-flyout-button",text:this.options.role?this.localize("Unmod"):this.localize("Mod"),events:{click:this.actionModHandler}}),this.flyout.appendChild(this.modButton))}},{key:"actionModHandler",value:function(){var t=this;this.modButton.textContent!==this.localize("Unmod")?this.chatBody.modActionHandler(this.options.username,function(){t.modButton.textContent=t.localize("Unmod")}):this.chatBody.unmodActionHandler(this.options.username,function(){t.modButton.textContent=t.localize("Mod")})}},{key:"actionMuteHandler",value:function(){this.muteButton.textContent!==this.localize("Unmute")?(this.chatBody.muteActionHandler(this.options.username),this.muteButton.textContent=this.localize("Unmute")):this.chatBody.unmuteActionHandler(this.options.username)}},{key:"actionIgnoreHandler",value:function(){this.ignoreButton.textContent!==this.localize("Unignore")?(this.chatBody.ignoreActionHandler(this.options.username),this.ignoreButton.textContent=this.localize("Unignore")):this.chatBody.unignoreActionHandler(this.options.username)}},{key:"actionBanHandler",value:function(){this.banButton.textContent!==this.localize("Unban IP")?(this.chatBody.banActionHandler(this.options.username),this.banButton.textContent=this.localize("Unban IP")):this.chatBody.unbanActionHandler(this.options.username)}},{key:"closeFlyoutOnBlur",value:function(t){(0,s.default)(t,this.flyout,this.parent)&&this.close()}},{key:"close",value:function(){this._blurEvent(),this._blurEventTouch(),this._closed=!0,this.flyout.parentElement.removeChild(this.flyout)}}]),t}();n.default=c,e.exports=n.default},{"../utils/addEvent":79,"../utils/createElement":80,"../utils/isBlurred":82}],67:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=r(t("../utils/createElement")),c=r(t("./chat-flyout")),l=[{name:"rateLimitDuration",value:1,text:"1s"},{name:"rateLimitDuration",value:5,text:"5s"},{name:"rateLimitDuration",value:30,text:"30s"},{name:"rateLimitDuration",value:60,text:"1m"},{name:"rateLimitDuration",value:300,text:"5m"},{name:"rateLimitDuration",value:900,text:"15m"}],h=[{name:"rateLimitMax",value:1,text:"1 chat"},{name:"rateLimitMax",value:5,text:"5 chats"},{name:"rateLimitMax",value:10,text:"10 chats"}],f=[{name:"mode",value:"user",text:"Everyone"},{name:"mode",value:"moderator",text:"Moderators"},{name:"mode",value:"owner",text:"Owner"}],d=function(t){function e(t,n,r,s){o(this,e);var a=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"admin",r("admin")));return a.parent=t,a.chat=n,a.localize=r,a.errorHandler=s,a.handleRadioChange=a.handleRadioChange.bind(a),a}return s(e,c.default),a(e,[{key:"initUser",value:function(){this.chat._roomname&&this.chat._me&&("moderator"!==this.chat._me.room.role&&"owner"!==this.chat._me.room.role&&"admin"!==this.chat._me.room.role||(this.render(),this.enableFlyout()))}},{key:"render",value:function(){var t=(0,u.default)({tagName:"div",className:"chat__info chat__info--mode",text:this.localize("Chat Mode")});this.flyout.appendChild(t),this.radioRenderer(f);var e=(0,u.default)({tagName:"div",className:"chat__description chat__description--mode",text:this.localize("The current mode of the room specifying which users can chat")});this.flyout.appendChild(e);var n=(0,u.default)({tagName:"div",className:"chat__info",text:this.localize("Chat Rate Limit")});this.flyout.appendChild(n),this.radioRenderer(h),this.radioRenderer(l);var r=(0,u.default)({tagName:"div",className:"chat__description",text:this.localize("Maximum amount of chats during time period")});this.flyout.appendChild(r)}},{key:"radioRenderer",value:function(t){for(var e=[],n=0;n<t.length;n++){var r=(0,u.default)({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:t[n].name,value:t[n].value,id:t[n].name+n},events:{change:this.handleRadioChange}});this.chat._room[t[n].name]===t[n].value&&(r.checked="checked"),e.push(r);var o=(0,u.default)({tagName:"label",className:"chat__radio-label chat__radio-label--"+t.length,text:this.localize(t[n].text),attributes:{for:t[n].name+n}});e.push(o)}var i=(0,u.default)({tagName:"div",className:"chat__radio-slider chat__radio-slider--"+t.length});e.push(i);var s=(0,u.default)({tagName:"div",className:"chat__radio-wrapper",childs:e}),a=(0,u.default)({tagName:"div",className:"chat__radio-container chat__radio-container--restricted chat__radio-container--"+t[0].name,childs:[s]});this.flyout.appendChild(a)}},{key:"handleRadioChange",value:function(t){var e=this,n={};n[t.target.name]=isNaN(t.target.value)?t.target.value:parseInt(t.target.value,10),this.chat.patchRoom(this.chat._roomname,n,function(t,n){t&&n&&n[0]&&e.errorHandler(t,n[0])})}}]),e}();n.default=d,e.exports=n.default},{"../utils/createElement":80,"./chat-flyout":71}],68:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=r(t("../utils/createElement")),a=r(t("../utils/addEvent")),u=r(t("./chat-actions-flyout")),c=function(){function t(e,n,r,i,s){var u=this;o(this,t),this.parent=e,this.chat=n,this.localize=r,this.errorHandler=i,this.options=s,this._chatLineQueue=[],this._currentChunk=this.buildChunkElement(),this._currentChunkSize=0,this._chunkView=[],this._chunkHistory=[],this._chunkStorage=[],this._scrollLocked=!0,this._scrollPaused=!1,this._scrollThrottleCount=0,this._scrollThrottleRate=100,this._scrollThrottleNewRate=!1,this.scrollToggle=this.scrollToggle.bind(this),this.scrollWheelHandler=this.scrollWheelHandler.bind(this),this.actionDelete=this.actionDelete.bind(this),this.actionMore=this.actionMore.bind(this),this.render(),this._queueProcess=setInterval(function(){u.queueProcessor()},100),setTimeout(function(){u._scrollThrottleCount=0,u._scrollThrottleInterval=setInterval(function(){u.scrollThrottleHandler()},2e3)},500),this._wheelListener1=(0,a.default)(this.chatBody,"DOMMouseScroll",this.scrollWheelHandler),this._wheelListener2=(0,a.default)(this.chatBody,"mousewheel",this.scrollWheelHandler),this._wheelListener3=(0,a.default)(this.chatBody,"wheel",this.scrollWheelHandler)}return i(t,[{key:"queueProcessor",value:function(){if(!this._scrollPaused){this._chatLineQueue.length&&this._scrollThrottleCount++;for(var t=document.createDocumentFragment();this._chatLineQueue.length&&this._currentChunkSize!==this.options.chunkSize;){var e=this._chatLineQueue.shift();t.appendChild(e),this._currentChunkSize++}if(this._currentChunk.appendChild(t),this._currentChunk.parentElement||this._chunkStorage.push(this._currentChunk),this._currentChunkSize===this.options.chunkSize&&(this._currentChunk=this.buildChunkElement(),this._currentChunksProcessed++,this._currentChunkSize=0),this._chatLineQueue.length)this.queueProcessor();else{for(var n=document.createDocumentFragment(),r=this._chunkStorage.splice(-Math.abs(this.options.chunkView));r.length;){var o=r.shift();n.appendChild(o),this._chunkView.push(o)}for(this.chatBody.appendChild(n);this._chunkView.length>this.options.chunkView;){var i=this._chunkView.shift();this.chatBody.removeChild(i),this._chunkHistory.unshift(i)}for(;this._chunkStorage.length;)this._chunkHistory.unshift(this._chunkStorage.shift());for(;this._chunkHistory>this.options.chunkHistory;)this._chunkHistory.shift();this.scrollBottom()}}}},{key:"scrollThrottleHandler",value:function(){var t=this;switch(this._scrollThrottleNewRate&&(this._scrollThrottleNewRate=!1,this._scrollThrottleCount++),this._scrollThrottleRate){case 100:this._scrollThrottleCount>=10&&(this._scrollThrottleRate=200,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){t.queueProcessor()},this._scrollThrottleRate));break;case 200:this._scrollThrottleCount>=10?(this._scrollThrottleRate=250,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){t.queueProcessor()},this._scrollThrottleRate)):this._scrollThrottleCount<5&&(this._scrollThrottleRate=100,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){t.queueProcessor()},this._scrollThrottleRate));break;default:this._scrollThrottleCount<8&&(this._scrollThrottleRate=200,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){t.queueProcessor()},this._scrollThrottleRate))}this._scrollThrottleCount=0}},{key:"processChat",value:function(t){if(!t.ignore){var e=this.buildLineElement(),n=this.writeChatToLine(e,t);this._chatLineQueue.push(n)}}},{key:"processMessage",value:function(t){var e=this.buildLineElement(),n=this.writeMessageToLine(e,t);this._chatLineQueue.push(n)}},{key:"render",value:function(){this.chatBody=(0,s.default)({tagName:"div",className:"chat__body"}),this.chatBodyContainer=(0,s.default)({tagName:"div",className:"chat__body-container",childs:[this.chatBody]}),this.chatBodyScrollButton=(0,s.default)({tagName:"div",className:"chat__body-scroll",events:{click:this.scrollToggle}}),this.parent.appendChild(this.chatBodyContainer),this.parent.appendChild(this.chatBodyScrollButton)}},{key:"buildChunkElement",value:function(){return this._chunkElement?this._chunkElement.cloneNode():(this._chunkElement=(0,s.default)({tagName:"div",className:"chat__chunk"}),this._chunkElement.cloneNode(!0))}},{key:"buildLineElement",value:function(){if(this._lineElement)return this._lineElement.cloneNode(!0);var t=[],e=(0,s.default)({tagName:"div",className:"chat__avatar"});t.push(e);var n=(0,s.default)({tagName:"span",className:"chat__line-role"});t.push(n);var r=(0,s.default)({tagName:"span",className:"chat__username"});t.push(r);var o=(0,s.default)({tagName:"span",className:"chat__line-timestamp"});t.push(o);var i=(0,s.default)({tagName:"div",className:"chat__line-content"});t.push(i);var a=(0,s.default)({tagName:"button",className:"chat__action chat__action--delete",attributes:{"data-tooltip":"Delete Chat"}});t.push(a);var u=(0,s.default)({tagName:"button",className:"chat__action chat__action--more",attributes:{"data-tooltip":"More Actions"}});return t.push(u),this._lineElement=(0,s.default)({tagName:"div",className:"chat__line",childs:t}),this._lineElement.cloneNode(!0)}},{key:"writeChatToLine",value:function(t,e){var n=t,r=n.childNodes;return r[0].setAttribute("style","background-color: "+e.actor.color+"; background-image: url("+e.actor.avatar+");"),r[1].className="chat__line-role chat__line-role--"+e.actor.role,r[1].textContent=e.actor.role,r[2].setAttribute("style","color: "+e.actor.color),r[2].textContent=e.actor.username,r[3].textContent=this.formatDate(e.timestamp),r[4].innerHTML=this.parseChatText(e),n.className="chat__line"+(e.actor.username===this.chat._username||void 0===this.chat._username?" chat__line--currentUser":""),n.setAttribute("data-username",e.actor.username),n.setAttribute("data-id",e.id),"moderator"===e.actor.role&&n.setAttribute("data-role",e.actor.role),e.url&&n.setAttribute("data-url",e.url),(0,a.default)(r[5],"click",this.actionDelete),(0,a.default)(r[6],"click",this.actionMore),n}},{key:"writeMessageToLine",value:function(t,e){var n=t,r=n.childNodes,o="";switch(e.level){case"warn":o="#EBC844";break;case"info":o="#1395BA";break;default:o="#D94E1F"}r[0].setAttribute("style","background-color: "+o+"; background-image: none;"),r[1].className="",r[1].textContent="",r[2].setAttribute("style","color: "+o),r[2].textContent=e.level,r[3].textContent="",r[4].innerHTML='<div class="chat__text">'+e.message+"</div>",n.className="chat__line chat__line--message chat__line--"+e.level;var i=function(t){t.parentElement.removeChild(t)}.bind(this,n);return(0,a.default)(r[5],"click",i),n}},{key:"formatDate",value:function(t){var e=new Date(1e3*t),n="0"+e.getMinutes(),r=e.getHours();return r%=12,(r=r||12)+":"+n.substr(-2)}},{key:"parseChatText",value:function(t){var e="<div class='chat__text'>",n=t.message,r=t.positions,o=0;for(var i in r){i=parseInt(i,10);var s=n.slice(o,i),a=n.slice(i,i+r[i].length);switch(o=i+r[i].length,s.length&&(e+=s),r[i].type){case"emoticon":this.chat&&this.chat._me&&this.chat._me.showGifs,e+="<span class='chat__line-emoticon-wrap' data-pattern='"+a+"'><img class='chat__line-emoticon' src='"+r[i].url+"'/></span>";break;case"mention":e+="<a class='"+(this.chat._username===r[i].username?"chat__line-mention chat__line-mention--me":"chat__line-mention")+"' href='/"+r[i].url+"' target='_blank'>"+a+"</a>";break;case"tag":e+="<a class='chat__line-tag' href='/tag/"+r[i].text+"' target='_blank'>"+a+"</a>";break;default:e+="<a class='chat__line-link' href='"+r[i].href+"' target='_blank'>"+a+"</a>"}}return o<n.length&&(e+=n.slice(o)),e+="</div>"}},{key:"scrollToggle",value:function(){if(this._scrollPaused)return this._scrollPaused=!1,void this.chatBodyScrollButton.classList.remove("chat__body-scroll--paused");this._scrollPaused=!0,this.chatBodyScrollButton.classList.add("chat__body-scroll--paused")}},{key:"scrollBottom",value:function(){this.chatBody.scrollTop=this.chatBody.scrollHeight}},{key:"scrollWheelHandler",value:function(){if(this.chatBody.scrollTop<=0&&this._scrollPaused&&this._chunkHistory.length){var t=this._chunkHistory.shift();return this.chatBody.insertBefore(t,this.chatBody.firstChild),void this._chunkView.unshift(t)}Math.abs(this.chatBody.scrollTop-(this.chatBody.scrollHeight-this.chatBody.offsetHeight))<=5?this._scrollPaused&&this.scrollToggle():this._scrollPaused||this.scrollToggle()}},{key:"actionDelete",value:function(t){var e=t.target.parentElement.getAttribute("data-id");this.chat.command("/delete "+e)}},{key:"actionMore",value:function(t){var e={username:t.target.parentElement.getAttribute("data-username"),id:t.target.parentElement.getAttribute("data-id"),url:t.target.parentElement.getAttribute("data-url"),role:t.target.parentElement.getAttribute("data-role")};if(this.flyout&&!this.flyout._closed&&e.id===this.flyout.options.id)return this.flyout.close(),void(this.flyout=!1);this.flyout=new u.default(t.target,this,this.localize,e)}},{key:"modActionHandler",value:function(t,e){var n=this;this.chat.command("/mod "+t,function(t,r){t?n.errorHandler(t,r[0]):(r&&r[0],e&&e())})}},{key:"unmodActionHandler",value:function(t,e){var n=this;this.chat.command("/unmod "+t,function(t,r){t?n.errorHandler(t,r[0]):(r&&r[0],e&&e())})}},{key:"muteActionHandler",value:function(t,e){var n=this;this.chat.command("/mute "+t,function(t,r){t?n.errorHandler(t,r[0]):(r&&r[0],e&&e())}),this.deleteByUsername(t)}},{key:"unmuteActionHandler",value:function(t,e){var n=this;this.chat.command("/unmute "+t,function(t,r){t?n.errorHandler(t,r[0]):(r&&r[0],e&&e())})}},{key:"ignoreActionHandler",value:function(t,e){var n=this;this.chat.command("/ignore "+t,function(t,r){t?n.errorHandler(t,r[0]):(r&&r[0],e&&e())}),this.deleteByUsername(t,!0)}},{key:"unignoreActionHandler",value:function(t,e){var n=this;this.chat.command("/unignore "+t,function(t,r){t?n.errorHandler(t,r[0]):(r&&r[0],e&&e())})}},{key:"banActionHandler",value:function(t,e){var n=this;this.chat.command("/ban "+t,function(t,r){t?n.errorHandler(t,r[0]):(r&&r[0],e&&e())}),this.deleteByUsername(t)}},{key:"unbanActionHandler",value:function(t,e){var n=this;this.chat.command("/unban "+t,function(t,r){t?n.errorHandler(t,r[0]):(r&&r[0],e&&e())})}},{key:"deleteById",value:function(t){for(var e=0;e<this._chunkView.length;e++)for(var n=this._chunkView[e].childNodes,r=0;r<n.length;r++)if(n[r].getAttribute("data-id")===t){if(this.isMod||this.isAdmin)return void n[r].classList.add("chat__line--removed");n[r].parentElement.removeChild(n[r])}}},{key:"deleteByUsername",value:function(t,e){for(var n=0;n<this._chunkView.length;n++)for(var r=this._chunkView[n].childNodes,o=0;o<r.length;o++)if(r[o].getAttribute("data-username")===t){if(e)return void r[o].parentElement.removeChild(r[o]);this.actionDelete(r[o].getAttribute("data-id"))}}},{key:"destroy",value:function(){this._wheelListener1(),this._wheelListener2(),this._wheelListener3()}},{key:"isMod",get:function(){return!!(this.chat._me&&this.chat._me.room&&this.chat._me.room.role)&&"moderator"===this.chat._me.room.role}},{key:"isAdmin",get:function(){return!!(this.chat._me&&this.chat._me.room&&this.chat._me.room.role)&&("owner"===this.chat._me.room.role||"admin"===this.chat._me.room.role)}}]),t}();n.default=c,e.exports=n.default},{"../utils/addEvent":79,"../utils/createElement":80,"./chat-actions-flyout":66}],69:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(t("../utils/createElement")),s=function(){function t(e){r(this,t),this.parent=e,this.render()}return o(t,[{key:"render",value:function(){this.el=(0,i.default)({tagName:"div",className:"chat__controls"}),this.parent.appendChild(this.el)}}]),t}();n.default=s,e.exports=n.default},{"../utils/createElement":80}],70:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=r(t("../utils/createElement")),c=r(t("./chat-flyout")),l=function(t){function e(t,n,r,s,a){o(this,e);var u=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"emoticons",s("emoticons")));return u.parent=t,u.chat=n,u.chatInput=r,u.localize=s,u.errorHandler=a,u}return s(e,c.default),a(e,[{key:"initUser",value:function(){this.enableFlyout()}},{key:"getEmoticons",value:function(){var t=this;this.chat.getAllEmoticons(this.chat._roomname,this.chat._username,function(e,n){e&&t.errorHandler(e,t.localize("Chat Error")),t.emoticons=n.emoticons,t.render()})}},{key:"firstToggleHandler",value:function(){this.getEmoticons()}},{key:"render",value:function(){var t=this;Object.keys(this.emoticons).map(function(e){var n=t.emoticons[e],r=(0,u.default)({tagName:"button",className:"chat__emoticon-selector",attributes:{style:"background-image: url("+n.source+")",title:n.pattern}}),o=(0,u.default)({tagName:"span",className:"chat__emoticon-selector-container",childs:[r]}),i=t.selectEmoticon.bind(t,n.pattern);return o.addEventListener("click",i),t.flyout.appendChild(o)}),this.parent.appendChild(this.flyout);var e=(0,u.default)({tagName:"a",className:"chat__attribution-link",text:"EmojiOne",attributes:{href:"http://emojione.com"}}),n=(0,u.default)({tagName:"div",className:"chat__attribution",text:"Emoji provided free by ",childs:[e]});this.flyout.appendChild(n)}},{key:"selectEmoticon",value:function(t){this.chatInput.chatInput.value=""+this.chatInput.chatInput.value+t+" ",this.chatInput.chatInput.focus(),this.toggleFlyout()}}]),e}();n.default=l,e.exports=n.default},{"../utils/createElement":80,"./chat-flyout":71}],71:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=r(t("../utils/isBlurred")),a=r(t("../utils/createElement")),u=r(t("../utils/addEvent")),c=function(){function t(e,n,r){o(this,t),this.parent=e,this.flyoutClassModifier=n,this.tooltipText=r,this._firstToggle=!0,this._toggleState=!1,this.toggleFlyout=this.toggleFlyout.bind(this),this.closeFlyoutOnBlur=this.closeFlyoutOnBlur.bind(this),this.flyoutRender()}return i(t,[{key:"flyoutRender",value:function(){var t=(0,a.default)({tagName:"span",className:"chat__tooltip chat__tooltip--"+this.flyoutClassModifier,text:this.tooltipText});this.flyoutButton=(0,a.default)({tagName:"button",className:"chat__flyout-button chat__flyout-button--"+this.flyoutClassModifier+" chat__flyout-button--disabled",childs:[t]}),this.parent.appendChild(this.flyoutButton),this.flyout=(0,a.default)({tagName:"div",className:"chat__flyout chat__flyout--"+this.flyoutClassModifier}),this.parent.parentElement.appendChild(this.flyout)}},{key:"enableFlyout",value:function(){this.flyoutButton.classList.remove("chat__flyout-button--disabled"),(0,u.default)(this.flyoutButton,"click",this.toggleFlyout)}},{key:"closeFlyoutOnBlur",value:function(t){(0,s.default)(t,this.flyout,this.flyoutButton)&&(this._blurEvent(),this._blurEventTouch(),this._blurEvent=null,this.flyout.classList.remove("chat__flyout--visible"))}},{key:"toggleFlyout",value:function(){this._firstToggle&&this.firstToggleHandler&&(this._firstToggle=!1,this.firstToggleHandler()),this.toggleStateHandler&&(this.toggleStateHandler(this._toggleState),this._toggleState=!this._toggleState),this.flyout.classList.toggle("chat__flyout--visible"),this._blurEvent||(this._blurEvent=(0,u.default)(document,"click",this.closeFlyoutOnBlur),this._blurEventTouch=(0,u.default)(document,"touchend",this.closeFlyoutOnBlur))}}]),t}();n.default=c,e.exports=n.default},{"../utils/addEvent":79,"../utils/createElement":80,"../utils/isBlurred":82}],72:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(t("../utils/createElement")),s=function(){function t(e,n){r(this,t),this.parent=e,this.chat=n,this.render()}return o(t,[{key:"initRoom",value:function(t){this.chatHeaderTitle.textContent=t}},{key:"render",value:function(){this.chatHeaderTitle=(0,i.default)({tagName:"h1",className:"chat__header-title"}),this.el=(0,i.default)({tagName:"div",className:"chat__header",childs:[this.chatHeaderTitle]}),this.parent.appendChild(this.el)}}]),t}();n.default=s,e.exports=n.default},{"../utils/createElement":80}],73:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(t("../utils/createElement")),s=function(){function t(e,n,o,i,s){r(this,t),this.parent=e,this.chat=n,this.chatBody=o,this.localize=i,this.errorHandler=s,this.send=this.send.bind(this),this.render()}return o(t,[{key:"initUser",value:function(){this.chatInput.classList.remove("chat__input--disabled"),this.chatInput.removeAttribute("disabled"),this.chatInput.setAttribute("placeholder",this.localize("Send message")),this.chatSend.classList.remove("chat__input-send--disabled"),this.chatSend.removeAttribute("disabled")}},{key:"render",value:function(){var t=this;this.chatInput=(0,i.default)({tagName:"input",className:"chat__input chat__input--disabled",attributes:{placeholder:this.localize("Login to chat"),disabled:"disabled"}});var e=(0,i.default)({tagName:"span",className:"chat__tooltip chat__tooltip--send",text:this.localize("send")});this.chatSend=(0,i.default)({tagName:"button",className:"chat__flyout-button chat__input-send chat__input-send--disabled",attributes:{disabled:"disabled"},events:{click:this.send},childs:[e]}),this.chatInputWrapper=(0,i.default)({tagName:"div",className:"chat__input-wrapper",childs:[this.chatInput,this.chatSend]}),this.chatInput.addEventListener("keyup",function(e){e.preventDefault(),13===e.keyCode&&t.send()}),this.parent.appendChild(this.chatInputWrapper)}},{key:"send",value:function(){var t=this,e=this.chatInput.value;null===e.match(/^\s+$/)?e&&(this.chatInput.value="",this.chat.command(e,function(e,n){if(e)throw e;if(n&&n.length)for(var r=0;r<n.length;r++){if(n[r].data&&n[r].data.help){for(var o in n[r].data.help){var i=n[r].data.help[o];t.chatBody.processMessage({level:"info",message:"/"+i.name+" "+i.text})}return}t.chatBody.processMessage(n[r])}})):this.chatInput.value=""}}]),t}();n.default=s,e.exports=n.default},{"../utils/createElement":80}],74:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=r(t("../utils/createElement")),c=r(t("./chat-flyout")),l=function(t){function e(t,n,r,s){o(this,e);var a=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"options",r("options")));return a.parent=t,a.chat=n,a.localize=r,a.errorHandler=s,a.showGifsHandler=a.showGifsHandler.bind(a),a.showTimestampsHandler=a.showTimestampsHandler.bind(a),a}return s(e,c.default),a(e,[{key:"initUser",value:function(){this.enableFlyout(),this.renderOptions()}},{key:"renderOptions",value:function(){var t=(0,u.default)({tagName:"div",className:"chat__options-switch-slider"}),e=(0,u.default)({tagName:"div",className:"chat__options-switch-name",text:this.localize("Show Animated Gifs")}),n=(0,u.default)({tagName:"input",className:"chat__options-switch-checkbox",attributes:{type:"checkbox",id:"showGifs"},events:{change:this.showGifsHandler}});this.chat._me.showGifs&&(n.checked=!0);var r=(0,u.default)({tagName:"label",className:"chat__options-switch",childs:[t],attributes:{for:"showGifs"}}),o=(0,u.default)({tagName:"div",className:"chat__options-switch-container",childs:[n,r,e]}),i=(0,u.default)({tagName:"div",className:"chat__options-switch-slider"}),s=(0,u.default)({tagName:"div",className:"chat__options-switch-name",text:this.localize("Show Timestamps")}),a=(0,u.default)({tagName:"input",className:"chat__options-switch-checkbox",attributes:{type:"checkbox",id:"showTimestamps"},events:{change:this.showTimestampsHandler}});this.chat._me.showTimestamps&&(a.checked=!0);var c=(0,u.default)({tagName:"label",className:"chat__options-switch",childs:[i],attributes:{for:"showTimestamps"}}),l=(0,u.default)({tagName:"div",className:"chat__options-switch-container",childs:[a,c,s]});this.flyout.appendChild(l),this.flyout.appendChild(o)}},{key:"showGifsHandler",value:function(t){var e=this,n={};n.showGifs=t.target.checked,this.chat.patchUser(this.chat._username,n,function(t,n){t&&n&&e.errorHandler(t,n[0])})}},{key:"showTimestampsHandler",value:function(t){var e=this,n={};n.showTimestamps=t.target.checked,this.chat.patchUser(this.chat._username,n,function(t,n){t&&n&&e.errorHandler(t,n[0])})}}]),e}();n.default=l,e.exports=n.default},{"../utils/createElement":80,"./chat-flyout":71}],75:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(t("../utils/createElement")),s=function(){function t(e,n,o){r(this,t),this.parent=e,this.onClick=n,this.localize=o,this.render()}return o(t,[{key:"render",value:function(){var t=(0,i.default)({tagName:"span",className:"chat__tooltip",text:this.localize("popout")});this.el=(0,i.default)({tagName:"button",className:"chat__flyout-button chat__flyout-button--popout",events:{click:this.onClick},childs:[t]}),this.parent.appendChild(this.el)}}]),t}();n.default=s,e.exports=n.default},{"../utils/createElement":80}],76:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=r(t("../utils/createElement")),c=r(t("./chat-flyout")),l=r(t("./chat-actions-flyout")),h=function(t){function e(t,n,r,s,a,u){o(this,e);var c=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"roster",s("roster")));return c.parent=t,c.chat=n,c.chatBody=r,c.localize=s,c.errorHandler=a,c.options=u,c.updateRoster=c.updateRoster.bind(c),c.cleanUpdateRoster=c.cleanUpdateRoster.bind(c),c.handleRadioChange=c.handleRadioChange.bind(c),c.loadMoreHandler=c.loadMoreHandler.bind(c),c.actionMore=c.actionMore.bind(c),c}return s(e,c.default),a(e,[{key:"initUser",value:function(){this.render(),this.roster=this.chat.getRoster({limit:this.options.rosterLimit,role:""}),this.enableFlyout()}},{key:"toggleStateHandler",value:function(t){t||this.roster.update(this.cleanUpdateRoster)}},{key:"render",value:function(){this.rosterRadioUser=(0,u.default)({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:"rosterSort",value:"",checked:"checked",id:"rosterSortUser"},events:{change:this.handleRadioChange}}),this.rosterRadioModerator=(0,u.default)({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:"rosterSort",value:"moderator",id:"rosterSortModerator"},events:{change:this.handleRadioChange}}),this.rosterRadioUserLabel=(0,u.default)({tagName:"label",className:"chat__radio-label",text:this.localize("Everyone"),attributes:{for:"rosterSortUser"}}),this.rosterRadioModeratorLabel=(0,u.default)({tagName:"label",className:"chat__radio-label",text:this.localize("Moderators"),attributes:{for:"rosterSortModerator"}}),this.rosterRadioWrapper=(0,u.default)({tagName:"div",className:"chat__radio-wrapper",childs:[this.rosterRadioUser,this.rosterRadioUserLabel,this.rosterRadioModerator,this.rosterRadioModeratorLabel]}),this.rosterRadioContainer=(0,u.default)({tagName:"div",className:"chat__radio-container chat__radio-container--sort",childs:[this.rosterRadioWrapper]}),this.rosterLoadMore=(0,u.default)({tagName:"button",className:"chat__roster-load-more",text:this.localize("Load More"),events:{click:this.loadMoreHandler}}),this.rosterContainer=(0,u.default)({tagName:"div",className:"chat__roster-container"}),this.rosterScrollContainer=(0,u.default)({tagName:"div",className:"chat__roster-scroll",childs:[this.rosterContainer,this.rosterLoadMore]}),this.flyout.appendChild(this.rosterRadioContainer),this.flyout.appendChild(this.rosterScrollContainer)}},{key:"handleRadioChange",value:function(t){var e={limit:this.options.rosterLimit};e.role=t.target.value,this.roster._options=e,this.roster.update(this.cleanUpdateRoster)}},{key:"loadMoreHandler",value:function(){this.roster.next(this.updateRoster)}},{key:"cleanUpdateRoster",value:function(t,e){for(;this.rosterContainer.firstChild;)this.rosterContainer.removeChild(this.rosterContainer.firstChild);this.updateRoster(t,e)}},{key:"updateRoster",value:function(t,e){if(t)this.errorHandler(t,{message:this.localize("Error updating roster"),level:"error"});else{for(var n=0;n<e.length;n++){var r=[];if("user"!==e[n].role){var o=(0,u.default)({tagName:"span",className:"chat__roster-role",text:e[n].role,attributes:{style:"background:"+e[n].roleColor}});r.push(o)}var i=(0,u.default)({tagName:"span",className:"chat__roster-actor",text:e[n].username});r.push(i);var s=(0,u.default)({tagName:"button",className:"chat__action chat__action--more chat__action--roster",attributes:{"data-tooltip":"More Actions"},events:{click:this.actionMore}});r.push(s);var a=(0,u.default)({tagName:"div",className:"chat__roster-actor-container",childs:r,attributes:{"data-username":e[n].username,"data-role":e[n].role}});this.rosterContainer.appendChild(a)}this.roster._nextParams?this.rosterLoadMore.classList.remove("chat__roster-load-more--disable"):this.rosterLoadMore.classList.add("chat__roster-load-more--disable")}}},{key:"actionMore",value:function(t){var e={username:t.target.parentElement.getAttribute("data-username"),id:t.target.parentElement.getAttribute("data-username"),role:t.target.parentElement.getAttribute("data-role"),modifierClass:"chat__actions-flyout--roster"};if(this.actionsFlyout&&!this.actionsFlyout._closed&&e.id===this.actionsFlyout.options.id)return this.actionsFlyout.close(),void(this.actionsFlyout=!1);this.actionsFlyout=new l.default(t.target,this.chatBody,this.localize,e)}}]),e}();n.default=h,e.exports=n.default},{"../utils/createElement":80,"./chat-actions-flyout":66,"./chat-flyout":71}],77:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();t("classlist-polyfill");var l=r(t("events")),h=r(t("@livelyvideo/chat-core/lib/source")),f=r(t("@livelyvideo/logger-core/lib/source")),d=r(t("@livelyvideo/localization")),p=r(t("./components/chat-body")),_=r(t("./components/chat-emoticons")),m=r(t("./components/chat-input")),y=r(t("./components/chat-options")),v=r(t("./components/chat-roster")),b=r(t("./components/chat-admin")),g=r(t("./components/chat-controls")),w=r(t("./components/chat-popout")),k=r(t("./components/chat-header")),E=r(t("./utils/popout")),O=r(t("./utils/createElement")),x=r(t("./utils/forwardEvents")),j=r(t("./package-json")),T=new f.default(j.default),C={user:null,room:null,host:null,authUrl:null,popout:null,chunkHistory:20,chunkSize:10,chunkView:5,rosterLimit:100,locale:null,messages:null,loggerOptions:{}},N=function(t){function e(t,n){o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));r.options=u({},C,n);var s=new d.default(r.options.locale,r.options.messages);return r.localize=s.localize.bind(s),r.errorHandler=r.errorHandler.bind(r),r.mount(t),r.init(),r}return s(e,l.default),c(e,[{key:"init",value:function(){var t=this;this.chat=new h.default({room:this.options.room,host:this.options.host,wshost:this.options.wshost,insecure:this.options.insecure,roleHistory:this.options.roleHistory},{url:this.options.authUrl}),this.chat.on("error",function(e,n){return t.errorHandler(e,n)}),(0,x.default)(this.chat,this),T.setOptions(this.options.loggerOptions,this),T.setInstanceOptions({host:this.options.host}),this.render(),this.initUnauthedUser()}},{key:"mount",value:function(t){var e=this;switch(void 0===t?"undefined":a(t)){case"string":this.el=document.querySelector(t);break;case"object":this.el=t;break;default:setTimeout(function(){return e.emit("error",new Error("The constructor has not been given a valid element or selector."))})}this.el.classList.add("chat")}},{key:"errorHandler",value:function(t,e){var n=void 0;switch(void 0===t?"undefined":a(t)){case"string":n={level:"error",message:this.localize(t)};break;case"object":if(t instanceof Error){n={level:"error",message:this.localize(t.message)};break}}this.chatBody&&this.chatBody.processMessage(n)}},{key:"render",value:function(){var t=this;this.chatHeader=new k.default(this.el,this.chat),this.chatBody=new p.default(this.el,this.chat,this.localize,this.errorHandler,this.options),this.chatInput=new m.default(this.el,this.chat,this.chatBody,this.localize),this.chatEmoticons=new _.default(this.el,this.chat,this.chatInput,this.localize,this.errorHandler),this.chatControls=new g.default(this.el),this.options.popout&&(this.chatPopout=new w.default(this.chatControls.el,this.openPopout.bind(this),this.localize)),this.chatAdmin=new b.default(this.chatControls.el,this.chat,this.localize,this.errorHandler,this.options),this.chatRoster=new v.default(this.chatControls.el,this.chat,this.chatBody,this.localize,this.errorHandler,this.options),this.chatOptions=new y.default(this.chatControls.el,this.chat,this.localize,this.errorHandler),this.chat.on("chat",function(e){return t.chatBody.processChat(e)}),this.chat.once("room",function(e){t.chat._roomname=e.name,t.chatHeader.initRoom(e.title||e.name)}),this.chat.on("message",function(e){return t.chatBody.processMessage(e)}),this.chat.on("delete",function(e){return t.chatBody.deleteById(e.id)})}},{key:"initUnauthedUser",value:function(){var t=this;this.chat.once("me",function(e){if(t.chat._username=e.username,e){if(t.history)for(var n=0;n<t.history.messages.length;n++)t.chatBody.processChat(t.history.messages[n]);t.meHandler(e),t.initAuthedUser(e)}else t.roleHandler({room:{role:"anon"}})}),this.history=!1,this.chat.once("history",function(e){if(t.chat_username&&e)for(var n=0;n<e.messages.length;n++)t.chatBody.processChat(e.messages[n]);else t.history=e})}},{key:"initAuthedUser",value:function(t){var e=this;this.chatOptions.initUser(),this.chatEmoticons.initUser(),this.chatInput.initUser(),this.chatRoster.initUser(),this.chatAdmin.initUser(),this._currentRole=t.room.role,this.chat.on("me",function(t){return e.meHandler(t)})}},{key:"meHandler",value:function(t){this.roleHandler(t),t.showTimestamps?this.el.classList.add("chat--timestamps"):this.el.classList.remove("chat--timestamps")}},{key:"roleHandler",value:function(t){if(this._currentRole&&this._currentRole!==t.room.role){var e={};switch(e.level="info",this._currentRole){case"user":e.message=this.localize("You have been modded");break;default:e.message=this.localize("You have been unmodded")}this.chatBody.processMessage(e)}this._currentRole=t.room.role;var n="chat";this.chatBody.isMod&&(n+=" chat--isMod"),this.chatBody.isAdmin&&(n+=" chat--isAdmin"),this.el.className=n}},{key:"openPopout",value:function(){var t=this;this.popout=new E.default(this.options.popout,{width:340,height:640}),this._unmountClose=this.popout.on("close",function(){setTimeout(function(){t.popout&&t.popout.instance&&t.popout.instance.closed&&t.closePopout()},250)}),this.destroy(),this.renderNoPopout()}},{key:"closePopout",value:function(){this.popout&&(this.popout.close(),this.popout=null),this._unmountClose&&(this._unmountClose=null),this.destroyNoPopout(),this.init()}},{key:"renderNoPopout",value:function(){var t=(0,O.default)({tagName:"div",className:"chat__poppedout-text",text:"Your chat is popped out"});this._popoutEl=(0,O.default)({tagName:"div",className:"chat__poppedout",childs:[t]}),this.el.appendChild(this._popoutEl)}},{key:"destroyNoPopout",value:function(){this.el.removeChild(this._popoutEl)}},{key:"destroy",value:function(){for(this.chat.destroy(),this.chatBody.destroy(),this.el.className="chat";this.el.firstChild;)this.el.removeChild(this.el.firstChild)}}]),e}();n.default=N,e.exports=n.default},{"./components/chat-admin":67,"./components/chat-body":68,"./components/chat-controls":69,"./components/chat-emoticons":70,"./components/chat-header":72,"./components/chat-input":73,"./components/chat-options":74,"./components/chat-popout":75,"./components/chat-roster":76,"./package-json":78,"./utils/createElement":80,"./utils/forwardEvents":81,"./utils/popout":83,"@livelyvideo/chat-core/lib/source":11,"@livelyvideo/localization":18,"@livelyvideo/logger-core/lib/source":22,"classlist-polyfill":25,events:84}],78:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default={version:"1.1.0",name:"@livelyvideo/chat"},e.exports=n.default},{}],79:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t,e,n){if(t.addEventListener)return t.addEventListener(e,n),function(){t.removeEventListener(e,n)};return t.attachEvent("on"+e,function(){n.call(t)}),function(){t.detachEvent("on"+e,function(){n.call(t)})}},e.exports=n.default},{}],80:[function(t,e,n){"use strict";function r(t){var e=void 0,n=void 0,o=void 0;if(t.tagName){if(e=document.createElement(t.tagName),t.className&&(e.className=t.className),t.attributes)for(n in t.attributes)e.setAttribute(n,t.attributes[n]);void 0!==t.html&&(e.innerHTML=t.html)}else e=document.createDocumentFragment();if(t.text&&e.appendChild(document.createTextNode(t.text)),void 0===window.HTMLElement&&(window.HTMLElement=Element),t.childs&&t.childs.length)for(o=0;o<t.childs.length;o++)e.appendChild(t.childs[o]instanceof window.HTMLElement?t.childs[o]:r(t.childs[o]));if(t.events)for(var i in t.events)e.addEventListener(i,t.events[i]);return e}Object.defineProperty(n,"__esModule",{value:!0}),n.default=r,e.exports=n.default},{}],81:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t){return t&&t.__esModule?t:{default:t}}(t("events"));n.default=function(t,e,n){if(!(t instanceof r.default))throw new Error("src must be an emitter");if(!(e instanceof r.default))throw new Error("dst must be an emitter");var o=t.emit;t.once("error",function(){}),t.emit=function(r){if(o.apply(t,arguments),!n||-1!==n.indexOf(r))return e.emit.apply(e,arguments)}.bind(t)},e.exports=n.default},{events:84}],82:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(t,e,n){for(var r=t.target;r&&r!==document.body;){if(r===e||r===n)return!1;r=r.parentNode}return!0},e.exports=n.default},{}],83:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("events"),c={width:640,height:550,toolbar:!1,menubar:!1,location:!1,status:!1,scrollbars:!1,resizable:!0,left:0,top:0},l=function(t){function e(t,n){r(this,e);var i=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(!(i instanceof e)){var a;return a=new e(t,n),o(i,a)}i.options=s({},c,n);var u=i.getParamsString(n);return i.instance=window.open(t,Date.now(),u),setTimeout(function(){return i.onPopupLoad()}),setTimeout(function(){return i.onPopupLoad()},250),i}return i(e,u.EventEmitter),a(e,[{key:"onBeforeUnload",value:function(t){var e=this;this.emit("close",t),setTimeout(function(){e.instance.closed||(e.instance.onbeforeunload=e.onBeforeUnload.bind(e))},250)}},{key:"close",value:function(){this.instance.close()}},{key:"onPopupLoad",value:function(){try{this.instance.isPopup=!0,this.instance.onbeforeunload=this.onBeforeUnload.bind(this)}catch(t){}}},{key:"getParamsString",value:function(t){var e=[];for(var n in t)e.push(n+"="+t[n]);return e=e.join(",")}}]),e}();n.default=l,e.exports=n.default},{events:84}],84:[function(t,e,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(t){return"function"==typeof t}function i(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function a(t){return void 0===t}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!i(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,i,u,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(n=this._events[t],a(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(s(n))for(i=Array.prototype.slice.call(arguments,1),r=(c=n.slice()).length,u=0;u<r;u++)c[u].apply(this,i);return!0},r.prototype.addListener=function(t,e){var n;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!o(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,i,a;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],i=n.length,r=-1,n===e||o(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(a=i;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],o(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}]},{},[77])(77)});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}]},{},[1]);
