(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

var _chat = require('@livelyvideo/chat');

var _chat2 = _interopRequireDefault(_chat);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
Set up the chat instance

Params:
	- html element
	- options
			user: users username, should be unique to the user
			room: room name
			apiHost: lively chat api
			websocketHost: lively ws api
			url: the company's auth url, which should access livelyvideo to create an access token for the user
**/
var chat = void 0;
var ROOM = 'blt2';
function createChat(user, el) {
	if (chat) {
		chat.destroy();
	}
	chat = new _chat2.default(el, {
		user: user,
		room: ROOM,
		apiHost: 'https://dev.livelyvideo.tv',
		websocketHost: 'ws://ws-dev.livelyvideo.tv',
		authUrl: '/access-token'
	});
}

document.querySelector('#pickuser').onsubmit = function (e) {
	e.preventDefault();
	createChat(e.target.querySelector('[name=username]').value, document.querySelector('.chat'));
	e.target.setAttribute('disabled', true);
	e.target.querySelector('[name=username]').value = '';
};

},{"@livelyvideo/chat":2}],2:[function(require,module,exports){
(function (global){
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.LivelyChat=e()}}(function(){var define,module,exports;return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(require,module,exports){!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.LivelyAuthClient=t():e.LivelyAuthClient=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),l=n(2),c=r(l),h=n(3),f=r(h),d=n(43),p=r(d),m=n(46),v=r(m),_=n(47),y=r(_),b=n(48),g=r(b),w=n(49),E=r(w),k=n(50),x=r(k),T=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!e)throw new Error("chat configuration is required");if(!e.room)throw new Error("chat room is required");if(!e.apiHost)throw new Error("chat REST API server host is required");if(0!==e.apiHost.indexOf("https://")&&0!==e.apiHost.indexOf("http://")&&0!==e.apiHost.indexOf("//"))throw new Error("chat REST API server host must start with ws://, wss:// or //");if(!e.websocketHost)throw new Error("chat websocket server host is required");var s=null;if(0===e.websocketHost.indexOf("wss://"))s=!0;else if(0===e.websocketHost.indexOf("ws://"))s=!1;else if(0!==e.websocketHost.indexOf("//"))throw new Error("chat websocket server host must start with ws://, wss:// or //");var a=e.apiHost+"/chat/v1/rooms/"+e.room+"/command",u=e.apiHost+"/chat/v1/manifests/say/rooms/"+e.room+"/version",l=e.websocketHost+"/chat/ws/v1/rooms/"+e.room,h="/chat/http/v1/rooms/"+e.room;if(r._rosterUrl=e.apiHost+"/chat/v1/rooms/"+e.room+"/roster",r._changeroleUrl=e.apiHost+"/chat/v1/rooms/"+e.room+"/changeroles",r._routeStart=e.apiHost+"/chat/v1",n){if(!n.url)throw new Error("authorization configuration url is required");r._auth=new c["default"]("chat",n.url,n.options)}var d=new y["default"](u);if(r._parser=d,r._auth&&(r._http=new x["default"](r._auth),r._command=new v["default"](r._auth,a)),window.WebSocket)r._socketInterface=new f["default"](l,r._auth);else{var m="";m=s===!0?"https://"+e.websocketHost.slice(6)+h:s===!1?"http://"+e.websocketHost.slice(5)+h:""+e.websocketHost+h,r._socketInterface=new p["default"](m,r._auth)}return r._socketInterface.on("error",function(e){r.emit("error",e)}),r._socketInterface.on("ready",function(){r.emit("ready")}),r._historyEmitted=!1,r._socketInterface.on("unauthorized",function(){if(r._historyEmitted)return void r.emit("me",null);var e=function(){r.emit("me",null)},t=window.setTimeout(function(){e(),e=null},3e3);r.once("history",function(){e&&e(),window.clearTimeout(t)})}),r._socketInterface.on("disconnect",function(){r._historyEmitted=!1,r.emit("disconnect")}),r._socketInterface.on("message",function(e){d.parseMessage(e,r._emitCommand.bind(r))}),r._sayDedupe=[],r._me=null,r._room=null,r}return s(t,e),a(t,[{key:"getDefaultAvatars",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/avatars",e)}},{key:"setDefaultUserAvatar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/users/"+e+"/avatar",{"default":t},n)}},{key:"getUserEmoticons",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/users/"+e+"/emoticons",t)}},{key:"getAllEmoticons",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/rooms/"+e+"/users/"+t+"/emoticons/all",n)}},{key:"postUserEmoticon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPost(this._routeStart+"/users/"+e+"/emoticons",t,n)}},{key:"deleteUserEmoticon",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execDelete(this._routeStart+"/users/"+e+"/emoticons/"+t,n)}},{key:"getUserAvatar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/users/"+e+"/avatar",t)}},{key:"putUserAvatar",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPut(this._routeStart+"/users/"+e+"/avatar",t,n)}},{key:"getUser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/users/"+e,t)}},{key:"patchUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/users/"+e,t,n)}},{key:"getRoomUser",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/rooms/"+e+"/users/"+t,n)}},{key:"patchRoomUser",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/rooms/"+e+"/users/"+t,n,r)}},{key:"getRoom",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};this._httpCheckAuth(),this._http.execGet(this._routeStart+"/rooms/"+e,t)}},{key:"patchRoom",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._httpCheckAuth(),this._http.execPatch(this._routeStart+"/rooms/"+e,t,n)}},{key:"getChangeroles",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._auth)throw new Error("Changeroles calls require authentication");var t=Object.assign({},{limit:100,role:""},e);return new E["default"](this._auth,this._changeroleUrl,t)}},{key:"getRoster",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},{limit:100,role:""},e);return new g["default"](this._rosterUrl,t)}},{key:"command",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!this._auth)throw new Error("Command calls require authentication");this._command.run(e,function(e,r){if(e)return void n(e);for(var o=r.length-1;o>=0;o--)r[o].data&&r[o].data&&r[o].data.command&&(t._parser.parseMessage(r[o].data.command,t._emitCommand.bind(t)),r.splice(0,1));n(null,r)})}},{key:"destroy",value:function(){this._auth.destroy(),this._socketInterface.destroy()}},{key:"_emitCommand",value:function(e,t,n){if(e)return void this.emit("error",e);switch(t){case"SAY":this._emitSay(n);break;case"ME":this._me=n,this.emit("me",n);break;case"ROOM":this._room=n,this.emit("room",n);break;case"MESSAGE":this.emit("message",n);break;case"HISTORY":this.emit("history",n),this._historyEmitted=!0;break;case"DELETE":this.emit("delete",n)}}},{key:"_emitSay",value:function(e){for(var t=this._sayDedupe.length-1;t>=0;t--)if(this._sayDedupe[t]===e.id)return;this._me&&this._me.ignore&&-1!==this._me.ignore.indexOf(e.actor.id)&&(e.ignore=!0),this._sayDedupe.length>50&&this._sayDedupe.splice(0,1),this._sayDedupe.push(e.id),this.emit("chat",e)}},{key:"_httpCheckAuth",value:function(){if(!this._auth)throw new Error("Http calls require authentication")}}]),t}(u.EventEmitter);t["default"]=T},function(e){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function r(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},t.prototype.emit=function(e){var t,r,s,a,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(r=this._events[e],i(r))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(o(r))for(a=Array.prototype.slice.call(arguments,1),l=r.slice(),s=l.length,u=0;s>u;u++)l[u].apply(this,a);return!0},t.prototype.addListener=function(e,r){var s;if(!n(r))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(r.listener)?r.listener:r),this._events[e]?o(this._events[e])?this._events[e].push(r):this._events[e]=[this._events[e],r]:this._events[e]=r,o(this._events[e])&&!this._events[e].warned&&(s=i(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){function r(){this.removeListener(e,r),o||(o=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var o=!1;return r.listener=t,this.on(e,r),this},t.prototype.removeListener=function(e,t){var r,i,s,a;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,i=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(a=s;a-->0;)if(r[a]===t||r[a].listener&&r[a].listener===t){i=a;break}if(0>i)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},t.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],n(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},function(module,exports,__webpack_require__){!function(e,t){module.exports=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(module,exports,__webpack_require__){eval("'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n	value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _events = __webpack_require__(1);\n\n__webpack_require__(2);\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar defaultOptions = {\n	timeout: 5000,\n	headers: {}\n};\n\nvar defaultHeaders = {\n	Accept: 'application/json'\n};\n\n/**\n * @class Lively Video authorization client\n */\n\nvar Authorization = function (_EventEmitter) {\n	_inherits(Authorization, _EventEmitter);\n\n	/**\n  * @constructs Authorization\n  * @param {string} scope - Scope of the authorization\n  * @param {string} url - Url of your company's authorization endpoint. The expected response is {'token': 'unique token', 'expire': 'RFC3339 expiration time'}\n  * @param {Config} [options] - Configurable options for the Authorization class\n  * @param {string} [options.timeout=5000] - Authenticated request timeout in milliseconds. Timed out errors will return an Error('authorization: timeout')\n  * @param {Object} [options.headers] - Additional headers to use for the request\n  * @throws Will throw an error if no scope or no url is provided\n  */\n	function Authorization(scope, url) {\n		var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n		_classCallCheck(this, Authorization);\n\n		var _this = _possibleConstructorReturn(this, (Authorization.__proto__ || Object.getPrototypeOf(Authorization)).call(this));\n\n		if (!scope) {\n			throw new Error('scope is required');\n		}\n\n		if (!url) {\n			throw new Error('authorization server url is required');\n		}\n\n		// require parameters\n		_this._options = Object.assign({}, defaultOptions, options);\n\n		if (url.indexOf('?') === -1) {\n			_this._url = url + '?scope=' + scope;\n		} else {\n			_this._url = url + '&scope=' + scope;\n		}\n\n		// internal\n		_this._stopped = false;\n		_this._fatalError = null;\n		_this._token = null;\n		_this._retries = [0, // immediate\n		200, // 200ms\n		1000, // 1s\n		3000 // 3s\n		];\n		_this._retry = 0;\n		_this._autorefresh = null;\n\n		_this._headers = Object.assign({}, defaultHeaders, options.headers);\n		_this._retryRequest();\n		return _this;\n	}\n\n	_createClass(Authorization, [{\n		key: 'destroy',\n		value: function destroy() {\n			this._stopped = true;\n		}\n\n		/**\n   * This callback will execute a request which requires the auth token.\n   * @callback cbRequest\n   * @param {Error} e - Returns a timeout error (Error('authorization: timeout')) or a fatal error\n   * @param {string} token - The authorization bearer token to use in Lively Video API requests\n   */\n\n		/**\n   * Execute a request which requires an authorization token when the token is available\n   * @param {cbRequest} cb - The callback that executes the request.\n   */\n\n	}, {\n		key: 'request',\n		value: function request() {\n			var _this2 = this;\n\n			var cb = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : function () {};\n\n			if (this._fatalError) {\n				cb(this._fatalError);\n				return;\n			}\n\n			if (this._token !== null) {\n				cb(null, this._token);\n				return;\n			}\n\n			var done = false;\n			var pass = function pass() {\n				if (!done) {\n					done = true;\n					cb(null, _this2._token);\n				}\n			};\n\n			var timeout = function timeout() {\n				if (!done) {\n					done = true;\n					cb(new Error('authorization: timeout'));\n				}\n			};\n\n			var t = setTimeout(function () {\n				_this2.removeListener('ready', pass);\n				timeout();\n			}, this._options.timeout);\n\n			this.once('ready', function () {\n				clearTimeout(t);\n				pass();\n			});\n		}\n\n		/**\n   * Should be called if a Lively Video endpoint returned an 401 error. A new request will be issued to the authorization server's endpoint to get a new token.\n   */\n\n	}, {\n		key: 'refreshToken',\n		value: function refreshToken() {\n			var _this3 = this;\n\n			if (this._token !== null) {\n				if (this._autorefresh !== null) {\n					clearTimeout(this._autorefresh);\n					this._autorefresh = null;\n				}\n				this._token = null;\n				(function () {\n					_this3._retryRequest();\n				})();\n			}\n		}\n\n		/**\n   * Make a request or retry after the current retry number's delay\n   * @ignore\n   */\n\n	}, {\n		key: '_retryRequest',\n		value: function _retryRequest() {\n			var _this4 = this;\n\n			var retry = this._retries[this._retry];\n			if (retry) {\n				setTimeout(function () {\n					_this4._makeRequest();\n				}, retry);\n				return;\n			}\n			this._makeRequest();\n		}\n\n		/**\n   * Make a request to the authorization server.\n   * @ignore\n   */\n\n	}, {\n		key: '_makeRequest',\n		value: function _makeRequest() {\n			var _this5 = this;\n\n			fetch(this._url, {\n				credentials: 'same-origin',\n				headers: this._headers\n			}).then(function (response) {\n				if (response.status >= 200 && response.status < 300) {\n					return response.json();\n				}\n				if (response.status === 401) {\n					var e = new Error('authorization: unauthorized');\n					e.fatal = true;\n					throw e;\n				}\n				if (response.status === 403) {\n					var _e = new Error('authorization: forbidden');\n					_e.fatal = true;\n					throw _e;\n				}\n				throw new Error('authorization: non-200 response code from auth server');\n			}).then(function (json) {\n				_this5._token = json.token;\n				_this5._retry = 0;\n				_this5.emit('ready', {\n					token: json.token\n				});\n\n				// re-request a minute before expiration\n				var retryAfter = new Date(json.expire).getTime() - Date.now() - 60 * 1000;\n				_this5._autorefresh = setTimeout(function () {\n					_this5._autorefresh = null;\n					if (!_this5._stopped) {\n						_this5._retryRequest();\n					}\n				}, retryAfter);\n			}).catch(function (e) {\n				_this5._token = null;\n\n				if (e.fatal) {\n					_this5._fatalError = e;\n					return;\n				}\n\n				_this5._retryRequest();\n				if (_this5._retry < _this5._retries.length - 1) {\n					_this5._retry++;\n				}\n			});\n		}\n	}]);\n\n	return Authorization;\n}(_events.EventEmitter);\n\nexports.default = Authorization;\nmodule.exports = exports['default'];\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/index.js\n// module id = 0\n// module chunks = 0\n//# sourceURL=webpack:///./src/index.js?")},function(module,exports){eval("// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/events/events.js\n// module id = 1\n// module chunks = 0\n//# sourceURL=webpack:///./~/events/events.js?")},function(module,exports){eval("(function(self) {\n  'use strict';\n\n  if (self.fetch) {\n    return\n  }\n\n  var support = {\n    searchParams: 'URLSearchParams' in self,\n    iterable: 'Symbol' in self && 'iterator' in Symbol,\n    blob: 'FileReader' in self && 'Blob' in self && (function() {\n      try {\n        new Blob()\n        return true\n      } catch(e) {\n        return false\n      }\n    })(),\n    formData: 'FormData' in self,\n    arrayBuffer: 'ArrayBuffer' in self\n  }\n\n  function normalizeName(name) {\n    if (typeof name !== 'string') {\n      name = String(name)\n    }\n    if (/[^a-z0-9\\-#$%&'*+.\\^_`|~]/i.test(name)) {\n      throw new TypeError('Invalid character in header field name')\n    }\n    return name.toLowerCase()\n  }\n\n  function normalizeValue(value) {\n    if (typeof value !== 'string') {\n      value = String(value)\n    }\n    return value\n  }\n\n  // Build a destructive iterator for the value list\n  function iteratorFor(items) {\n    var iterator = {\n      next: function() {\n        var value = items.shift()\n        return {done: value === undefined, value: value}\n      }\n    }\n\n    if (support.iterable) {\n      iterator[Symbol.iterator] = function() {\n        return iterator\n      }\n    }\n\n    return iterator\n  }\n\n  function Headers(headers) {\n    this.map = {}\n\n    if (headers instanceof Headers) {\n      headers.forEach(function(value, name) {\n        this.append(name, value)\n      }, this)\n\n    } else if (headers) {\n      Object.getOwnPropertyNames(headers).forEach(function(name) {\n        this.append(name, headers[name])\n      }, this)\n    }\n  }\n\n  Headers.prototype.append = function(name, value) {\n    name = normalizeName(name)\n    value = normalizeValue(value)\n    var list = this.map[name]\n    if (!list) {\n      list = []\n      this.map[name] = list\n    }\n    list.push(value)\n  }\n\n  Headers.prototype['delete'] = function(name) {\n    delete this.map[normalizeName(name)]\n  }\n\n  Headers.prototype.get = function(name) {\n    var values = this.map[normalizeName(name)]\n    return values ? values[0] : null\n  }\n\n  Headers.prototype.getAll = function(name) {\n    return this.map[normalizeName(name)] || []\n  }\n\n  Headers.prototype.has = function(name) {\n    return this.map.hasOwnProperty(normalizeName(name))\n  }\n\n  Headers.prototype.set = function(name, value) {\n    this.map[normalizeName(name)] = [normalizeValue(value)]\n  }\n\n  Headers.prototype.forEach = function(callback, thisArg) {\n    Object.getOwnPropertyNames(this.map).forEach(function(name) {\n      this.map[name].forEach(function(value) {\n        callback.call(thisArg, value, name, this)\n      }, this)\n    }, this)\n  }\n\n  Headers.prototype.keys = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push(name) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.values = function() {\n    var items = []\n    this.forEach(function(value) { items.push(value) })\n    return iteratorFor(items)\n  }\n\n  Headers.prototype.entries = function() {\n    var items = []\n    this.forEach(function(value, name) { items.push([name, value]) })\n    return iteratorFor(items)\n  }\n\n  if (support.iterable) {\n    Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n  }\n\n  function consumed(body) {\n    if (body.bodyUsed) {\n      return Promise.reject(new TypeError('Already read'))\n    }\n    body.bodyUsed = true\n  }\n\n  function fileReaderReady(reader) {\n    return new Promise(function(resolve, reject) {\n      reader.onload = function() {\n        resolve(reader.result)\n      }\n      reader.onerror = function() {\n        reject(reader.error)\n      }\n    })\n  }\n\n  function readBlobAsArrayBuffer(blob) {\n    var reader = new FileReader()\n    reader.readAsArrayBuffer(blob)\n    return fileReaderReady(reader)\n  }\n\n  function readBlobAsText(blob) {\n    var reader = new FileReader()\n    reader.readAsText(blob)\n    return fileReaderReady(reader)\n  }\n\n  function Body() {\n    this.bodyUsed = false\n\n    this._initBody = function(body) {\n      this._bodyInit = body\n      if (typeof body === 'string') {\n        this._bodyText = body\n      } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n        this._bodyBlob = body\n      } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n        this._bodyFormData = body\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this._bodyText = body.toString()\n      } else if (!body) {\n        this._bodyText = ''\n      } else if (support.arrayBuffer && ArrayBuffer.prototype.isPrototypeOf(body)) {\n        // Only support ArrayBuffers for POST method.\n        // Receiving ArrayBuffers happens via Blobs, instead.\n      } else {\n        throw new Error('unsupported BodyInit type')\n      }\n\n      if (!this.headers.get('content-type')) {\n        if (typeof body === 'string') {\n          this.headers.set('content-type', 'text/plain;charset=UTF-8')\n        } else if (this._bodyBlob && this._bodyBlob.type) {\n          this.headers.set('content-type', this._bodyBlob.type)\n        } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n          this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n        }\n      }\n    }\n\n    if (support.blob) {\n      this.blob = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return Promise.resolve(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as blob')\n        } else {\n          return Promise.resolve(new Blob([this._bodyText]))\n        }\n      }\n\n      this.arrayBuffer = function() {\n        return this.blob().then(readBlobAsArrayBuffer)\n      }\n\n      this.text = function() {\n        var rejected = consumed(this)\n        if (rejected) {\n          return rejected\n        }\n\n        if (this._bodyBlob) {\n          return readBlobAsText(this._bodyBlob)\n        } else if (this._bodyFormData) {\n          throw new Error('could not read FormData body as text')\n        } else {\n          return Promise.resolve(this._bodyText)\n        }\n      }\n    } else {\n      this.text = function() {\n        var rejected = consumed(this)\n        return rejected ? rejected : Promise.resolve(this._bodyText)\n      }\n    }\n\n    if (support.formData) {\n      this.formData = function() {\n        return this.text().then(decode)\n      }\n    }\n\n    this.json = function() {\n      return this.text().then(JSON.parse)\n    }\n\n    return this\n  }\n\n  // HTTP methods whose capitalization should be normalized\n  var methods = ['DELETE', 'GET', 'HEAD', 'OPTIONS', 'POST', 'PUT']\n\n  function normalizeMethod(method) {\n    var upcased = method.toUpperCase()\n    return (methods.indexOf(upcased) > -1) ? upcased : method\n  }\n\n  function Request(input, options) {\n    options = options || {}\n    var body = options.body\n    if (Request.prototype.isPrototypeOf(input)) {\n      if (input.bodyUsed) {\n        throw new TypeError('Already read')\n      }\n      this.url = input.url\n      this.credentials = input.credentials\n      if (!options.headers) {\n        this.headers = new Headers(input.headers)\n      }\n      this.method = input.method\n      this.mode = input.mode\n      if (!body) {\n        body = input._bodyInit\n        input.bodyUsed = true\n      }\n    } else {\n      this.url = input\n    }\n\n    this.credentials = options.credentials || this.credentials || 'omit'\n    if (options.headers || !this.headers) {\n      this.headers = new Headers(options.headers)\n    }\n    this.method = normalizeMethod(options.method || this.method || 'GET')\n    this.mode = options.mode || this.mode || null\n    this.referrer = null\n\n    if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n      throw new TypeError('Body not allowed for GET or HEAD requests')\n    }\n    this._initBody(body)\n  }\n\n  Request.prototype.clone = function() {\n    return new Request(this)\n  }\n\n  function decode(body) {\n    var form = new FormData()\n    body.trim().split('&').forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n    return form\n  }\n\n  function headers(xhr) {\n    var head = new Headers()\n    var pairs = (xhr.getAllResponseHeaders() || '').trim().split('\\n')\n    pairs.forEach(function(header) {\n      var split = header.trim().split(':')\n      var key = split.shift().trim()\n      var value = split.join(':').trim()\n      head.append(key, value)\n    })\n    return head\n  }\n\n  Body.call(Request.prototype)\n\n  function Response(bodyInit, options) {\n    if (!options) {\n      options = {}\n    }\n\n    this.type = 'default'\n    this.status = options.status\n    this.ok = this.status >= 200 && this.status < 300\n    this.statusText = options.statusText\n    this.headers = options.headers instanceof Headers ? options.headers : new Headers(options.headers)\n    this.url = options.url || ''\n    this._initBody(bodyInit)\n  }\n\n  Body.call(Response.prototype)\n\n  Response.prototype.clone = function() {\n    return new Response(this._bodyInit, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: new Headers(this.headers),\n      url: this.url\n    })\n  }\n\n  Response.error = function() {\n    var response = new Response(null, {status: 0, statusText: ''})\n    response.type = 'error'\n    return response\n  }\n\n  var redirectStatuses = [301, 302, 303, 307, 308]\n\n  Response.redirect = function(url, status) {\n    if (redirectStatuses.indexOf(status) === -1) {\n      throw new RangeError('Invalid status code')\n    }\n\n    return new Response(null, {status: status, headers: {location: url}})\n  }\n\n  self.Headers = Headers\n  self.Request = Request\n  self.Response = Response\n\n  self.fetch = function(input, init) {\n    return new Promise(function(resolve, reject) {\n      var request\n      if (Request.prototype.isPrototypeOf(input) && !init) {\n        request = input\n      } else {\n        request = new Request(input, init)\n      }\n\n      var xhr = new XMLHttpRequest()\n\n      function responseURL() {\n        if ('responseURL' in xhr) {\n          return xhr.responseURL\n        }\n\n        // Avoid security warnings on getResponseHeader when not allowed by CORS\n        if (/^X-Request-URL:/m.test(xhr.getAllResponseHeaders())) {\n          return xhr.getResponseHeader('X-Request-URL')\n        }\n\n        return\n      }\n\n      xhr.onload = function() {\n        var options = {\n          status: xhr.status,\n          statusText: xhr.statusText,\n          headers: headers(xhr),\n          url: responseURL()\n        }\n        var body = 'response' in xhr ? xhr.response : xhr.responseText\n        resolve(new Response(body, options))\n      }\n\n      xhr.onerror = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.ontimeout = function() {\n        reject(new TypeError('Network request failed'))\n      }\n\n      xhr.open(request.method, request.url, true)\n\n      if (request.credentials === 'include') {\n        xhr.withCredentials = true\n      }\n\n      if ('responseType' in xhr && support.blob) {\n        xhr.responseType = 'blob'\n      }\n\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n\n      xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n    })\n  }\n  self.fetch.polyfill = true\n})(typeof self !== 'undefined' ? self : this);\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/whatwg-fetch/fetch.js\n// module id = 2\n// module chunks = 0\n//# sourceURL=webpack:///./~/whatwg-fetch/fetch.js?");

}])})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(4),l=r(u),c=n(1),h={MSG:"msg",FIN:"fin"},f={MSG:"msg",ERR:"err",FIN:"fin",ACK:"ack"},d={DEFAULT:"/",AUTH:"/auth"},p=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!e)throw new Error("url is required for chat");return r._auth=n,r._socket=new l["default"](e,"livelyWebsocket",{automaticOpen:!1,reconnectOnError:!0,reconnectOnCleanClose:!0,randomRatio:!1}),r._retries=[0,200,1e3,2e3],r._retry=0,r.ready=!1,r.authed=!1,r._socket.onopen=function(){r._auth&&r._authenticate()},r._socket.onclose=function(e){r.emit("disconnect"),r.ready=!1,r.authed=!1,1003===e.code&&(r._socket._options.reconnectOnCleanClose=!1,r._socket._options.reconnectOnError=!1,r._socket.close(),r.emit("error",new Error("Requested room does not exist")))},r._socket.onmessage=function(e){r._onmessage(e)},r._socket.open(),r}return s(t,e),a(t,[{key:"destroy",value:function(){this._socket._options.reconnectOnCleanClose=!1,this._socket._options.reconnectOnError=!1,this._socket.close()}},{key:"_authenticate",value:function(){var e=this;this._auth.request(function(t,n){return t?void e.emit("error",t):(e._send(e._socket,h.MSG,d.AUTH,n),void e.once("_authed",function(t){return t?void e.emit("unauthorized"):void 0}))})}},{key:"_send",value:function(e,t,n,r){if(e&&e.readyState===e.OPEN){var o=t+" "+n+" "+r;this._socket.send(o)}}},{key:"_onmessage",value:function(e){var t=e.data;if(t){var n=t.indexOf(" "),r=t.indexOf(" ",n+1),o=t.slice(0,n),i=t.slice(n+1,r),s=t.slice(r+1);if(o===f.MSG){var a=void 0;try{a=JSON.parse(s)}catch(u){return void this.emit("error",u)}return void this.emit("message",a)}return this.ready||o!==f.ACK||i!==d.DEFAULT||(this.emit("ready"),this.ready=!0,this._auth||this.emit("unauthorized")),this.authed||o!==f.FIN?o===f.ERR?void this.emit("error",new Error(s)):void 0:void(i===d.AUTH&&(this.emit("_authed"),this.authed=!0))}}}]),t}(c.EventEmitter);t["default"]=p},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return Math.random()*(t-e)+e}Object.defineProperty(t,"__esModule",{value:!0});var i=n(5),s=r(i),a=n(42),u=r(a),l={debug:!1,automaticOpen:!0,reconnectOnError:!1,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,randomRatio:3,binaryType:"blob",reconnectOnCleanClose:!1},c=function h(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];u["default"](this,h),this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this.CLOSED=3,this.open=function(){var e=t._socket=new WebSocket(t._url,t._protocols);e.binaryType=t._options.binaryType,t._options.maxReconnectAttempts&&t._options.maxReconnectAttempts<t._reconnectAttempts||(t._syncState(),e.onmessage=t._onmessage.bind(t),e.onopen=t._onopen.bind(t),e.onclose=t._onclose.bind(t),e.onerror=t._onerror.bind(t))},this.send=function(e){t._socket&&t._socket.readyState===WebSocket.OPEN&&0===t._messageQueue.length?t._socket.send(e):t._messageQueue.push(e)},this.close=function(e,n){"undefined"==typeof e&&(e=1e3),t._socket&&t._socket.close(e,n)},this._onmessage=function(e){t.onmessage&&t.onmessage(e)},this._onopen=function(e){t._syncState(),t._flushQueue(),t._reconnectAttempts=0,t.onopen&&t.onopen(e)},this._onclose=function(e){t._syncState(),t._debug("WebSocket: connection is broken",e),t.onclose&&t.onclose(e),t._tryReconnect(e)},this._onerror=function(e){t._socket.close(),t._debug("WebSocket: error",e),t.onerror&&t.onerror(e),t._options.reconnectOnError&&t._tryReconnect(e)},this._tryReconnect=function(e){(!e.wasClean||t._options.reconnectOnCleanClose)&&setTimeout(function(){(t.readyState===t.CLOSING||t.readyState===t.CLOSED)&&(t._reconnectAttempts++,t.open())},t._getTimeout())},this._flushQueue=function(){for(;0!==t._messageQueue.length;){var e=t._messageQueue.shift();t._socket.send(e)}},this._getTimeout=function(){var e=t._options.reconnectInterval*Math.pow(t._options.reconnectDecay,t._reconnectAttempts);return e=e>t._options.maxReconnectInterval?t._options.maxReconnectInterval:e,t._options.randomRatio?o(e/t._options.randomRatio,e):e},this._syncState=function(){t.readyState=t._socket.readyState},this._url=e,this._protocols=n,this._options=s["default"]({},l,r),this._messageQueue=[],this._reconnectAttempts=0,this.readyState=this.CONNECTING,this._debug="function"==typeof this._options.debug?this._options.debug:this._options.debug?console.log.bind(console):function(){},r.automaticOpen&&this.open()};t["default"]=c,e.exports=t["default"]},function(e,t,n){e.exports={"default":n(6),__esModule:!0}},function(e,t,n){n(7),e.exports=n(10).Object.assign},function(e,t,n){var r=n(8);r(r.S+r.F,"Object",{assign:n(23)})},function(e,t,n){var r=n(9),o=n(10),i=n(11),s=n(13),a="prototype",u=function(e,t,n){var l,c,h,f=e&u.F,d=e&u.G,p=e&u.S,m=e&u.P,v=e&u.B,_=e&u.W,y=d?o:o[t]||(o[t]={}),b=y[a],g=d?r:p?r[t]:(r[t]||{})[a];d&&(n=t);for(l in n)c=!f&&g&&void 0!==g[l],c&&l in y||(h=c?g[l]:n[l],y[l]=d&&"function"!=typeof g[l]?n[l]:v&&c?i(h,r):_&&g[l]==h?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[a]=e[a],t}(h):m&&"function"==typeof h?i(Function.call,h):h,m&&((y.virtual||(y.virtual={}))[l]=h,e&u.R&&b&&!b[l]&&s(b,l,h)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},function(e){var t=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=t)},function(e,t,n){var r=n(12);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},function(e){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){var r=n(14),o=n(22);e.exports=n(18)?function(e,t,n){return r.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){var r=n(15),o=n(17),i=n(21),s=Object.defineProperty;t.f=n(18)?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),o)try{return s(e,t,n)}catch(a){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(16);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports=!n(18)&&!n(19)(function(){return 7!=Object.defineProperty(n(20)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){e.exports=!n(19)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e){e.exports=function(e){try{return!!e()}catch(t){return!0}}},function(e,t,n){var r=n(16),o=n(9).document,i=r(o)&&r(o.createElement);e.exports=function(e){return i?o.createElement(e):{}}},function(e,t,n){var r=n(16);e.exports=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){"use strict";var r=n(24),o=n(39),i=n(40),s=n(41),a=n(28),u=Object.assign;e.exports=!u||n(19)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e){for(var t=s(e),n=arguments.length,u=1,l=o.f,c=i.f;n>u;)for(var h,f=a(arguments[u++]),d=l?r(f).concat(l(f)):r(f),p=d.length,m=0;p>m;)c.call(f,h=d[m++])&&(t[h]=f[h]);return t}:u},function(e,t,n){var r=n(25),o=n(38);e.exports=Object.keys||function(e){return r(e,o)}},function(e,t,n){var r=n(26),o=n(27),i=n(31)(!1),s=n(35)("IE_PROTO");e.exports=function(e,t){var n,a=o(e),u=0,l=[];for(n in a)n!=s&&r(a,n)&&l.push(n);for(;t.length>u;)r(a,n=t[u++])&&(~i(l,n)||l.push(n));return l}},function(e){var t={}.hasOwnProperty;e.exports=function(e,n){return t.call(e,n)}},function(e,t,n){var r=n(28),o=n(30);e.exports=function(e){return r(o(e))}},function(e,t,n){var r=n(29);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e){var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},function(e){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(27),o=n(32),i=n(34);e.exports=function(e){return function(t,n,s){var a,u=r(t),l=o(u.length),c=i(s,l);if(e&&n!=n){for(;l>c;)if(a=u[c++],a!=a)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},function(e,t,n){var r=n(33),o=Math.min;e.exports=function(e){return e>0?o(r(e),9007199254740991):0}},function(e){var t=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:t)(e)}},function(e,t,n){var r=n(33),o=Math.max,i=Math.min;e.exports=function(e,t){return e=r(e),0>e?o(e+t,0):i(e,t)}},function(e,t,n){var r=n(36)("keys"),o=n(37);e.exports=function(e){return r[e]||(r[e]=o(e))}},function(e,t,n){var r=n(9),o="__core-js_shared__",i=r[o]||(r[o]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e){var t=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+n).toString(36))}},function(e){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var r=n(30);e.exports=function(e){return Object(r(e))}},function(e,t){"use strict";t.__esModule=!0,t["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var u=n(1),l=n(45),c=r(l),h=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(r._auth=n,!e)throw new Error("url is required for a command");return r._url=e,r._stopped=!0,r._connectionID=c["default"](),r._isConnected=!1,r._retry=0,r._retries=[0,300,1e3],r._run(),r}return s(t,e),a(t,[{key:"destroy",value:function(){this._stopped=!0}},{key:"_retryRun",value:function(e){var t=this;return e?(this._retry=0,void this._run()):(this._retry<this._retries.length-1&&this._retry++,void setTimeout(function(){t._run()},this._retries[this._retry]))}},{key:"_run",value:function(){var e=this;return this._auth?void this._auth.request(function(t,n){return t?void e._disconnected(t):void e._request(n)}):void this._request()}},{key:"_request",value:function(e){var t=this,n={Accept:"application/json","Content-Type":"application/json"};e&&(n.Authorization="Bearer "+e),fetch(this._url+"?cid="+this._connectionID,{method:"GET",headers:n}).then(function(e){if(200===e.status)return e.json();if(401===e.status){t._auth.refreshToken();var n=new Error("chat: unauthorized");throw n.retry=!0,n}if(503===e.status){var r=new Error("chat: server unavailable");throw r.retry=!0,r}if(404===e.status)throw new Error("Room does not exist");if(403===e.status)throw t.emit("unauthorized"),new Error("chat: forbidden");if(409===e.status){t._connectionID=c["default"]();var o=new Error("chat: connection id conflict");throw o.ignore=!0,o.retry=!0,o}throw new Error("non 200 response")}).then(function(e){t._connected();for(var n=0;n<e.length;n++)t.emit("message",e[n]);t._stopped||t._retryRun(!0)})["catch"](function(e){t._disconnected(e),e.retry&&(t._stopped||t._retryRun())})}},{key:"_disconnected",value:function(e){e&&(e.ignore||this.emit("error",e)),this._isConnected&&(this.emit("disconnect"),this._isConnected=!1)}},{key:"_connected",value:function(){this._isConnected||(this.emit("ready"),this._isConnected=!0)}}]),t}(u.EventEmitter);t["default"]=h},function(){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function n(e){return"string"!=typeof e&&(e=String(e)),e}function r(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return m.iterable&&(t[Symbol.iterator]=function(){return t}),t}function o(e){this.map={},e instanceof o?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function i(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function s(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function a(e){var t=new FileReader;return t.readAsArrayBuffer(e),s(t)}function u(e){var t=new FileReader;return t.readAsText(e),s(t)}function l(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,"string"==typeof e)this._bodyText=e;else if(m.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(m.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(e){if(!m.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):m.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},m.blob?(this.blob=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(a)},this.text=function(){var e=i(this);if(e)return e;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var e=i(this);return e?e:Promise.resolve(this._bodyText)},m.formData&&(this.formData=function(){return this.text().then(f)}),this.json=function(){return this.text().then(JSON.parse)},this}function c(e){var t=e.toUpperCase();return v.indexOf(t)>-1?t:e}function h(e,t){t=t||{};var n=t.body;if(h.prototype.isPrototypeOf(e)){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new o(e.headers)),this.method=e.method,this.mode=e.mode,n||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=e;if(this.credentials=t.credentials||this.credentials||"omit",(t.headers||!this.headers)&&(this.headers=new o(t.headers)),this.method=c(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function f(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(o))}}),t}function d(e){var t=new o,n=(e.getAllResponseHeaders()||"").trim().split("\n");return n.forEach(function(e){var n=e.trim().split(":"),r=n.shift().trim(),o=n.join(":").trim();t.append(r,o)}),t}function p(e,t){t||(t={}),this.type="default",this.status=t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText,this.headers=t.headers instanceof o?t.headers:new o(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var m={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};o.prototype.append=function(e,r){e=t(e),r=n(r);var o=this.map[e];o||(o=[],this.map[e]=o),o.push(r)},o.prototype["delete"]=function(e){delete this.map[t(e)]},o.prototype.get=function(e){var n=this.map[t(e)];return n?n[0]:null},o.prototype.getAll=function(e){return this.map[t(e)]||[]},o.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},o.prototype.set=function(e,r){this.map[t(e)]=[n(r)]},o.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){e.call(t,r,n,this)},this)},this)},o.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),r(e)},o.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),r(e)},o.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),r(e)},m.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];h.prototype.clone=function(){return new h(this)},l.call(h.prototype),l.call(p.prototype),p.prototype.clone=function(){return new p(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},p.error=function(){var e=new p(null,{status:0,statusText:""});return e.type="error",e};var _=[301,302,303,307,308];p.redirect=function(e,t){if(-1===_.indexOf(t))throw new RangeError("Invalid status code");return new p(null,{status:t,headers:{location:e}})},e.Headers=o,e.Request=h,e.Response=p,e.fetch=function(e,t){return new Promise(function(n,r){function o(){return"responseURL"in s?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):void 0}var i;i=h.prototype.isPrototypeOf(e)&&!t?e:new h(e,t);var s=new XMLHttpRequest;s.onload=function(){var e={status:s.status,statusText:s.statusText,headers:d(s),url:o()},t="response"in s?s.response:s.responseText;n(new p(t,e))},s.onerror=function(){r(new TypeError("Network request failed"))},s.ontimeout=function(){r(new TypeError("Network request failed"))},s.open(i.method,i.url,!0),"include"===i.credentials&&(s.withCredentials=!0),"responseType"in s&&m.blob&&(s.responseType="blob"),i.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send("undefined"==typeof i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});for(var n=new Array(16),r=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n},o=function(e,t){var n=t||0,r=i;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]},i=[],s={},a=0;256>a;a++)i[a]=(a+256).toString(16).substr(1),s[i[a]]=a;var u=function(){var e=r();return e[6]=15&e[6]|64,e[8]=63&e[8]|128,o(e)};t["default"]=u},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var i=function(){function e(t,n){if(r(this,e),!t)throw new Error("auth is required for a command");if(this._auth=t,!n)throw new Error("url is required for a command");this._url=n,this._retries=[0,300,1e3]}return o(e,[{key:"run",value:function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!e)return void r(new Error("command is required for a command"));var o=-1,t=function i(){n._auth.request(function(t,s){return t?void r(t):void fetch(n._url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s},body:JSON.stringify({command:e})}).then(function(e){if(e.status>=200&&e.status<300)return 204===e.status?null:e.json();if(401===e.status){n._auth.refreshToken();var t=new Error("chat: unauthorized");throw t.retry=!0,t}if(503===e.status){var r=new Error("chat: server unavailable");throw r.retry=!0,r}if(403===e.status)throw new Error("chat: forbidden");if(e.status>=400&&e.status<500)return e.json();throw new Error("chat: non-200 response code from chat server")}).then(function(e){return e&&e.messages?void r(null,e.messages):void r()})["catch"](function(e){if(e.retry&&o<n._retries.length-1){o++;var t=n._retries[o];return t?void setTimeout(i,t):void i()}r(e)})})};t()}}]),e}();t["default"]=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var i={INDEX:"index",TYPE:"type",NESTED_ITEMS:"nestedItems"},s={KEY:"key",VARS:"vars"},a={NESTED_DATA_ARRAY:"nestedDataArray",NESTED_ARRAY:"nestedArray",NESTED_OBJECT:"nestedObject",TEMPLATE:"template",INT_ARRAY:"intArray",STRING_ARRAY:"stringArray",STRING:"string",INT:"int",BOOL:"bool"},u={emoticons:"emoticon",links:"link",mentions:"mention",tags:"tag"},l=function(){function e(t){if(r(this,e),!t)throw new Error("url is required for parser");this._baseUrl=t,this._manifests={},this._buffer={},this._fetchingManifests={}}return o(e,[{key:"parseMessage",value:function(e,t){var n=this;e&&e instanceof Array&&!(e.length<2)||t(new Error("Invalid data format"));var r=e[0],o=e[1];this._parseMessage(r,o,function(e,o){return e?void t(e):("HISTORY"===r&&o.messages.length&&o.messages.forEach(function(e,t){n._parseMessage("SAY",e,function(e,n){e||(o.messages[t]=n)})}),void t(null,r,o))})}},{key:"_addManifest",value:function(e){this._manifests[e.version]=e}},{key:"_parseMessage",value:function(e,t,n){var r=this,o=t[0],i=void 0;return this._manifests[o]?this._manifests[o].manifests[e]?(i=this._parse(o,this._manifests[o].manifests[e],t),void n(null,i)):void n(new Error("manifest does not have "+e+" command")):(this._buffer[o]?this._buffer[o].push([t,e,n]):this._buffer[o]=[[t,e,n]],void(this._fetchingManifests[o]!==!0&&(this._fetchingManifests[o]=!0,fetch(this._baseUrl+"/"+o).then(function(e){if(200!==e.status)throw new Error("chat: non-200 response code from chat server");return e.json()}).then(function(e){for(r._addManifest(e);r._buffer[e.version].length>0;){var t=r._buffer[e.version].shift();i=r._parse(e.version,e.manifests[t[1]],t[0]),t[2](null,i)}})["catch"](function(e){r._buffer[o]=[],n(e)}))))}},{key:"_parse",value:function(e,t,n){for(var r=this,o={},l=Object.keys(t),c=function(c){var h=l[c],f=t[h],d=n[f[i.INDEX]];if(null===d)return o[h]=null,"continue";var p=void 0;switch(f[i.TYPE]){case a.NESTED_ARRAY:p=[];for(var m=0;m<d.length;m++)p.push(r._parse(e,f[i.NESTED_ITEMS],d[m]));break;case a.NESTED_OBJECT:p=r._parse(e,f[i.NESTED_ITEMS],d);break;case a.TEMPLATE:p=r._parseTemplate(e,d[f[i.NESTED_ITEMS][s.KEY].index],d[f[i.NESTED_ITEMS][s.VARS].index]);break;default:p=d}p&&p instanceof Array&&p.forEach(function(e){var t=e;t.positions&&t.positions instanceof Array&&t.positions.forEach(function(e){u[h]&&(t.type=u[h],o.positions||(o.positions={}),o.positions[e]=t)})}),o[h]=p},h=0;h<l.length;h++){{c(h)}}return o}},{key:"_parseTemplate",value:function(e,t,n){var r=new c(this._manifests[e].templates[t],n);return r.getParsed()}}]),e}(),c=function(){function e(t,n){return r(this,e),this._parsed="",n&&0!==n.length?void(t&&0!==t.length&&(this._parsed="",this._varPos=0,this._curr="",this._template=t,this._templateLength=t.length,this._vars=n,this._next=this._startState.bind(this),this._pos=0,this._skipNext=!1)):void(this._parsed=t)}return o(e,[{key:"getParsed",value:function(){if(this._parsed)return this._parsed;for(var e=0;e<this._templateLength;e++)this._skipNext?this._skipNext=!1:(this._pos=e,this._curr=this._template[e],this._next=this._next().bind(this));return this._parsed}},{key:"_startDelim",value:function(){return this._pos>=this._templateLength-1?!1:"{"===this._curr&&"{"===this._template[this._pos+1]?(this._skipNext=!0,!0):!1}},{key:"_endDelim",value:function(){return this._pos>=this._templateLength-1?!1:"}"===this._curr&&"}"===this._template[this._pos+1]?(this._skipNext=!0,!0):!1}},{key:"_startState",value:function(){return this._startDelim()?this._midState:(this._parsed+=this._curr,this._startState)}},{key:"_midState",value:function(){return"n"===this._curr?this._endState:(this._parsed=this._parsed+"{{"+this._curr,this._startState)}},{key:"_endState",value:function(){return this._endDelim()?(this._parsed+=this._vars[this._varPos],this._varPos++):this._parsed+=this._curr,this._startState}}]),e}();t["default"]=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var i=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r(this,e),!t)throw new Error("url is required for a roster request");this._url=t,this._nextParams="",this._options=n,this._retries=[0,300,1e3]}return o(e,[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=this._url+"?";this._options.limit&&(t=t+"limit="+this._options.limit+"&"),this._options.role&&(t=t+"role="+this._options.role+"&"),this._request(t,e)}},{key:"next",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._nextParams){var t=this._url+"?"+this._nextParams;return void this._request(t,e)}e(null,[])}},{key:"_request",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=-1,o=function i(){fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(function(e){if(200===e.status)return e.json();if(503===e.status){var t=new Error("chat: server unavailable");throw t.retry=!0,t}if(403===e.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(e){t._nextParams=e&&e._links&&e._links.next&&e._links.next.href?e._links.next.href.split("?")[1]:"",n(null,e.users)})["catch"](function(e){if(e.retry&&r<t._retries.length-1){r++;var o=t._retries[r];return o?void setTimeout(i,o):void i()}n(e)})};o()}}]),e}();t["default"]=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var i=function(){function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(r(this,e),!t)throw new Error("auth is required for a changerole request");if(this._auth=t,!n)throw new Error("url is required for a changerole request");this._url=n,this._nextParams="",this._options=o,this._retries=[0,300,1e3]}return o(e,[{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=this._url+"?";this._options.limit&&(t=t+"limit="+this._options.limit+"&"),this._request(t,e)}},{key:"next",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};if(this._nextParams){var t=this._url+"?"+this._nextParams;return void this._request(t,e)}e(null,[])}},{key:"_request",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},r=-1,o=function i(){t._auth.request(function(o,s){return o?void n(o):void fetch(e,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+s}}).then(function(e){if(200===e.status)return e.json();if(401===e.status){var t=new Error("chat: unauthorized");throw t.retry=!0,t}if(503===e.status){var n=new Error("chat: server unavailable");throw n.retry=!0,n}if(403===e.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(e){t._nextParams=e&&e._links&&e._links.next&&e._links.next.href?e._links.next.href.split("?")[1]:"",n(null,e.changeroles)})["catch"](function(e){if(e.retry&&r<t._retries.length-1){r++;var o=t._retries[r];return o?void setTimeout(i,o):void i()}n(e)})})};o()}}]),e}();t["default"]=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(44);var i=function(){function e(t){if(r(this,e),!t)throw new Error("auth is required for an http request");this._auth=t,this._retries=[0,300,1e3]}return o(e,[{key:"execGet",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!e)throw new Error("url is required for an http request");

this._execute("GET",e,null,t)}},{key:"execPut",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!e)throw new Error("url is required for an http request");this._execute("PUT",e,t,n)}},{key:"execPost",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!e)throw new Error("url is required for an http request");this._execute("POST",e,t,n)}},{key:"execPatch",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!e)throw new Error("url is required for an http request");this._execute("PATCH",e,t,n)}},{key:"execDelete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(!e)throw new Error("url is required for an http request");this._execute("DELETE",e,t)}},{key:"_execute",value:function(e,t,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},i={method:e,headers:{Accept:"application/json","Content-Type":"application/json"}};n&&(i.body=JSON.stringify(n));var s=-1,a=function u(){r._auth.request(function(e,n){return e?void o(e):(i.headers.Authorization="Bearer "+n,void fetch(t,i).then(function(e){if(e.status>=200&&e.status<300)return e.json();if(401===e.status){var t=new Error("chat: unauthorized");throw t.retry=!0,t}if(503===e.status){var n=new Error("chat: server unavailable");throw n.retry=!0,n}if(403===e.status)throw new Error("chat: forbidden");throw new Error("chat: non-200 response code from chat server")}).then(function(e){o(null,e)})["catch"](function(e){if(e.retry&&s<r._retries.length-1){s++;var t=r._retries[s];return t?void setTimeout(u,t):void u()}o(e)}))})};a()}}]),e}();t["default"]=i}])})},{}],2:[function(e,t,n){!function(e,r){"object"==typeof n&&"object"==typeof t?t.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof n?n.LivelyLocales=r():e.LivelyLocales=r()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(t){if("object"!==("undefined"==typeof t?"undefined":i(t)))throw new Error("Lively Localization instantiated with something other than a messages object",{messages:t});return new l(e,t)}return e&&u[e]?u[e]:h}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a={},u={},l=function(){function e(t,n){return r(this,e),t&&a[t]||n?(this.data=a[t]||{},void(n&&Object.assign(this.data,n))):void(this.localize=function(e){return e})}return s(e,[{key:"localize",value:function(e){var t=void 0;return(t=this.data[e])?t:e}}]),e}(),c=n(1);c.keys().forEach(function(e){var t=e.split("/");3===t.length&&(a[t[1]]||(a[t[1]]={}),a[t[1]]=Object.assign(a[t[1]],c(e)))});var h=new l;Object.keys(a).forEach(function(e){u[e]=new l(e)}),t["default"]=o,e.exports=t["default"]},function(e){function t(e){throw new Error("Cannot find module '"+e+"'.")}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=1}])})},{}],3:[function(){"document"in window.self&&("classList"in document.createElement("_")&&(!document.createElementNS||"classList"in document.createElementNS("http://www.w3.org/2000/svg","g"))?!function(){"use strict";var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var n,r=arguments.length;for(n=0;r>n;n++)e=arguments[n],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:n.call(this,e)}}e=null}():!function(e){"use strict";if("Element"in e){var t="classList",n="prototype",r=e.Element[n],o=Object,i=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},s=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},a=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},u=function(e,t){if(""===t)throw new a("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new a("INVALID_CHARACTER_ERR","String contains an invalid character");return s.call(e,t)},l=function(e){for(var t=i.call(e.getAttribute("class")||""),n=t?t.split(/\s+/):[],r=0,o=n.length;o>r;r++)this.push(n[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},c=l[n]=[],h=function(){return new l(this)};if(a[n]=Error[n],c.item=function(e){return this[e]||null},c.contains=function(e){return e+="",-1!==u(this,e)},c.add=function(){var e,t=arguments,n=0,r=t.length,o=!1;do e=t[n]+"",-1===u(this,e)&&(this.push(e),o=!0);while(++n<r);o&&this._updateClassName()},c.remove=function(){var e,t,n=arguments,r=0,o=n.length,i=!1;do for(e=n[r]+"",t=u(this,e);-1!==t;)this.splice(t,1),i=!0,t=u(this,e);while(++r<o);i&&this._updateClassName()},c.toggle=function(e,t){e+="";var n=this.contains(e),r=n?t!==!0&&"remove":t!==!1&&"add";return r&&this[r](e),t===!0||t===!1?t:!n},c.toString=function(){return this.join(" ")},o.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{o.defineProperty(r,t,f)}catch(d){-2146823252===d.number&&(f.enumerable=!1,o.defineProperty(r,t,f))}}else o[n].__defineGetter__&&r.__defineGetter__(t,h)}}(window.self))},{}],4:[function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,a,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],s(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(i(n))for(a=Array.prototype.slice.call(arguments,1),l=n.slice(),o=l.length,u=0;o>u;u++)l[u].apply(this,a);return!0},n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),o||(o=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var o=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,o,s,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(a=s;a-->0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=a;break}if(0>o)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/isBlurred.js"),a=r(s),u=e("../utils/createElement.js"),l=r(u),c=e("../utils/addEvent.js"),h=r(c),f=function(){function e(t,n,r,i){o(this,e),this.parent=t,this.chatBody=n,this.localize=r,this.options=i,this.closeFlyoutOnBlur=this.closeFlyoutOnBlur.bind(this),this.actionMuteHandler=this.actionMuteHandler.bind(this),this.actionIgnoreHandler=this.actionIgnoreHandler.bind(this),this.actionBanHandler=this.actionBanHandler.bind(this),this.actionModHandler=this.actionModHandler.bind(this),this.render(),this._blurEvent=h["default"](document,"click",this.closeFlyoutOnBlur),this._blurEventTouch=h["default"](document,"touchend",this.closeFlyoutOnBlur)}return i(e,[{key:"render",value:function(){this.flyout=l["default"]({tagName:"div",className:"chat__actions-flyout "+this.options.modifierClass}),this.parent.parentElement.appendChild(this.flyout);var e=l["default"]({tagName:"div",className:"chat__actions-flyout-username",text:this.options.username});if(this.flyout.appendChild(e),this.options.url){var t=l["default"]({tagName:"a",className:"chat__actions-flyout-button",text:this.localize("View"),attributes:{href:this.options.url}});this.flyout.appendChild(t)}(this.chatBody.isMod()||this.chatBody.isAdmin())&&(this.muteButton=l["default"]({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Mute"),events:{click:this.actionMuteHandler}}),this.flyout.appendChild(this.muteButton),this.banButton=l["default"]({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Ban IP"),events:{click:this.actionBanHandler}}),this.flyout.appendChild(this.banButton),this.ignoreButton=l["default"]({tagName:"button",className:"chat__actions-flyout-button",text:this.localize("Ignore"),events:{click:this.actionIgnoreHandler}}),this.flyout.appendChild(this.ignoreButton)),this.chatBody.isAdmin()&&(this.modButton=l["default"]({tagName:"button",className:"chat__actions-flyout-button",text:this.localize(this.options.role?"Unmod":"Mod"),events:{click:this.actionModHandler}}),this.flyout.appendChild(this.modButton))}},{key:"actionModHandler",value:function(){var e=this;return this.modButton.textContent===this.localize("Unmod")?void this.chatBody.unmodActionHandler(this.options.username,function(){e.modButton.textContent=e.localize("Mod")}):void this.chatBody.modActionHandler(this.options.username,function(){e.modButton.textContent=e.localize("Unmod")})}},{key:"actionMuteHandler",value:function(){return this.muteButton.textContent===this.localize("Unmute")?void this.chatBody.unmuteActionHandler(this.options.username):(this.chatBody.muteActionHandler(this.options.username),void(this.muteButton.textContent=this.localize("Unmute")))}},{key:"actionIgnoreHandler",value:function(){return this.ignoreButton.textContent===this.localize("Unignore")?void this.chatBody.unignoreActionHandler(this.options.username):(this.chatBody.ignoreActionHandler(this.options.username),void(this.ignoreButton.textContent=this.localize("Unignore")))}},{key:"actionBanHandler",value:function(){return this.banButton.textContent===this.localize("Unban IP")?void this.chatBody.unbanActionHandler(this.options.username):(this.chatBody.banActionHandler(this.options.username),void(this.banButton.textContent=this.localize("Unban IP")))}},{key:"closeFlyoutOnBlur",value:function(e){a["default"](e,this.flyout,this.parent)&&this.close()}},{key:"close",value:function(){this._blurEvent(),this._blurEventTouch(),this._closed=!0,this.flyout.parentElement.removeChild(this.flyout)}}]),e}();n["default"]=f},{"../utils/addEvent.js":18,"../utils/createElement.js":19,"../utils/isBlurred.js":21}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../utils/createElement.js"),l=r(u),c=e("./chat-flyout.js"),h=r(c),f=[{name:"rateLimitDuration",value:1,text:"1s"},{name:"rateLimitDuration",value:5,text:"5s"},{name:"rateLimitDuration",value:30,text:"30s"},{name:"rateLimitDuration",value:60,text:"1m"},{name:"rateLimitDuration",value:300,text:"5m"},{name:"rateLimitDuration",value:900,text:"15m"}],d=[{name:"rateLimitMax",value:1,text:"1 chat"},{name:"rateLimitMax",value:5,text:"5 chats"},{name:"rateLimitMax",value:10,text:"10 chats"}],p=[{name:"mode",value:"user",text:"Everyone"},{name:"mode",value:"moderator",text:"Moderators"},{name:"mode",value:"owner",text:"Owner"}],m=function(e){function t(e,n,r,s){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"admin",r("admin")));return a.parent=e,a.chat=n,a.localize=r,a.errorHandler=s,a.handleRadioChange=a.handleRadioChange.bind(a),a}return s(t,e),a(t,[{key:"initRoom",value:function(){this._roomData&&this.chat._me&&("moderator"===this.chat._me.room.role||"owner"===this.chat._me.room.role||"admin"===this.chat._me.room.role)&&(this.render(),this.enableFlyout())}},{key:"roomHandler",value:function(){this._roomData=!0}},{key:"render",value:function(){var e=l["default"]({tagName:"div",className:"chat__info chat__info--mode",text:this.localize("Chat Mode")});this.flyout.appendChild(e),this.radioRenderer(p);var t=l["default"]({tagName:"div",className:"chat__description chat__description--mode",text:this.localize("The current mode of the room specifying which users can chat")});this.flyout.appendChild(t);var n=l["default"]({tagName:"div",className:"chat__info",text:this.localize("Chat Rate Limit")});this.flyout.appendChild(n),this.radioRenderer(d),this.radioRenderer(f);var r=l["default"]({tagName:"div",className:"chat__description",text:this.localize("Maximum amount of chats during time period")});this.flyout.appendChild(r)}},{key:"radioRenderer",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=l["default"]({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:e[n].name,value:e[n].value,id:e[n].name+n},events:{change:this.handleRadioChange}});this.chat._room[e[n].name]===e[n].value&&(r.checked="checked"),t.push(r);var o=l["default"]({tagName:"label",className:"chat__radio-label chat__radio-label--"+e.length,text:this.localize(e[n].text),attributes:{"for":e[n].name+n}});t.push(o)}var i=l["default"]({tagName:"div",className:"chat__radio-slider chat__radio-slider--"+e.length});t.push(i);var s=l["default"]({tagName:"div",className:"chat__radio-wrapper",childs:t}),a=l["default"]({tagName:"div",className:"chat__radio-container chat__radio-container--restricted chat__radio-container--"+e[0].name,childs:[s]});this.flyout.appendChild(a)}},{key:"handleRadioChange",value:function(e){var t=this,n={};n[e.target.name]=isNaN(e.target.value)?e.target.value:parseInt(e.target.value,10),this.chat.patchRoom(this.chat._roomname,n,function(e,n){e&&n&&n[0]&&t.errorHandler(e,n[0])})}}]),t}(h["default"]);n["default"]=m},{"../utils/createElement.js":19,"./chat-flyout.js":10}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/createElement.js"),a=r(s),u=e("../utils/addEvent.js"),l=r(u),c=e("./chat-actions-flyout.js"),h=r(c),f=function(){function e(t,n,r,i,s){var a=this;o(this,e),this.parent=t,this.chat=n,this.localize=r,this.errorHandler=i,this.options=s,this._chatLineQueue=[],this._currentChunk=this.buildChunkElement(),this._currentChunkSize=0,this._chunkView=[],this._chunkHistory=[],this._chunkStorage=[],this._scrollLocked=!0,this._scrollPaused=!1,this._scrollThrottleCount=0,this._scrollThrottleRate=100,this._scrollThrottleNewRate=!1,this.scrollToggle=this.scrollToggle.bind(this),this.scrollWheelHandler=this.scrollWheelHandler.bind(this),this.actionDelete=this.actionDelete.bind(this),this.actionMore=this.actionMore.bind(this),this.render(),this._queueProcess=setInterval(function(){a.queueProcessor()},100),setTimeout(function(){a._scrollThrottleCount=0,a._scrollThrottleInterval=setInterval(function(){a.scrollThrottleHandler()},2e3)},500),this._wheelListener1=l["default"](this.chatBody,"DOMMouseScroll",this.scrollWheelHandler),this._wheelListener2=l["default"](this.chatBody,"mousewheel",this.scrollWheelHandler),this._wheelListener3=l["default"](this.chatBody,"wheel",this.scrollWheelHandler)}return i(e,[{key:"queueProcessor",value:function(){if(!this._scrollPaused){this._chatLineQueue.length&&this._scrollThrottleCount++;for(var e=document.createDocumentFragment();this._chatLineQueue.length&&this._currentChunkSize!==this.options.chunkSize;){var t=this._chatLineQueue.shift();e.appendChild(t),this._currentChunkSize++}if(this._currentChunk.appendChild(e),this._currentChunk.parentElement||this._chunkStorage.push(this._currentChunk),this._currentChunkSize===this.options.chunkSize&&(this._currentChunk=this.buildChunkElement(),this._currentChunksProcessed++,this._currentChunkSize=0),this._chatLineQueue.length)return void this.queueProcessor();for(var n=document.createDocumentFragment(),r=this._chunkStorage.splice(-Math.abs(this.options.chunkView));r.length;){var o=r.shift();n.appendChild(o),this._chunkView.push(o)}for(this.chatBody.appendChild(n);this._chunkView.length>this.options.chunkView;){var i=this._chunkView.shift();this.chatBody.removeChild(i),this._chunkHistory.unshift(i)}for(;this._chunkStorage.length;)this._chunkHistory.unshift(this._chunkStorage.shift());for(;this._chunkHistory>this.options.chunkHistory;)this._chunkHistory.shift();this.scrollBottom()}}},{key:"scrollThrottleHandler",value:function(){var e=this;switch(this._scrollThrottleNewRate&&(this._scrollThrottleNewRate=!1,this._scrollThrottleCount++),this._scrollThrottleRate){case 100:this._scrollThrottleCount>=10&&(this._scrollThrottleRate=200,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate));break;case 200:this._scrollThrottleCount>=10?(this._scrollThrottleRate=250,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate)):this._scrollThrottleCount<5&&(this._scrollThrottleRate=100,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate));break;default:this._scrollThrottleCount<8&&(this._scrollThrottleRate=200,this._scrollThrottleNewRate=!0,clearInterval(this._queueProcess),this._queueProcess=setInterval(function(){e.queueProcessor()},this._scrollThrottleRate))}this._scrollThrottleCount=0}},{key:"processChat",value:function(e){if(!e.ignore){var t=this.buildLineElement(),n=this.writeChatToLine(t,e);this._chatLineQueue.push(n)}}},{key:"processMessage",value:function(e){var t=this.buildLineElement(),n=this.writeMessageToLine(t,e);this._chatLineQueue.push(n)}},{key:"render",value:function(){this.chatBody=a["default"]({tagName:"div",className:"chat__body"}),this.chatBodyContainer=a["default"]({tagName:"div",className:"chat__body-container",childs:[this.chatBody]}),this.chatBodyScrollButton=a["default"]({tagName:"div",className:"chat__body-scroll",events:{click:this.scrollToggle}}),this.parent.appendChild(this.chatBodyContainer),this.parent.appendChild(this.chatBodyScrollButton)}},{key:"buildChunkElement",value:function(){return this._chunkElement?this._chunkElement.cloneNode():(this._chunkElement=a["default"]({tagName:"div",className:"chat__chunk"}),this._chunkElement.cloneNode(!0))}},{key:"buildLineElement",value:function(){if(this._lineElement)return this._lineElement.cloneNode(!0);var e=[],t=a["default"]({tagName:"div",className:"chat__avatar"});e.push(t);var n=a["default"]({tagName:"span",className:"chat__line-role"});e.push(n);var r=a["default"]({tagName:"span",className:"chat__username"});e.push(r);var o=a["default"]({tagName:"span",className:"chat__line-timestamp"});e.push(o);var i=a["default"]({tagName:"div",className:"chat__line-content"});e.push(i);var s=a["default"]({tagName:"button",className:"chat__action chat__action--delete",attributes:{"data-tooltip":"Delete Chat"}});e.push(s);var u=a["default"]({tagName:"button",className:"chat__action chat__action--more",attributes:{"data-tooltip":"More Actions"}});return e.push(u),this._lineElement=a["default"]({tagName:"div",className:"chat__line",childs:e}),this._lineElement.cloneNode(!0)}},{key:"writeChatToLine",value:function(e,t){var n=e,r=n.childNodes;return r[0].setAttribute("style","background-color: "+t.actor.color+"; background-image: url("+t.actor.avatar+");"),r[1].className="chat__line-role chat__line-role--"+t.actor.role,r[1].textContent=t.actor.role,r[2].setAttribute("style","color: "+t.actor.color),r[2].textContent=t.actor.username,r[3].textContent=this.formatDate(t.timestamp),r[4].innerHTML=this.parseChatText(t),n.className="chat__line"+(t.actor.username===this.chat._username?" chat__line--currentUser":""),n.setAttribute("data-username",t.actor.username),n.setAttribute("data-id",t.id),"moderator"===t.actor.role&&n.setAttribute("data-role",t.actor.role),t.url&&n.setAttribute("data-url",t.url),l["default"](r[5],"click",this.actionDelete),l["default"](r[6],"click",this.actionMore),n}},{key:"writeMessageToLine",value:function(e,t){var n=e,r=n.childNodes,o="";switch(t.level){case"warn":o="#EBC844";break;case"info":o="#1395BA";break;default:o="#D94E1F"}r[0].setAttribute("style","background-color: "+o+"; background-image: none;"),r[1].className="",r[1].textContent="",r[2].setAttribute("style","color: "+o),r[2].textContent=t.level,r[3].textContent="",r[4].innerHTML='<div class="chat__text">'+t.message+"</div>",n.className="chat__line chat__line--message chat__line--"+t.level;var i=function(e){e.parentElement.removeChild(e)}.bind(this,n);return l["default"](r[5],"click",i),n}},{key:"formatDate",value:function(e){var t=new Date(1e3*e),n="0"+t.getMinutes(),r=t.getHours();return r%=12,r=r||12,r+":"+n.substr(-2)}},{key:"parseChatText",value:function(e){var t="<div class='chat__text'>",n=e.message,r=e.positions,o=0;for(var i in r){i=parseInt(i,10);var s=n.slice(o,i),a=n.slice(i,i+r[i].length);switch(o=i+r[i].length,s.length&&(t+=s),r[i].type){case"emoticon":this.chat&&this.chat._me&&this.chat._me.showGifs,t+="<span class='chat__line-emoticon-wrap' data-pattern='"+a+"'><img class='chat__line-emoticon' src='"+r[i].url+"'/></span>";break;case"mention":var u=this.chat._username===r[i].username?"chat__line-mention chat__line-mention--me":"chat__line-mention";t+="<a class='"+u+"' href='/"+r[i].url+"' target='_blank'>"+a+"</a>";break;case"tag":t+="<a class='chat__line-tag' href='/tag/"+r[i].text+"' target='_blank'>"+a+"</a>";break;default:t+="<a class='chat__line-link' href='"+r[i].href+"' target='_blank'>"+a+"</a>"}}return o<n.length&&(t+=n.slice(o)),t+="</div>"}},{key:"scrollToggle",value:function(){return this._scrollPaused?(this._scrollPaused=!1,void this.chatBodyScrollButton.classList.remove("chat__body-scroll--paused")):(this._scrollPaused=!0,void this.chatBodyScrollButton.classList.add("chat__body-scroll--paused"))}},{key:"scrollBottom",value:function(){this.chatBody.scrollTop=this.chatBody.scrollHeight}},{key:"scrollWheelHandler",value:function(){if(this.chatBody.scrollTop<=0&&this._scrollPaused&&this._chunkHistory.length){var e=this._chunkHistory.shift();return this.chatBody.insertBefore(e,this.chatBody.firstChild),void this._chunkView.unshift(e)}return Math.abs(this.chatBody.scrollTop-(this.chatBody.scrollHeight-this.chatBody.offsetHeight))<=5?void(this._scrollPaused&&this.scrollToggle()):void(this._scrollPaused||this.scrollToggle())}},{key:"isMod",value:function(){return this.chat._me&&this.chat._me.room&&this.chat._me.room.role?"moderator"===this.chat._me.room.role:!1}},{key:"isAdmin",value:function(){return this.chat._me&&this.chat._me.room&&this.chat._me.room.role?"owner"===this.chat._me.room.role||"admin"===this.chat._me.room.role:!1}},{key:"actionDelete",value:function(e){var t=e.target.parentElement.getAttribute("data-id");this.chat.command("/delete "+t)}},{key:"actionMore",value:function(e){var t={username:e.target.parentElement.getAttribute("data-username"),id:e.target.parentElement.getAttribute("data-id"),url:e.target.parentElement.getAttribute("data-url"),role:e.target.parentElement.getAttribute("data-role")};return this.flyout&&!this.flyout._closed&&t.id===this.flyout.options.id?(this.flyout.close(),void(this.flyout=!1)):void(this.flyout=new h["default"](e.target,this,this.localize,t))}},{key:"modActionHandler",value:function(e,t){var n=this;this.chat.command("/mod "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))})}},{key:"unmodActionHandler",value:function(e,t){var n=this;this.chat.command("/unmod "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))})}},{key:"muteActionHandler",value:function(e,t){var n=this;this.chat.command("/mute "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))}),this.deleteByUsername(e)}},{key:"unmuteActionHandler",value:function(e,t){var n=this;this.chat.command("/unmute "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))})}},{key:"ignoreActionHandler",value:function(e,t){var n=this;this.chat.command("/ignore "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))}),this.deleteByUsername(e,!0)}},{key:"unignoreActionHandler",value:function(e,t){var n=this;this.chat.command("/unignore "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))})}},{key:"banActionHandler",value:function(e,t){var n=this;this.chat.command("/ban "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))}),this.deleteByUsername(e)}},{key:"unbanActionHandler",value:function(e,t){var n=this;this.chat.command("/unban "+e,function(e,r){return e?void n.errorHandler(e,r[0]):(r&&r[0]&&n.errorHandler(e,r[0]),void(t&&t()))})}},{key:"deleteById",value:function(e){for(var t=0;t<this._chunkView.length;t++)for(var n=this._chunkView[t].childNodes,r=0;r<n.length;r++)if(n[r].getAttribute("data-id")===e){if(this.isMod||this.isAdmin)return void n[r].classList.add("chat__line--removed");n[r].parentElement.removeChild(n[r])}}},{key:"deleteByUsername",value:function(e,t){for(var n=0;n<this._chunkView.length;n++)for(var r=this._chunkView[n].childNodes,o=0;o<r.length;o++)if(r[o].getAttribute("data-username")===e){if(t)return void r[o].parentElement.removeChild(r[o]);this.actionDelete(r[o].getAttribute("data-id"))}}},{key:"destroy",value:function(){this._wheelListener1(),this._wheelListener2(),this._wheelListener3()}}]),e}();n["default"]=f},{"../utils/addEvent.js":18,"../utils/createElement.js":19,"./chat-actions-flyout.js":5}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/createElement.js"),a=r(s),u=function(){function e(t){o(this,e),this.parent=t,this.render()}return i(e,[{key:"render",value:function(){this.el=a["default"]({tagName:"div",className:"chat__controls"}),this.parent.appendChild(this.el)}}]),e}();n["default"]=u},{"../utils/createElement.js":19}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../utils/createElement.js"),l=r(u),c=e("./chat-flyout.js"),h=r(c),f=function(e){function t(e,n,r,s,a){o(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"emoticons",s("emoticons")));return u.parent=e,u.chat=n,u.chatInput=r,u.localize=s,u.errorHandler=a,u}return s(t,e),a(t,[{key:"initUser",value:function(){this.getEmoticons()}},{key:"getEmoticons",value:function(){
var e=this;this.chat.getAllEmoticons(this.chat._roomname,this.chat._username,function(t,n){t&&e.errorHandler(t,e.localize("Chat Error")),e.emoticons=n.emoticons,e.enableFlyout(),e.render()})}},{key:"render",value:function(){var e=this;Object.keys(this.emoticons).map(function(t){var n=e.emoticons[t],r=l["default"]({tagName:"button",className:"chat__emoticon-selector",attributes:{style:"background-image: url("+n.source+")",title:n.pattern}}),o=l["default"]({tagName:"span",className:"chat__emoticon-selector-container",childs:[r]}),i=e.selectEmoticon.bind(e,n.pattern);return o.addEventListener("click",i),e.flyout.appendChild(o)}),this.parent.appendChild(this.flyout);var t=l["default"]({tagName:"a",className:"chat__attribution-link",text:"EmojiOne",attributes:{href:"http://emojione.com"}}),n=l["default"]({tagName:"div",className:"chat__attribution",text:"Emoji provided free by ",childs:[t]});this.flyout.appendChild(n)}},{key:"selectEmoticon",value:function(e){this.chatInput.chatInput.value=""+this.chatInput.chatInput.value+e+" ",this.chatInput.chatInput.focus(),this.toggleFlyout()}}]),t}(h["default"]);n["default"]=f},{"../utils/createElement.js":19,"./chat-flyout.js":10}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/isBlurred.js"),a=r(s),u=e("../utils/createElement.js"),l=r(u),c=e("../utils/addEvent.js"),h=r(c),f=function(){function e(t,n,r){o(this,e),this.parent=t,this.flyoutClassModifier=n,this.tooltipText=r,this.toggleFlyout=this.toggleFlyout.bind(this),this.closeFlyoutOnBlur=this.closeFlyoutOnBlur.bind(this),this.flyoutRender()}return i(e,[{key:"flyoutRender",value:function(){var e=l["default"]({tagName:"span",className:"chat__tooltip",text:this.tooltipText});this.flyoutButton=l["default"]({tagName:"button",className:"chat__flyout-button chat__flyout-button--"+this.flyoutClassModifier+" chat__flyout-button--disabled",childs:[e]}),this.parent.appendChild(this.flyoutButton),this.flyout=l["default"]({tagName:"div",className:"chat__flyout chat__flyout--"+this.flyoutClassModifier}),this.parent.parentElement.appendChild(this.flyout)}},{key:"enableFlyout",value:function(){this.flyoutButton.classList.remove("chat__flyout-button--disabled"),h["default"](this.flyoutButton,"click",this.toggleFlyout)}},{key:"closeFlyoutOnBlur",value:function(e){a["default"](e,this.flyout,this.flyoutButton)&&(this._blurEvent(),this._blurEventTouch(),this._blurEvent=null,this.flyout.classList.remove("chat__flyout--visible"))}},{key:"toggleFlyout",value:function(){this.flyout.classList.toggle("chat__flyout--visible"),this._blurEvent||(this._blurEvent=h["default"](document,"click",this.closeFlyoutOnBlur),this._blurEventTouch=h["default"](document,"touchend",this.closeFlyoutOnBlur))}}]),e}();n["default"]=f},{"../utils/addEvent.js":18,"../utils/createElement.js":19,"../utils/isBlurred.js":21}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/createElement.js"),a=r(s),u=function(){function e(t,n){o(this,e),this.parent=t,this.options=n,this.render()}return i(e,[{key:"render",value:function(){this.chatHeaderTitle=a["default"]({tagName:"h1",className:"chat__header-title",text:""+this.options.room}),this.el=a["default"]({tagName:"div",className:"chat__header",childs:[this.chatHeaderTitle]}),this.parent.appendChild(this.el)}}]),e}();n["default"]=u},{"../utils/createElement.js":19}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../utils/createElement.js"),l=r(u),c=e("./chat-flyout.js"),h=r(c),f={ignore:{command:"/ignore {username}",description:"Chats from ignored user will no longer be visible to you.",roles:["user","moderator","owner","admin"]},unignore:{command:"/unignore {username}",description:"Make chats from ignored user visible again",roles:["user","moderator","owner","admin"]},mute:{command:"/mute {username}",description:"Timeout user from sending chats in the chatroom",roles:["moderator","owner","admin"]},unmute:{command:"/unmute {username}",description:"Lift user timeout",roles:["moderator","owner","admin"]},ban:{command:"/ban {username}",description:"Ban IP address of user.",roles:["moderator","owner","admin"]},unban:{command:"/unban {username}",description:"Lift the ban on IP address of user",roles:["moderator","owner","admin"]},mode:{command:"/mode {user|moderator|owner}",description:"Restrict chat to those with proper privileges",roles:["moderator","owner","admin"]},mod:{command:"/mod {username}",description:"Grant a user moderator privileges.",roles:["owner","admin"]},unmod:{command:"/unmod {username}",description:"Revoke moderator privileges from user.",roles:["owner","admin"]},blacklist:{command:"/blacklist {text}",description:"Word or phrase you want to ban from your chat. Use * for wildcards.",roles:["owner","admin"]},unblacklist:{command:"/unblacklist {text}",description:"Word or phrase you want to unban from your chat.",roles:["owner","admin"]},limit:{command:"/limit {# of chats} {# of seconds}",description:"Limit the # of chats allowed during the # of seconds",roles:["owner","admin"]},owner:{command:"/owner {username}",description:"Transfer ownership of chatroom to new user",roles:["owner","admin"]}},d=function(e){function t(e,n){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"help",n("help")));return r.parent=e,r.localize=n,r.render(),r.enableFlyout(),r}return s(t,e),a(t,[{key:"render",value:function(){var e=this;this.helpScrollContainer=l["default"]({tagName:"div",className:"chat__help-scroll"}),this.flyout.appendChild(this.helpScrollContainer),Object.keys(f).map(function(t){var n=[],r=l["default"]({tagName:"div",text:t,className:"chat__help-name"});n.push(r);for(var o=f[t].roles,i=0;i<o.length;i++){var s=l["default"]({tagName:"div",text:o[i],className:"chat__help-role chat__help-role--"+o[i]});n.push(s)}var a=l["default"]({tagName:"div",text:f[t].command,className:"chat__help-command"});n.push(a);var u=l["default"]({tagName:"div",text:f[t].description,className:"chat__help-description"});n.push(u);var c=l["default"]({tagName:"div",className:"chat__help-wrap",childs:n});return e.helpScrollContainer.appendChild(c),!0})}}]),t}(h["default"]);n["default"]=d},{"../utils/createElement.js":19,"./chat-flyout.js":10}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/createElement.js"),a=r(s),u=function(){function e(t,n,r,i,s){o(this,e),this.parent=t,this.chat=n,this.chatBody=r,this.localize=i,this.errorHandler=s,this.render()}return i(e,[{key:"initUser",value:function(){this.chatInput.classList.remove("chat__input--disabled"),this.chatInput.removeAttribute("disabled"),this.chatInput.setAttribute("placeholder",this.localize("Send message"))}},{key:"render",value:function(){var e=this;this.chatInput=a["default"]({tagName:"input",className:"chat__input chat__input--disabled",attributes:{placeholder:this.localize("Login to chat"),disabled:"disabled"}}),this.chatInputWrapper=a["default"]({tagName:"div",className:"chat__input-wrapper",childs:[this.chatInput]}),this.chatInput.addEventListener("keyup",function(t){if(t.preventDefault(),13===t.keyCode){var n=t.target.value;if(null!==n.match(/^\s+$/))return void(t.target.value="");n&&(t.target.value="",e.chat.command(n,function(t,n){if(t)throw t;if(n&&n.length)for(var r=0;r<n.length;r++){if(n[r].data&&n[r].data.help)return;e.chatBody.processMessage(n[r])}}))}}),this.parent.appendChild(this.chatInputWrapper)}}]),e}();n["default"]=u},{"../utils/createElement.js":19}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../utils/createElement.js"),l=r(u),c=e("../utils/debounce.js"),h=r(c),f=e("./chat-flyout.js"),d=r(f),p=function(e){function t(e,n,r,s){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"options",r("options")));return a.parent=e,a.chat=n,a.localize=r,a.errorHandler=s,a.colorHandler=h["default"](a.colorHandler.bind(a),250),a.showGifsHandler=a.showGifsHandler.bind(a),a.showTimestampsHandler=a.showTimestampsHandler.bind(a),a}return s(t,e),a(t,[{key:"initUser",value:function(){this.enableFlyout(),this.renderColors(),this.getDefaultAvatars(),this.renderOptions()}},{key:"getDefaultAvatars",value:function(){var e=this;this.chat.getDefaultAvatars(function(t,n){return t?void e.errorHandler(t):(e.defaultAvatars=n.avatars,void e.renderAvatars())})}},{key:"renderOptions",value:function(){var e=l["default"]({tagName:"div",className:"chat__options-switch-slider"}),t=l["default"]({tagName:"div",className:"chat__options-switch-name",text:this.localize("Show Animated Gifs")}),n=l["default"]({tagName:"input",className:"chat__options-switch-checkbox",attributes:{type:"checkbox",id:"showGifs"},events:{change:this.showGifsHandler}});this.chat._me.showGifs&&(n.checked=!0);var r=l["default"]({tagName:"label",className:"chat__options-switch",childs:[e],attributes:{"for":"showGifs"}}),o=l["default"]({tagName:"div",className:"chat__options-switch-container",childs:[n,r,t]}),i=l["default"]({tagName:"div",className:"chat__options-switch-slider"}),s=l["default"]({tagName:"div",className:"chat__options-switch-name",text:this.localize("Show Timestamps")}),a=l["default"]({tagName:"input",className:"chat__options-switch-checkbox",attributes:{type:"checkbox",id:"showTimestamps"},events:{change:this.showTimestampsHandler}});this.chat._me.showTimestamps&&(a.checked=!0);var u=l["default"]({tagName:"label",className:"chat__options-switch",childs:[i],attributes:{"for":"showTimestamps"}}),c=l["default"]({tagName:"div",className:"chat__options-switch-container",childs:[a,u,s]});this.flyout.appendChild(c),this.flyout.appendChild(o)}},{key:"showGifsHandler",value:function(e){var t=this,n={};n.showGifs=e.target.checked,this.chat.patchUser(this.chat._username,n,function(e,n){return e&&n?void t.errorHandler(e,n[0]):void 0})}},{key:"showTimestampsHandler",value:function(e){var t=this,n={};n.showTimestamps=e.target.checked,this.chat.patchUser(this.chat._username,n,function(e,n){return e&&n?void t.errorHandler(e,n[0]):void 0})}},{key:"renderAvatars",value:function(){for(var e=0;e<this.defaultAvatars.length;e++){var t=this.defaultAvatars[e],n=t.link===this.chat._me.avatar,r=l["default"]({tagName:"div",className:"chat__default-avatar "+(n?"chat__default-avatar--selected":""),attributes:{style:"background-image: url("+t.link+"); background-color: "+(this.chat._me.color||"#E0BB47")},events:{click:this.setDefaultAvatar.bind(this,t)}}),o=l["default"]({tagName:"div",className:"chat__grid-col-1-5",childs:[r]});this.colorsContainer.appendChild(o)}}},{key:"renderColors",value:function(){var e=[],t=l["default"]({tagName:"input",className:"chat__color",attributes:{type:"color",value:this.chat._me.color},events:{change:this.colorHandler}}),n=l["default"]({tagName:"label",className:"chat__color-label",childs:[t]}),r=l["default"]({tagName:"div",className:"chat__grid-col-1-5",childs:[n]});e.push(r);for(var o=["#1abc9c","#3498db","#9b59b6","#e67e22"],i=0;i<o.length;i++){var s=l["default"]({tagName:"div",className:"chat__default-color",attributes:{style:"background-color: "+o[i]},events:{click:this.setDefaultColor.bind(this,o[i])}}),a=l["default"]({tagName:"div",className:"chat__grid-col-1-5",childs:[s]});e.push(a)}this.colorsContainer=l["default"]({tagName:"div",className:"chat__colors-container chat__grid",childs:e}),this.flyout.appendChild(this.colorsContainer)}},{key:"setDefaultAvatar",value:function(e){var t=this;this.chat.setDefaultUserAvatar(this.chat._username,e.id,function(n){if(n)return void t.errorHandler(n);for(var r=document.querySelectorAll(".chat__default-avatar"),o=0;o<r.length;o++){var i=r[o].style.backgroundImage.slice(5,-2);i===e.link?r[o].classList.add("chat__default-avatar--selected"):r[o].classList.remove("chat__default-avatar--selected")}})}},{key:"setDefaultColor",value:function(e){var t=this,n={color:e};this.chat.patchUser(this.chat._username,n,function(n){if(n)return void t.errorHandler(n,t.localize("Chat Error"));for(var r=document.querySelectorAll(".chat__default-avatar"),o=0;o<r.length;o++)r[o].style.backgroundColor=e})}},{key:"colorHandler",value:function(e){var t=this,n={color:e.target.value};this.chat.patchUser(this.chat._username,n,function(n){if(n)return void t.errorHandler(n);for(var r=document.querySelectorAll(".chat__default-avatar"),o=0;o<r.length;o++)r[o].style.backgroundColor=e.target.value})}}]),t}(d["default"]);n["default"]=p},{"../utils/createElement.js":19,"../utils/debounce.js":20,"./chat-flyout.js":10}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("../utils/createElement.js"),a=r(s),u=function(){function e(t,n,r){o(this,e),this.parent=t,this.onClick=n,this.localize=r,this.render()}return i(e,[{key:"render",value:function(){var e=a["default"]({tagName:"span",className:"chat__tooltip",text:this.localize("popout")});this.el=a["default"]({tagName:"button",className:"chat__flyout-button chat__flyout-button--popout",events:{click:this.onClick},childs:[e]}),this.parent.appendChild(this.el)}}]),e}();n["default"]=u},{"../utils/createElement.js":19}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("../utils/createElement.js"),l=r(u),c=e("./chat-flyout.js"),h=r(c),f=e("./chat-actions-flyout.js"),d=r(f),p=function(e){function t(e,n,r,s,a,u){o(this,t);var l=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"roster",s("roster")));return l.parent=e,l.chat=n,l.chatBody=r,l.localize=s,l.errorHandler=a,l.options=u,l.updateRoster=l.updateRoster.bind(l),l.cleanUpdateRoster=l.cleanUpdateRoster.bind(l),l.handleRadioChange=l.handleRadioChange.bind(l),l.loadMoreHandler=l.loadMoreHandler.bind(l),l.actionMore=l.actionMore.bind(l),l}return s(t,e),a(t,[{key:"initUser",value:function(){this.render(),this.roster=this.chat.getRoster({limit:this.options.rosterLimit,role:""}),this.roster.update(this.updateRoster),this.enableFlyout()}},{key:"render",value:function(){this.rosterRadioUser=l["default"]({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:"rosterSort",value:"",checked:"checked",id:"rosterSortUser"},events:{change:this.handleRadioChange}}),this.rosterRadioModerator=l["default"]({tagName:"input",className:"chat__radio",attributes:{type:"radio",name:"rosterSort",value:"moderator",id:"rosterSortModerator"},events:{change:this.handleRadioChange}}),this.rosterRadioUserLabel=l["default"]({tagName:"label",className:"chat__radio-label",text:this.localize("Everyone"),attributes:{"for":"rosterSortUser"}}),this.rosterRadioModeratorLabel=l["default"]({tagName:"label",className:"chat__radio-label",text:this.localize("Moderators"),attributes:{"for":"rosterSortModerator"}}),this.rosterRadioWrapper=l["default"]({tagName:"div",className:"chat__radio-wrapper",childs:[this.rosterRadioUser,this.rosterRadioUserLabel,this.rosterRadioModerator,this.rosterRadioModeratorLabel]}),this.rosterRadioContainer=l["default"]({tagName:"div",className:"chat__radio-container chat__radio-container--sort",childs:[this.rosterRadioWrapper]}),this.rosterLoadMore=l["default"]({tagName:"button",className:"chat__roster-load-more",text:this.localize("Load More"),events:{click:this.loadMoreHandler}}),this.rosterContainer=l["default"]({tagName:"div",className:"chat__roster-container"}),this.rosterScrollContainer=l["default"]({tagName:"div",className:"chat__roster-scroll",childs:[this.rosterContainer,this.rosterLoadMore]}),this.flyout.appendChild(this.rosterRadioContainer),this.flyout.appendChild(this.rosterScrollContainer)}},{key:"handleRadioChange",value:function(e){var t={limit:this.options.rosterLimit};t.role=e.target.value,this.roster._options=t,this.roster.update(this.cleanUpdateRoster)}},{key:"loadMoreHandler",value:function(){this.roster.next(this.updateRoster)}},{key:"cleanUpdateRoster",value:function(e,t){for(;this.rosterContainer.firstChild;)this.rosterContainer.removeChild(this.rosterContainer.firstChild);this.updateRoster(e,t)}},{key:"updateRoster",value:function(e,t){if(e)return void this.errorHandler(e,{message:this.localize("Error updating roster"),level:"error"});for(var n=0;n<t.length;n++){var r=[];if("user"!==t[n].role){var o=l["default"]({tagName:"span",className:"chat__roster-role",text:t[n].role,attributes:{style:"background:"+t[n].roleColor}});r.push(o)}var i=l["default"]({tagName:"span",className:"chat__roster-actor",text:t[n].username});r.push(i);var s=l["default"]({tagName:"button",className:"chat__action chat__action--more chat__action--roster",attributes:{"data-tooltip":"More Actions"},events:{click:this.actionMore}});r.push(s);var a=l["default"]({tagName:"div",className:"chat__roster-actor-container",childs:r,attributes:{"data-username":t[n].username,"data-role":t[n].role}});this.rosterContainer.appendChild(a)}return this.roster._nextParams?void this.rosterLoadMore.classList.remove("chat__roster-load-more--disable"):void this.rosterLoadMore.classList.add("chat__roster-load-more--disable")}},{key:"actionMore",value:function(e){var t={username:e.target.parentElement.getAttribute("data-username"),id:e.target.parentElement.getAttribute("data-username"),role:e.target.parentElement.getAttribute("data-role"),modifierClass:"chat__actions-flyout--roster"};return this.actionsFlyout&&!this.actionsFlyout._closed&&t.id===this.actionsFlyout.options.id?(this.actionsFlyout.close(),void(this.actionsFlyout=!1)):void(this.actionsFlyout=new d["default"](e.target,this.chatBody,this.localize,t))}}]),t}(h["default"]);n["default"]=p},{"../utils/createElement.js":19,"./chat-actions-flyout.js":5,"./chat-flyout.js":10}],17:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("@livelyvideo/chat-core"),l=r(u),c=e("@livelyvideo/localization"),h=r(c);e("classlist-polyfill");var f=e("./components/chat-body.js"),d=r(f),p=e("./components/chat-emoticons.js"),m=r(p),v=e("./components/chat-input.js"),_=r(v),y=e("./components/chat-options.js"),b=r(y),g=e("./components/chat-header.js"),w=r(g),E=e("./components/chat-roster.js"),k=r(E),x=e("./components/chat-admin.js"),T=r(x),O=e("./components/chat-help.js"),C=r(O),N=e("./components/chat-controls.js"),j=r(N),R=e("./components/chat-popout.js"),A=r(R),P=e("./utils/popout.js"),L=r(P),H=e("./utils/createElement.js"),S=r(H),B={user:null,room:null,apiHost:null,websocketHost:null,authUrl:null,popout:null,chunkHistory:20,chunkSize:10,chunkView:3,rosterLimit:100,locale:null,messages:null,debug:!1},M=function(){function e(t,n){o(this,e),this.options=s({},B,n);var r=new h["default"](this.options.locale,this.options.messages);this.localize=r.localize.bind(r),this.errorHandler=this.errorHandler.bind(this),this.mount(t),this.init()}return a(e,[{key:"init",value:function(){var e=this.options.user?{url:this.options.authUrl+"?username="+this.options.user}:null;this.chat=new l["default"]({room:this.options.room,apiHost:this.options.apiHost,websocketHost:this.options.websocketHost},e),this.chat._username=this.options.user,this.chat._roomname=this.options.room,this.render(),this.initUnauthedUser()}},{key:"mount",value:function(e){switch("undefined"==typeof e?"undefined":i(e)){case"string":this.el=document.querySelector(e);break;case"object":this.el=e;break;default:console.warn(this.localize("Invalid Element"))}this.el.classList.add("chat")}},{key:"errorHandler",value:function(e,t){var n=t||{message:this.localize("Chat Error"),level:"error"};this.chatBody&&this.chatBody.processMessage(n),this.options.debug&&console.log(e,n)}},{key:"render",value:function(){var e=this;this.chatHeader=new w["default"](this.el,this.options,this.localize),this.chatBody=new d["default"](this.el,this.chat,this.localize,this.errorHandler,this.options),this.chatInput=new _["default"](this.el,this.chat,this.chatBody,this.localize),this.chatEmoticons=new m["default"](this.el,this.chat,this.chatInput,this.localize,this.errorHandler),this.chatControls=new j["default"](this.el),this.options.popout&&(this.chatPopout=new A["default"](this.chatControls.el,this.openPopout.bind(this),this.localize)),this.chatAdmin=new T["default"](this.chatControls.el,this.chat,this.localize,this.errorHandler,this.options),this.chatRoster=new k["default"](this.chatControls.el,this.chat,this.chatBody,this.localize,this.errorHandler,this.options),this.chatHelp=new C["default"](this.chatControls.el,this.localize),this.chatOptions=new b["default"](this.chatControls.el,this.chat,this.localize,this.errorHandler),this.chat.on("chat",function(t){return e.chatBody.processChat(t)}),this.chat.once("room",function(){return e.chatAdmin.roomHandler()}),this.chat.on("message",function(t){return e.chatBody.processMessage(t)}),this.chat.on("delete",function(t){return e.chatBody.deleteById(t.id)})}},{key:"initUnauthedUser",value:function(){var e=this;this.chat.on("error",function(t){return e.errorHandler(t,e.localize("Chat Error"))}),this.chat.once("me",function(t){if(e.history)for(var n=0;n<e.history.messages.length;n++)e.chatBody.processChat(e.history.messages[n]);return t?(e.meHandler(t),void e.initAuthedUser(t)):void e.roleHandler({room:{role:"anon"}})}),this.history=null,this.chat.once("history",function(t){e.history=t})}},{key:"initAuthedUser",value:function(e){var t=this;this.chatOptions.initUser(),this.chatEmoticons.initUser(),this.chatInput.initUser(),this.chatRoster.initUser(),this.chatAdmin.initRoom(),this._currentRole=e.room.role,this.chat.on("me",function(e){return t.meHandler(e)})}},{key:"meHandler",value:function(e){this.roleHandler(e),e.showTimestamps?this.el.classList.add("chat--timestamps"):this.el.classList.remove("chat--timestamps")}},{key:"roleHandler",value:function(e){if(this._currentRole&&this._currentRole!==e.room.role){var t={};switch(t.level="info",this._currentRole){case"user":t.message=this.localize("You have been modded");break;default:t.message=this.localize("You have been unmodded")}this.chatBody.processMessage(t)}this._currentRole=e.room.role;var n="chat";this.chatBody.isMod()&&(n+=" chat--isMod"),this.chatBody.isAdmin()&&(n+=" chat--isAdmin"),this.el.className=n}},{key:"openPopout",value:function(){var e=this;this.popout=new L["default"](this.options.popout,{width:340,height:640}),this._unmountClose=this.popout.on("close",function(){setTimeout(function(){e.popout&&e.popout.instance&&e.popout.instance.closed&&e.closePopout()},250)}),this.destroy(),this.renderNoPopout()}},{key:"closePopout",value:function(){this.popout&&(this.popout.close(),this.popout=null),this._unmountClose&&(this._unmountClose=null),this.destroyNoPopout(),this.init()}},{key:"renderNoPopout",value:function(){var e=S["default"]({tagName:"div",className:"chat__poppedout-text",text:"Your chat is popped out"});this._popoutEl=S["default"]({tagName:"div",className:"chat__poppedout",childs:[e]}),this.el.appendChild(this._popoutEl)}},{key:"destroyNoPopout",value:function(){this.el.removeChild(this._popoutEl)}},{key:"destroy",value:function(){for(this.chat.destroy(),this.chatBody.destroy(),this.el.className="chat";this.el.firstChild;)this.el.removeChild(this.el.firstChild)}}]),e}();n["default"]=M},{"./components/chat-admin.js":6,"./components/chat-body.js":7,"./components/chat-controls.js":8,"./components/chat-emoticons.js":9,"./components/chat-header.js":11,"./components/chat-help.js":12,"./components/chat-input.js":13,"./components/chat-options.js":14,"./components/chat-popout.js":15,"./components/chat-roster.js":16,"./utils/createElement.js":19,"./utils/popout.js":22,"@livelyvideo/chat-core":1,"@livelyvideo/localization":2,"classlist-polyfill":3}],18:[function(e,t,n){"use strict";function r(e,t,n){if(e.addEventListener){e.addEventListener(t,n);var r=function(){e.removeEventListener(t,n)};return r}e.attachEvent("on"+t,function(){n.call(e)});var o=function(){e.detachEvent("on"+t,function(){n.call(e)})};return o}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],19:[function(e,t,n){"use strict";function r(e){var t=void 0,n=void 0,o=void 0;if(e.tagName){if(t=document.createElement(e.tagName),e.className&&(t.className=e.className),e.attributes)for(n in e.attributes)t.setAttribute(n,e.attributes[n]);void 0!==e.html&&(t.innerHTML=e.html)}else t=document.createDocumentFragment();if(e.text&&t.appendChild(document.createTextNode(e.text)),void 0===window.HTMLElement&&(window.HTMLElement=Element),e.childs&&e.childs.length)for(o=0;o<e.childs.length;o++)t.appendChild(e.childs[o]instanceof window.HTMLElement?e.childs[o]:r(e.childs[o]));if(e.events)for(var i in e.events)t.addEventListener(i,e.events[i]);return t}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],20:[function(e,t,n){"use strict";function r(e,t,n){var r=void 0;return function(){for(var o=arguments.length,i=Array(o),s=0;o>s;s++)i[s]=arguments[s];var a=this,u=function(){r=null,n||e.apply(a,i)},l=n&&!r;clearTimeout(r),r=setTimeout(u,t||200),l&&e.apply(a,i)}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],21:[function(e,t,n){"use strict";function r(e,t,n){for(var r=e.target;r&&r!==document.body;){if(r===t||r===n)return!1;r=r.parentNode}return!0}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r},{}],22:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("events"),l={width:640,height:550,toolbar:!1,menubar:!1,location:!1,status:!1,scrollbars:!1,resizable:!0,left:0,top:0},c=function(e){function t(e,n){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(!(i instanceof t)){var a;return a=new t(e,n),o(i,a)}i.options=s({},l,n);var u=i.getParamsString(n);return i.instance=window.open(e,Date.now(),u),setTimeout(function(){return i.onPopupLoad()}),setTimeout(function(){return i.onPopupLoad()},250),i}return i(t,e),a(t,[{key:"onBeforeUnload",value:function(e){var t=this;this.emit("close",e),setTimeout(function(){t.instance.closed||(t.instance.onbeforeunload=t.onBeforeUnload.bind(t))},250)}},{key:"close",value:function(){this.instance.close()}},{key:"onPopupLoad",value:function(){try{this.instance.isPopup=!0,this.instance.onbeforeunload=this.onBeforeUnload.bind(this)}catch(e){}}},{key:"getParamsString",
value:function(e){var t=[];for(var n in e)t.push(n+"="+e[n]);return t=t.join(",")}}]),t}(u.EventEmitter);n["default"]=c},{events:4}]},{},[17])(17)});
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}]},{},[1]);
